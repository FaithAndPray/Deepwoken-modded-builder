<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deepwoken Builder Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: radial-gradient(#18221a, #04100d);
            --sidebar-bg: #0a0a0b;
            --card-bg: #0c120f;
            --parchment: #d8d7ca;
            --parchment-text: #1a1a1a;
            --gold: #c2a35d;
            --border-path: url('https://media.discordapp.net/attachments/1372657049485185125/1452405324723130408/border.png?ex=6949b15d&is=69485fdd&hm=ffd79f8b10f310c0c9da6d58b7241bf88afc69a16dec9569543f51f29daa4c3e&=&format=webp&quality=lossless&width=40&height=40'); 
            --border-slice: 10;
        }

        * { box-sizing: border-box; }
        body { 
            background: var(--bg); color: #fff; font-family: 'Lora', serif; 
            margin: 0; display: flex; height: 100vh; overflow: hidden; 
        }

        /* Sidebar Left - Centered Content */
        #sidebar-left { 
    width: 320px; 
    min-width: 320px; 
    background: var(--sidebar-bg); 
    border-right: 2px solid #2f2f35; 
    padding: 20px; 
    overflow-y: auto; /* Fixed: Now scrollable */
    display: flex; 
    flex-direction: column; 
    align-items: center;
    height: 100vh;
}

        
        /* Sidebar Right - Parchment */
        #sidebar-right {
            width: 340px; min-width: 340px; background: var(--parchment);
            color: var(--parchment-text); margin: 15px; display: flex; flex-direction: column;
            border: 12px solid transparent; 
            border-image: var(--border-path) var(--border-slice) round;
            image-rendering: pixelated; overflow: hidden;
        }

        #main-area { flex: 1; display: flex; flex-direction: column; padding: 20px; overflow: hidden; }
        #item-container { flex: 1; overflow-y: auto; padding-right: 10px; }

        /* Investment Header */
        .investment-header { text-align: center; margin-bottom: 20px; width: 100%; }
        .investment-header h2 { margin: 0; font-size: 1.8rem; }
        .pts-display { font-size: 2.5rem; font-weight: bold; margin: 5px 0; display: block; }
        #splash-text { color: var(--gold); font-size: 0.8rem; font-style: italic; min-height: 1.2rem; }

        /* Tabs Style */
        .tab-container { display: flex; gap: 15px; margin-bottom: 25px; }
        .tab-btn { 
            background: #000; color: #fff; font-family: 'Lora', serif; font-weight: 700;
            padding: 10px 20px; cursor: pointer; text-transform: uppercase;
            border: 10px solid transparent; border-image: var(--border-path) 10 round;
            background-clip: padding-box; image-rendering: pixelated; transition: 0.1s;
        }
        .tab-btn.active { filter: sepia(1) saturate(15) hue-rotate(-5deg); }

        /* Search Bar */
        .search-bar-container { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 4px; margin-bottom: 20px; border: 1px solid #333; }
        #search-input { width: 100%; padding: 10px; background:#000; color:#fff; border:1px solid #444; font-family: 'Lora'; margin-bottom: 10px; }

        /* Cards */
        .category-title {
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    user-select: none;
}

.category-title::after {
    content: '▼';
    font-size: 0.8rem;
    transition: transform 0.2s;
}

.category-block { 
    margin-bottom: 20px; 
}
.category-title { 
    font-size: 1rem; 
    margin-bottom: 10px; 
    padding: 10px 15px; 
    color: #fff; 
    cursor: pointer; 
    display: flex; 
    justify-content: space-between; 
    align-items: center;
    text-transform: uppercase;
    font-weight: bold;
    letter-spacing: 1px;

    /* Deepwoken Border for Titles */
    border: 8px solid transparent;
    border-image: var(--border-path) 10 round;
    background: #050505;
    background-clip: padding-box;
    image-rendering: pixelated;
}

.category-title:hover {
    filter: brightness(1.3);
}

.category-title::after {
    content: '▼';
    font-size: 0.7rem;
    transition: transform 0.2s;
}
.category-block.collapsed .grid { display: none; }
.category-block.collapsed .category-title::after { transform: rotate(-90deg); }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .card {
    background: var(--card-bg); 
    padding: 15px; 
    cursor: pointer;
    /* Fixed Border Logic */
    border: 10px solid transparent;
    border-image-source: var(--border-path);
    border-image-slice: 10;
    border-image-repeat: round;
    background-clip: padding-box;
    image-rendering: pixelated;
    
    /* Animation transition */
    transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), filter 0.2s, background 0.2s;
}

/* Re-adding the Hover Animation */
.card:hover:not(.locked) {
    transform: translateY(-5px); /* Lifts the card up */
    filter: brightness(1.2);      /* Makes the card look "lit up" */
    background: #121a16;          /* Slight background shift */
    z-index: 10;
}

.card.selected {
    /* Stronger gold filter for the selected state */
    filter: sepia(1) saturate(12) hue-rotate(5deg) brightness(1.1);
    background: rgba(194, 163, 93, 0.1);
    transform: scale(1.02); /* Makes it slightly bigger to show it is selected */
}

/* Ensure locked cards don't animate */
.card.locked:hover {
    transform: none;
}
        .card.selected { filter: sepia(1) saturate(5) hue-rotate(10deg); }
        .card.locked {
    opacity: 0.6; /* Increased visibility */
    filter: grayscale(0.7) contrast(0.8);
    cursor: not-allowed;
    border-image-source: var(--border-path); /* Keeps the border visible */
}
        .card h3 { margin: 0 0 5px 0; font-size: 1.1rem; color: #fff; }
        .card p { margin: 0; font-size: 0.85rem; color: #bbb; }
        .card hr { border: 0; border-top: 1px solid rgba(255,255,255,0.1); margin: 12px 0; }
        .req-text { color: var(--gold); font-size: 0.85rem; font-weight: 700; }

        /* Stat Rows */
        .stat-row { display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 8px; }
        input[type="number"] { background: #000; border: 1px solid #444; color: #fff; padding: 5px; width: 65px; text-align: center; font-family: 'Lora'; font-size: 1rem; }

        /* Calculator wrapper */
        .calc-wrapper { background: var(--parchment); color: var(--parchment-text); padding: 25px; border: 10px solid transparent; border-image: var(--border-path) 10 round; max-width: 600px; margin: 0 auto; }
        .calc-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px dotted rgba(0,0,0,0.2); font-weight: bold; }
        .calc-row span { font-weight: normal; color: #666; font-style: italic; }

        /* Buttons */
        .action-btn { background: #1a1a1c; border: 1px solid #444; color: #fff; padding: 12px; cursor: pointer; width: 100%; margin-top: 8px; font-family: 'Lora'; font-weight: bold; }

        /* Mobile */
        #mobile-nav { display: none; padding: 10px; background: #000; border-bottom: 1px solid #333; justify-content: space-between; }
        .overlay { 
    display: none; 
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    background: rgba(0,0,0,0.7); 
    z-index: 900; /* Ensure this is below the sidebars (1000+) but above the main area */
}

/* Only show overlay when a sidebar is open on mobile */
body.sidebar-open-left .overlay, 
body.sidebar-open-right .overlay { 
    display: block; 
}

        @media (max-width: 1024px) {
    body {
        flex-direction: column;
        overflow-y: auto; /* Allow body scrolling */
        height: auto;
    }

    /* Fix: Give sidebars a solid background so they aren't see-through */
    #sidebar-left, #sidebar-right {
        position: fixed;
        top: 0;
        height: 100%;
        width: 280px;
        z-index: 2000; /* Put them above everything */
        display: flex; 
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 5px 0 15px rgba(0,0,0,0.5);
    }

    #sidebar-left {
        left: 0;
        transform: translateX(-100%);
        background: #0a0a0b; /* Solid black sidebar */
    }

    #sidebar-right {
        right: 0;
        transform: translateX(100%);
        margin: 0;
        background: var(--parchment); /* Solid parchment background */
    }

    /* Correct open logic */
    body.sidebar-open-left #sidebar-left { transform: translateX(0); }
    body.sidebar-open-right #sidebar-right { transform: translateX(0); }

    /* Main area layout fix */
    #main-area {
        padding: 10px;
        overflow: visible;
        width: 100%;
    }

    /* Prevent overlap: Tabs shouldn't be huge on mobile */
    .tab-container {
        flex-wrap: wrap;
        gap: 5px;
        justify-content: center;
    }

    .tab-btn {
        font-size: 0.75rem;
        padding: 8px 12px;
        border-width: 6px; /* Slightly thinner border for mobile */
    }

    /* Nav bar stays at the top */
    #mobile-nav {
        display: flex;
        position: sticky;
        top: 0;
        z-index: 1500;
        background: #000;
    }
}

        .toggle-gif-btn { background: transparent; border: none; color: #55aaff; padding: 0; font-size: 0.75rem; cursor: pointer; text-decoration: underline; margin-top: 8px; }
        .gif-container { margin-top: 10px; display: none; width: 100%; border: 1px solid #333; }
        .gif-container img { width: 100%; display: block; }
        body.sidebar-open-left #sidebar-left { transform: translateX(0); }
    body.sidebar-open-right #sidebar-right { transform: translateX(0); }
    
    /* Show Overlay when menu is open */
    body.sidebar-open-left .overlay, body.sidebar-open-right .overlay { display: block; }

    /* Shrink search bar for mobile */
    .search-bar-container { padding: 10px; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="overlay" onclick="closeSidebars()"></div>

<div id="mobile-nav">
    <button onclick="toggleSidebar('left')" style="background:none; border:1px solid #fff; color:#fff; padding:5px 15px;">Stats</button>
    <button onclick="toggleSidebar('right')" style="background:none; border:1px solid #fff; color:#fff; padding:5px 15px;">Build</button>
</div>

<div id="sidebar-left">
    <div class="investment-header">
        <h2>Investment</h2>
        <span class="pts-display"><span id="used-pts">0</span> / <span id="max-pts">410</span></span>
        <div id="splash-text"></div>
    </div>
    
    <div id="core-inputs" style="width: 100%;"></div>
    <hr style="width:100%; border:0; border-top:1px solid #333; margin:15px 0;">
    <div id="att-inputs" style="width: 100%;"></div>

    <div style="width: 100%; margin-top: auto;">
        <button class="action-btn" onclick="saveBuild()" style="background: var(--gold); color: #000; border:none;">SHARE BUILD LINK</button>
        <button class="action-btn" style="color:#ff4444;" onclick="clearBuild()">CLEAR BUILD</button>
    </div>
</div>

<div id="main-area">
    <div class="tab-container">
        <div class="tab-btn active" id="tab-talents" onclick="switchTab('talents')">Talents</div>
        <div class="tab-btn" id="tab-mantras" onclick="switchTab('mantras')">Mantras</div>
        <div class="tab-btn" id="tab-calc" onclick="switchTab('calc')">Dmg & Pen</div>
    </div>

    <div id="search-bar" class="search-bar-container">
        <input type="text" id="search-input" placeholder="Search..." oninput="renderItems()">
        <label style="font-size: 0.85rem; color: #ccc; cursor: pointer;">
            <input type="checkbox" id="filter-reqs" onchange="renderItems()"> Show things that fit Requirements
        </label>
    </div>

    <div id="item-container"></div>
</div>

<div id="sidebar-right">
    <div style="padding: 15px; text-align: center; font-weight: bold; border-bottom: 2px solid #000; font-size: 1.1rem; text-transform: uppercase;">Build Overview</div>
    <div id="selection-list" style="overflow-y: auto; flex: 1;"></div>
</div>

<script>
// --- 1. THE COMPLETE GAME DATA ---
const gameData = {
    attributes: ["Strength", "Fortitude", "Agility", "Intelligence", "Willpower", "Charisma", "Precision", "Light Weapon", "Medium Weapon", "Heavy Weapon"],
    attunements: ["Flamecharm", "Frostdraw", "Thundercall", "Shadowcast", "Galebreathe", "Ironsing", "Bloodrend", "Earthbend"],
    talents: {
        "No Stat Reqs": [{ "name": "Return to the Dark Ages", "desc": "10% less Outgoing and Incoming Mantra DMG. [5 hp]", "req": {} },{ "name": "Lightweight", "desc": "Move faster when armor is 0%. [+1 Posture]", "req": {} },{ "name": "The Sounds from Below", "desc": "[+150hp]", "req": {} },{ "name": "Armor Conserver", "desc": "15% less armor drain on hit.", "req": {} },{ "name": "Murmur: Ardour", "desc": "Deal 15% more posture DMG and take 15% less when pressing H.", "req": {} }],
        "Strength": [{ "name": "Duelist’s Dance", "desc": "25% more posture from parrying. [+2 Posture]", "req": { "Strength": 20 } },{ "name": "Harsh Response", "desc": "Enemies receive less posture when parrying you.", "req": { "Strength": 25 } },{ "name": "Bulldozer", "desc": "Enemies you flourish into a wall have a chance of breaking the wall and are guard broken on impact.", "req": { "Strength": 25 } },{ "name": "Lose Your Mind", "desc": "Deal more DMG scaling with insanity up to 10% max. [+5 hp]", "req": { "Strength": 30 } },{ "name": "Unwavering Resolve", "desc": "Getting parried punishes your posture 33% less. [+2 Posture]", "req": { "Strength": 40 } },{ "name": "Shield Breaker", "desc": "Blunt Damage now fully ignores the posture from Shields. [+1 Posture]", "req": { "Strength": 60 } },{ "name": "Piercing Blow", "desc": "Guardbreaks Ignore Armor Resistance.", "req": { "Strength": 80 } },{ "name": "Berserk", "desc": "Succumb to the burning rage within, nullifying your own armor in exchange for nullifying the armor of your foes on your Basic Attacks. Grants your Criticals +10% PEN while active.", "req": { "Strength": 80 } },{ "name": "Million Ton Piercer", "desc": "Gain 5% extra PEN and remove the cap on your PEN. Go beyond your limits.", "req": { "Strength": 90 } },{ "name": "Collapsed Lung", "desc": "Block breaking an opponent closes off their ability to Vent for 8s, duration scales with Strength.", "req": { "Strength": 100 } },{ "name": "Dreambreaker", "desc": "On Flourish, Disables Tempo Drain and gives Tempo gain for 10s, Decrease target tempo gain for 7.5s. (Locks Collapsed Lung)", "req": { "Strength": 100 } }],
        "Precision": [{ "name": "Deflecting Handyman", "desc": "Posture Removal cooldown on parry is decreased by 0.25s. [+1 Posture]", "req": { "Precision": 20 } },{ "name": "Dead Eye", "desc": "Opponents who dodge will take 10% PEN on next attack. (8s CD)", "req": { "Precision": 40 } },{ "name": "Deadly Blow", "desc": "After Dodge, +25% Posture DMG for 3s. (10s CD)", "req": { "Precision": 50 } },{ "name": "Successive Strikes", "desc": "M1 Strings and Criticals build up stacks of increased DMG that last 5s, Dead Eye will not cancel on next hit.", "req": { "Precision": 60 } },{ "name": "Decisive Battle", "desc": "Cancelling an opponents block from behind will increase the damage by 10%", "req": { "Precision": 60 } },{ "name": "Close Quarters", "desc": "The first parry in an aerial state won’t knock you back. (20s CD) [+1 Posture]", "req": { "Precision": 75 } },{ "name": "Fatality", "desc": "Guardbreaking an Opponents Stuns them for longer. [+1 Posture]", "req": { "Precision": 80 } },{ "name": "Pinpoint Accuracy", "desc": "Bullets are now faster.", "req": { "Precision": 80 } },{ "name": "Hidden Blade", "desc": "Spine Cutter now applies anti-heal", "req": { "Precision": 80 } },{ "name": "Upcoming Opportunity", "desc": "Uncap PEN + gain 30% PEN for 3s Upon Parry or Dodge. (5s CD)", "req": { "Precision": 90 } }],
        "Fortitude": [{ "name": "Battle Tendency", "desc": "20% faster posture regen.", "req": { "Fortitude": 15 } },{ "name": "Braced Collapse", "desc": "After being block broken, the next attack to hit you deals reduced damage.", "req": { "Fortitude": 25 } },{ "name": "Exoskeleton", "desc": "Natural Armor resists 10% Physical Damage when active. Replenishes when resting.", "req": { "Fortitude": 40 } },{ "name": "To the Finish", "desc": "You take 10% less damage when below 30% health.", "req": { "Fortitude": 50 } },{ "name": "Turtle Shell", "desc": "If your shield is on your back, take reduced backstab damage and negate Spine Cutter.", "req": { "Fortitude": 50 } },{ "name": "Dancing Guard", "desc": "Parrying an opponent and then parrying another enemy in quick succession applies slow for 7s.", "req": { "Fortitude": 55 } },{ "name": "Knuckle Guard", "desc": "Hitting Dazed enemies grants you 10% posture resistance for 15s.", "req": { "Fortitude": 55, "Strength": 25 } },{ "name": "Down to your Level", "desc": "While you have a speed debuff, your Basic Attacks slow your enemies for 5s.", "req": { "Fortitude": 60 } },{ "name": "Defensive Reprisal", "desc": "Being flourished grants you 10% posture resistance for 20s.", "req": { "Fortitude": 65 } },{ "name": "Reinforced Armor", "desc": "Incoming PEN is reduced by 30%.", "req": { "Fortitude": 90 } },{ "name": "Armorclad", "desc": "Flourishing, or Getting Guardbroken gives you slight dmg resistance for 10s.", "req": { "Fortitude": 100 } }],
        "Agility": [{ "name": "Lowstride", "desc": "Crouching stealth and roll distance increased. Smaller speed penalty. Silent weapon draw.", "req": { "Agility": 20 } },{ "name": "Kick Off", "desc": "No damage from short falls. Higher wall jumps. Speed boost after wall jumping.", "req": { "Agility": 20 } },{ "name": "Safety Dance", "desc": "Your base dodge frames are increased by 0.05s.", "req": { "Agility": 20 } },{ "name": "Observation", "desc": "Dodge frames are larger if you cancel your roll immediately.", "req": { "Agility": 20 } },{ "name": "Risky Moves", "desc": "When you successfully dodge, you'll automatically dodge the next attack.", "req": { "Agility": 25 } },{ "name": "Speed Emission", "desc": "Gain a slight speed boost after landing a vent.", "req": { "Agility": 25 } },{ "name": "Speed Demon", "desc": "Your attacks now inflict a reduced-strength bleed while you have a speed boost. 1s cooldown.", "req": { "Agility": 25 } },{ "name": "Blade Dancer", "desc": "Landing a Basic Attack removes your roll cooldown.", "req": { "Agility": 25 } },{ "name": "Deep Wound", "desc": "Assassinating a target applies anti-heal for 20s and gives you a speed boost for 6s.", "req": { "Agility": 35 } },{ "name": "Ghost", "desc": "Dodging a move will briefly make you invisible, ending early if you attack.", "req": { "Agility": 40 } },{ "name": "Lights Out", "desc": "Assassinations give 30% PEN and blind the target for 5s.", "req": { "Agility": 55 } },{ "name": "Tap Dancer", "desc": "Rolling immediately after a roll-cancel no longer puts your roll on a longer cooldown.", "req": { "Agility": 60 } },{ "name": "Unseen Threat", "desc": "Assassinate those with weapons out if not in combat. Targets are slowed and cannot jump for 3s.", "req": { "Agility": 60 } },{ "name": "Cheap Shot", "desc": "Attacks gain 10% PEN multiplicatively with an active speed boost.", "req": { "Agility": 65 } },{ "name": "Down Comes the Claw", "desc": "Landing Critical with speed boost prevents opponent from dodging twice in a row for 5s.", "req": { "Agility": 75 } },{ "name": "Pursuit", "desc": "If you land Revenge, Reset the Cooldown (25s CD)", "req": { "Agility": 90 } },{ "name": "Dustlunge", "desc": "Assassinate from farther via shade stepping. Chain assassinate nearby enemies.", "req": { "Agility": 90 } },{ "name": "Maiming Claws", "desc": "Down Comes the Claw now disables opponent's posture regeneration for 6s on proc.", "req": { "Agility": 100 } }],
        "Intelligence": [{ "name": "Ether Absorption", "desc": "Receive Ether back when inflicted with damage from Mantras.", "req": { "Intelligence": 15 } },{ "name": "Perfect Flash", "desc": "Over 95% health causes mantras to do +25% damage.", "req": { "Intelligence": 25 } },{ "name": "Eureka", "desc": "Gain Inspiration stacks on mantra land/parry. 3 stacks grant +10% Mantra Damage.", "req": { "Intelligence": 30 } },{ "name": "True Ether Bullets", "desc": "Ether Bullets apply elemental damage of highest investment.", "req": { "Intelligence": 30, "Weapon": 20 } },{ "name": "Overflowing Dam", "desc": "Full Ether for 2s grants an aura for 10% more damage.", "req": { "Intelligence": 40 } },{ "name": "Foolish Outburst", "desc": "Blocking or parrying a vent absorbs the Tempo cost of the vent.", "req": { "Intelligence": 50 } },{ "name": "Keen Recovery", "desc": "Basic attack after feinting a mantra restores the feinted mantra's ether cost.", "req": { "Intelligence": 55 } },{ "name": "Prime Ether Bullets", "desc": "Bullets take one less hit to proc elements and have intelligence scaling.", "req": { "Intelligence": 60, "Light": 90 } },{ "name": "Twelve Steps Ahead", "desc": "Landing Prediction halves cooldown; whiffing doubles it.", "req": { "Intelligence": 80 } },{ "name": "Ether Overdrive", "desc": "Gain 5% extra PEN and remove the cap on your PEN.", "req": { "Intelligence": 90, "Elemental": 20 } },{ "name": "Absolute Pitch", "desc": "You can cast ritual mantra’s instantly.", "req": { "Intelligence": 100 } }],
        "Willpower": [{ "name": "Disbelief", "desc": "Resistant to Illusion magic, charms, and tricks.", "req": { "Willpower": 25 } },{ "name": "Magical Resolve", "desc": "Being hit increases ether regen.", "req": { "Willpower": 40 } },{ "name": "Ardour Scream", "desc": "Amplify shout to make victims take 25% more DMG and Posture for 10s.", "req": { "Willpower": 40 } },{ "name": "Underdog", "desc": "Deal more damage to those with higher HP, scales with WILL.", "req": { "Willpower": 40 } },{ "name": "Heretic's Sutra", "desc": "A chant that steers you into the state of Insanity for 20 seconds.", "req": { "Willpower": 80 } },{ "name": "Piercing Will", "desc": "When sanity is below 35%, gain up to +15% PEN.", "req": { "Willpower": 80 } },{ "name": "Psychic", "desc": "Opponents with <50% sanity cannot proc Deep Gems against you briefly.", "req": { "Willpower": 80 } },{ "name": "Shared Misery", "desc": "Attacking while losing sanity causes enemies to lose sanity.", "req": { "Willpower": 90 } },{ "name": "Beleaguered But Unbowed", "desc": "Damage reduction when surrounded by 2 or more opponents.", "req": { "Willpower": 90 } },{ "name": "Sin Stacker", "desc": "All The Dead Gods' duration is based on enemy antiheal stacks.", "req": { "Willpower": 90 } },{ "name": "Indomitable Spirit", "desc": "Sanity attacks are redirected to nearby opponents.", "req": { "Willpower": 100 } }],
        "Charisma": [{ "name": "Charismatic Cast", "desc": "Landing mantras charms enemies, reducing damage done to you.", "req": { "Charisma": 25 } },{ "name": "Tough Love", "desc": "Deal 10% more damage to charmed enemies.", "req": { "Charisma": 25 } },{ "name": "Give and Take", "desc": "Deal and receive less DMG from comrades.", "req": { "Charisma": 35 } },{ "name": "Golden Tongue", "desc": "Typing or gestures give random buffs to you and allies.", "req": { "Charisma": 40 } },{ "name": "Lasting Charisma", "desc": "Enemies charmed by mantras stay charmed longer.", "req": { "Charisma": 55 } },{ "name": "Chaotic Charm", "desc": "At low health, naturally apply charm to reduce incoming damage.", "req": { "Charisma": 55 } },{ "name": "Dazing Finisher", "desc": "Flourishing charmed enemies dazes them instead of knockback.", "req": { "Charisma": 55 } },{ "name": "Manipulator", "desc": "Deal 20% more critical damage to charmed enemies; removes charm.", "req": { "Charisma": 60 } },{ "name": "Narcissist", "desc": "Charming an already charmed opponent Overcharms you briefly.", "req": { "Charisma": 60 } },{ "name": "Unnecessary Theatrics", "desc": "Deliver a one-liner on heavy attacks that charms opponents briefly.", "req": { "Charisma": 75 } },{ "name": "Cornered Fool", "desc": "Blockbreaking a charmed opponent procs Taunt.", "req": { "Charisma": 85 } },{ "name": "Cult of Personality", "desc": "Gain +3% PEN for each person Charmed, capping at 15%.", "req": { "Charisma": 90 } },{ "name": "Off Your Game", "desc": "Slow Taunted enemies when you hit them.", "req": { "Charisma": 90 } }],
        "Weapon Talents": [{ "name": "Virtuoso", "desc": "Temporarily proc talents of other weapon types in same class.", "req": { "Precision": 80, "OR_Weapon": 80 } },{ "name": "Critical Engine", "desc": "Ability to use Deep Gems on your critical attack.", "req": { "Intelligence": 90, "Weapon": 30 } }],
        "Elemental Paths": [{ "name": "Simple Path: Electrocution", "desc": "Thunder hits apply Electrocution.", "req": { "Thundercall": 50 } },{ "name": "Raiton Path: Enlightened", "desc": "Thunder hits overcharge.", "req": { "Thundercall": 50 } },{ "name": "Surge Path: Unstable Capacitor", "desc": "Apply surge stacks instead of shock.", "req": { "Thundercall": 40 } },{ "name": "Glass Path: Crystallization", "desc": "Ice mantras grow crystals.", "req": { "Frostdraw": 40 } },{ "name": "Unyielding Frost", "desc": "Chill procs through block.", "req": { "Frostdraw": 100 } },{ "name": "Eruption Path: Lava Serpent", "desc": "Set people aflame to spawn eruptions.", "req": { "Flamecharm": 50 } },{ "name": "The Final Act", "desc": "M1s on burning enemies cause explosions.", "req": { "Flamecharm": 75 } },{ "name": "Emperor Flame", "desc": "Coat yourself in blue flames.", "req": { "Flamecharm": 80 } },{ "name": "Wraith Path: Umbra", "desc": "Darkened flames refuse ether gain.", "req": { "Flamecharm": 50, "Shadowcast": 50 } },{ "name": "Flashboil", "desc": "Chilled + Fire create steam clouds.", "req": { "Flamecharm": 30, "Frostdraw": 30 } },{ "name": "Gilded Path: Scrapsinger", "desc": "Siphon enemy armor.", "req": { "Ironsing": 35 } },{ "name": "Decay Path: Oxidize", "desc": "Metal attacks store damage.", "req": { "Ironsing": 50 } },{ "name": "Manipulation Path: Spirit Lantern", "desc": "Attacks poison instead of pools.", "req": { "Bloodrend": 50 } },{ "name": "Manipulation Path: Agile Misery", "desc": "Agility mantras empowered.", "req": { "Bloodrend": 50 } },{ "name": "Simple Manipulation: Unstable Blood", "desc": "Heavy bleeding on hit.", "req": { "Bloodrend": 50 } },{ "name": "Chorus of Souls", "desc": "Alone, wisp lack voice; together they sing.", "req": {"Flamecharm": 30, "Frostdraw": 30, "Thundercall": 30, "Shadowcast": 30, "Galebreathe": 30, "Ironsing": 30, "Bloodrend": 30}},{ "name": "Wisp Convergence", "desc": "Wisps grant elements to strikes.", "req": {"Flamecharm": 30, "Frostdraw": 30, "Thundercall": 30, "Shadowcast": 30, "Galebreathe": 30, "Ironsing": 30, "Bloodrend": 30}}]
    },
    mantras: {
       "Flamecharm": [
            { "name": "Fire Blade", "desc": "Reversal Spark: Disables Starkindred Fire Blade Variant", "req": { "Flamecharm": 1 }, "gif": "https://trello.com/1/cards/68cf89fb32f6fe4675b80721/attachments/68d0c0aa43c9b442618ba84b/download/2025-09-2123-20-12-ezgif.com-video-to-gif-converter.gif" },
            { "name": "Burning Servants", "desc": "Spawns fire minions.", "req": { "Flamecharm": 1 }, "gif": "https://trello.com/1/cards/68cf89fb32f6fe4675b80721/attachments/68d0c173b87ccfb239aef7af/download/2025-09-2123-23-07-ezgif.com-video-to-gif-converter.gif" },
            { "name": "Fire Kick", "desc": "Quick fire-infused kick.", "req": { "Flamecharm": 1 }, "gif": "https://trello.com/1/cards/68cf89fb32f6fe4675b80721/attachments/68d0c31849c6e2a389784db3/download/2025-09-2123-30-44-ezgif.com-video-to-gif-converter.gif" },
            { "name": "Fire Forge (Base)", "desc": "throw flame daggers.", "req": { "Flamecharm": 20 }, "gif": "https://trello.com/1/cards/68cf89fb32f6fe4675b80721/attachments/68d0c4c96c88911191344df6/download/2025-09-2123-35-04-ezgif.com-video-to-gif-converter.gif" },
            { "name": "Fire Forge (Tornado Spark)", "desc": "Upgraded fire forge.", "req": { "Flamecharm": 20 }, "gif": "https://trello.com/1/cards/68cf89fb32f6fe4675b80721/attachments/6929c8955d6e0707648d6db9/download/Firefuckbutcool-ezgif.com-crop.gif" },
            { "name": "Rising Flame", "desc": "(Procs Meteor Impact Talent)", "req": { "Flamecharm": 20 }, "gif": "https://trello.com/1/cards/68cf89fb32f6fe4675b80721/attachments/68d7997d7a64b241cc836e71/download/2025-09-2703-58-56-ezgif.com-video-to-gif-converter.gif" },
            { "name": "Fire Eruption", "desc": "fire eruption, the fuck did u expect?.", "req": { "Flamecharm": 30 }, "gif": "https://trello.com/1/cards/68cf89fb32f6fe4675b80721/attachments/68d798c74d1147fcef1b8241/download/2025-09-2703-55-08-ezgif.com-video-to-gif-converter.gif" },
            { "name": "Flame Assault", "desc": "Forward flame dash attack.", "req": { "Flamecharm": 30 }, "gif": "https://trello.com/1/cards/68cf89fb32f6fe4675b80721/attachments/68d799903932f0d438a53244/download/2025-09-2703-59-28-ezgif.com-video-to-gif-converter.gif" },
            { "name": "Flaming Scourge", "desc": "3 Hits, 2 during swing grab. 3rd is a downslam.", "req": { "Flamecharm": 50 }, "gif": "https://trello.com/1/cards/68cf89fb32f6fe4675b80721/attachments/68d79a8449c61fb155a2f25a/download/2025-09-2704-03-01-ezgif.com-video-to-gif-converter.gif" },
            { "name": "Ash Slam", "desc": "2nd hit ragdolls.", "req": { "Flamecharm": 50, "Strength": 20 }, "gif": "https://trello.com/1/cards/68cf89fb32f6fe4675b80721/attachments/68d79aa2bccdf7c632efe712/download/2025-09-2704-03-32-ezgif.com-video-to-gif-converter.gif" }
        ],
        "Frostdraw": [
            { "name": "Ice Blade", "desc": "Ice-infused blade attack.", "req": { "Frostdraw": 20 }, "gif": "https://trello.com/1/cards/68cf8a00e78a1928f93e928e/attachments/691b64d4620d0e0820c09898/download/iceblades-ezgif.com-crop.gif" },
            { "name": "Ice Daggers", "desc": "Throw daggers of ice.", "req": { "Frostdraw": 20 }, "gif": "https://trello.com/1/cards/68cf8a00e78a1928f93e928e/attachments/691b6502fcfdd304aa062f25/download/icedaggers-ezgif.com-crop.gif" },
            { "name": "Ice Chain", "desc": "Chains the target in frost.(ez parr bait mantra)", "req": { "Frostdraw": 20 }, "gif": "https://trello.com/1/cards/68cf8a00e78a1928f93e928e/attachments/691b6647d8ee6da76563f121/download/Icechain-ezgif.com-crop.gif" },
            { "name": "Ice Lasers", "desc": "amount of lasers scales to the amount of frostdraw that u got", "req": { "Frostdraw": 20 }, "gif": "https://trello.com/1/cards/68cf8a00e78a1928f93e928e/attachments/691b673e9ef8d553f6e1e484/download/icelaser-ezgif.com-crop.gif" },
            { "name": "Ice Eruption", "desc": "trap ppl in ice and combo extend", "req": { "Frostdraw": 20 }, "gif": "https://trello.com/1/cards/68cf8a00e78a1928f93e928e/attachments/691b666b9712bc124dbabd40/download/iceeruption-ezgif.com-crop.gif" },
            { "name": "Ice Lance", "desc": "top 5 best combo extenders", "req": { "Frostdraw": 30 }, "gif": "https://trello.com/1/cards/68cf8a00e78a1928f93e928e/attachments/691b6557271306f0d16b7ef3/download/icelance-ezgif.com-crop.gif" },
            { "name": "Ice Smash", "desc": "gbs at lvl 5", "req": { "Frostdraw": 30 }, "gif": "https://trello.com/1/cards/68cf8a00e78a1928f93e928e/attachments/691b6579b8f75c68fe54e8c8/download/icesmash-ezgif.com-crop.gif" },
            { "name": "Frost Grab", "desc": "Pull enemies closer with ice.", "req": { "Frostdraw": 30 }, "gif": "https://trello.com/1/cards/68cf8a00e78a1928f93e928e/attachments/691b669d66421cf34265eea0/download/Frostgrab-ezgif.com-crop.gif" },
            { "name": "Crystal Knee", "desc": "Uppercut the opps with your knee.", "req": { "Frostdraw": 30 }, "gif": "https://trello.com/1/cards/68cf8a00e78a1928f93e928e/attachments/691b6598a567c4f80995f4c9/download/crystalknee-ezgif.com-crop.gif" },
            { "name": "Crystal Impale", "desc": "Impale target with ice crystals.", "req": { "Frostdraw": 30 }, "gif": "https://trello.com/1/cards/68cf8a00e78a1928f93e928e/attachments/691b65b536f88b719b5a3bd2/download/Crystalimpale-ezgif.com-crop.gif" },
            { "name": "Rising Frost", "desc": "rising flame sister", "req": { "Frostdraw": 30 }, "gif": "https://trello.com/1/cards/68cf8a00e78a1928f93e928e/attachments/691b65d2885733951812a96e/download/risingfrost-ezgif.com-crop.gif" },
            { "name": "Frost Wisp", "desc": "Summon a frost companion.", "req": { "Frostdraw": 30 }, "gif": "https://trello.com/1/cards/68cf8a00e78a1928f93e928e/attachments/691b67072c848410e019cafd/download/frostwisp-ezgif.com-crop.gif" },
            { "name": "Ice Cubes", "desc": "ice cubes, baby", "req": { "Frostdraw": 50 }, "gif": "https://trello.com/1/cards/68cf8a00e78a1928f93e928e/attachments/691b666e915247d16aca1dc7/download/icecubes-ezgif.com-crop.gif" },
            { "name": "Glacial Collapse", "desc": "Massive ice slam.", "req": { "Frostdraw": 50, "Strength": 20 }, "gif": "https://trello.com/1/cards/68cf8a00e78a1928f93e928e/attachments/691b6760712fe32ebc369116/download/Glacialcollapse-ezgif.com-crop.gif" },
            { "name": "Iceberg", "desc": "Form an iceberg that heals you (this mantra sucks)", "req": { "Frostdraw": 50 }, "gif": "https://trello.com/1/cards/68cf8a00e78a1928f93e928e/attachments/691b65eeaa549a73770a95cd/download/Iceberg-ezgif.com-crop.gif" }
        ],
        "Galebreathe": [
            { "name": "Wind Blade", "desc": "has a Sliding variant, aim with mouse.", "req": { "Galebreathe": 1 }, "gif": "https://trello.com/1/cards/68cf8b422d1e4b6dfc7faaf7/attachments/68e2daefd6149de6998573d1/download/2025-10-0516-40-26-ezgif.com-video-to-gif-converter.gif" },
            { "name": "Gale Lunge", "desc": "Can Proc Haunted Gale.", "req": { "Galebreathe": 20 }, "gif": "https://trello.com/1/cards/68cf8b422d1e4b6dfc7faaf7/attachments/691b67b86565054e82d79a06/download/Gale_Lunge-ezgif.com-video-to-gif-converter.gif" },
            { "name": "Wind Forge", "desc": "Wind daggers that autoaim.", "req": { "Galebreathe": 20 }, "gif": "https://trello.com/1/cards/68cf8b422d1e4b6dfc7faaf7/attachments/691b68b3b22fe3f72c71dc4a/download/Windforge-ezgif.com-crop.gif" },
            { "name": "Twister Kicks", "desc": "Spinning kicks. (fuckass mantra)", "req": { "Galebreathe": 20 }, "gif": "https://trello.com/1/cards/68cf8b422d1e4b6dfc7faaf7/attachments/691b67d7ef572e1ddd2be0d5/download/twisterkicks-ezgif.com-crop.gif" },
            { "name": "Heavenly Wind", "desc": "fly up in the sky then slam the opps.", "req": { "Galebreathe": 20 }, "gif": "https://trello.com/1/cards/68cf8b422d1e4b6dfc7faaf7/attachments/691b67f15167a9dd4042de72/download/heavenlywind-ezgif.com-crop.gif" },
            { "name": "Gale Punch", "desc": "not the same as real deep one", "req": { "Galebreathe": 30 }, "gif": "https://trello.com/1/cards/68cf8b422d1e4b6dfc7faaf7/attachments/691b680a848d67ae0b7ed132/download/Galepunch-ezgif.com-crop.gif" },
            { "name": "Rising Wind", "desc": "Rising flame's best friend", "req": { "Galebreathe": 30 }, "gif": "https://trello.com/1/cards/68cf8b422d1e4b6dfc7faaf7/attachments/691b681c57537bf19fd1cd63/download/RisingWind-ezgif.com-crop.gif" },
            { "name": "Wind Gun", "desc": "Blast/Multiplying Spark available. DM me or Ping me if u got gifs", "req": { "Galebreathe": 30 }, "gif": "https://trello.com/1/cards/68cf8b422d1e4b6dfc7faaf7/attachments/691b68f0df918f213010d184/download/Windgun-ezgif.com-crop.gif" },
            { "name": "Champion’s Whirlthrow", "desc": "Spinning throw that gbs.", "req": { "Galebreathe": 30 }, "gif": "https://trello.com/1/cards/68cf8b422d1e4b6dfc7faaf7/attachments/691b682f2183b78ed4a27cbf/download/Champwhirlthrow-ezgif.com-crop.gif" },
            { "name": "Wind Carve", "desc": "Slicing wind waves.", "req": { "Galebreathe": 30 }, "gif": "https://trello.com/1/cards/68cf8b422d1e4b6dfc7faaf7/attachments/691b6842e3d6fb21eb997981/download/Windcarve-ezgif.com-crop.gif" },
            { "name": "Gale Wisp", "desc": "Wind companion.", "req": { "Galebreathe": 30 }, "gif": "https://trello.com/1/cards/68cf8b422d1e4b6dfc7faaf7/attachments/691b6919bfa2b665955c7c92/download/Galewisp-ezgif.com-crop.gif" },
            { "name": "Wind Passage", "desc": "Teleporting wind strike.", "req": { "Galebreathe": 50 }, "gif": "https://trello.com/1/cards/68cf8b422d1e4b6dfc7faaf7/attachments/691b68551f884b58cbd51655/download/Windpassage-ezgif.com-crop.gif" },
            { "name": "Astral Wind", "desc": "top 3 mantras of all time", "req": { "Galebreathe": 50 }, "gif": "https://trello.com/1/cards/68cf8b422d1e4b6dfc7faaf7/attachments/691b686587d386959f425909/download/Astralwind-ezgif.com-crop.gif" },
            { "name": "Talon Gale", "desc": "he tryna be rising wind but fails", "req": { "Galebreathe": 50, "Agility": 20 }, "gif": "https://media.discordapp.net/attachments/1142173279029829820/1452263587044266085/RobloxStudioBeta_LMiiDnO9MO.gif?ex=69492d5c&is=6947dbdc&hm=1fa4883911fa600aceebb89d76033fb4f82e3de69ff4dad0786ae41f49d24998&=&width=718&height=581" }
        ],
        "Thundercall": [
            { "name": "Jolt Grab", "desc": "Electric grab attack.", "req": { "Thundercall": 1 }, "gif": "https://trello.com/1/cards/68cf8b4724b83fac7cbdf9ec/attachments/691b69e7a0a869e0e2bbb8d3/download/Joltgrab-ezgif.com-crop.gif" },
            { "name": "Lightning Blade", "desc": "Two lightning slashes.", "req": { "Thundercall": 1 }, "gif": "https://trello.com/1/cards/68cf8b4724b83fac7cbdf9ec/attachments/691b6a3ddb1d6a5e8747bd4a/download/Lightningblade-ezgif.com-crop.gif" },
            { "name": "Lightning Beam", "desc": "Fast lightning beam.", "req": { "Thundercall": 1 }, "gif": "https://trello.com/1/cards/68cf8b4724b83fac7cbdf9ec/attachments/691b6a5e673ed0df2d1477cb/download/Lightningbeam-ezgif.com-crop.gif" },
            { "name": "Thunder Kick", "desc": "lightning kick that gbs.", "req": { "Thundercall": 20 }, "gif": "https://trello.com/1/cards/68cf8b4724b83fac7cbdf9ec/attachments/691b6a748011e90ce0cd53c8/download/Thunderkick-ezgif.com-crop.gif" },
            { "name": "Lightning Impact", "desc": "Lightning ground slam.(WARNING: VERY DELAYED)", "req": { "Thundercall": 20 }, "gif": "https://trello.com/1/cards/68cf8b4724b83fac7cbdf9ec/attachments/691b6aa558f6755c24dad516/download/Lightningimpact-ezgif.com-crop.gif" },
            { "name": "Fleeting Sparks", "desc": "Burst of 3 to 5 electrical balls.", "req": { "Thundercall": 20 }, "gif": "https://trello.com/1/cards/68cf8b4724b83fac7cbdf9ec/attachments/691b6ad0a3234b1ae625f2cf/download/Fleetingsparks-ezgif.com-crop.gif" },
            { "name": "Grand Javelin", "desc": "Massive lightning spear.(this is just pika-pika no mi)", "req": { "Thundercall": 30 }, "gif": "https://trello.com/1/cards/68cf8b4724b83fac7cbdf9ec/attachments/691b6ae65d4526c223c2dd69/download/Grandjavelin-ezgif.com-crop.gif" },
            { "name": "Thunder Wisp", "desc": "Electric companion.", "req": { "Thundercall": 30 }, "gif": "https://trello.com/1/cards/68cf8b4724b83fac7cbdf9ec/attachments/691b6ba0ece67f35ef470217/download/Thunderwisp-ezgif.com-crop.gif" },
            { "name": "Storm Blades", "desc": "Circle of lighting blades.", "req": { "Thundercall": 30 }, "gif": "https://trello.com/1/cards/68cf8b4724b83fac7cbdf9ec/attachments/691b6b0ad29526a1189ddfc2/download/Stormblades-ezgif.com-crop.gif" },
            { "name": "Electro Carve", "desc": "Large lightning AOE attack (i hate you if you use this)", "req": { "Thundercall": 50 }, "gif": "https://trello.com/1/cards/68cf8b4724b83fac7cbdf9ec/attachments/691b6b2d1fb7aa7cb9d0be84/download/Electrocarve-ezgif.com-crop.gif" },
            { "name": "Rising Thunder", "desc": "Launches the user with lightning to do a barrage of lightning attacks (idk how to explain it).", "req": { "Thundercall": 50 }, "gif": "https://trello.com/1/cards/68cf8b4724b83fac7cbdf9ec/attachments/691b6b5217adcab102d9d67f/download/Risingthunder-ezgif.com-crop.gif" },
            { "name": "Emotion Wave", "desc": "Expanding wave of electricity.(please dont use this mantra)", "req": { "Thundercall": 50 }, "gif": "https://trello.com/1/cards/68cf8b4724b83fac7cbdf9ec/attachments/691b6b71e35bca6b93f1ea33/download/Emotionwave-ezgif.com-crop.gif" }
        ],
        "Shadowcast": [
            { "name": "Dark Blade", "desc": "3 shadow slashes.", "req": { "Shadowcast": 1 }, "gif": "https://trello.com/1/cards/68cf8a04ee0c7285c803c03a/attachments/691b73b7daa9cc3191f21ac7/download/darkblade-ezgif.com-crop.gif" },
            { "name": "Clutching Shadow", "desc": "Grab from the abyss.(cold description ik)", "req": { "Shadowcast": 1 }, "gif": "https://trello.com/1/cards/68cf8a04ee0c7285c803c03a/attachments/691b73fdcaf729a4812b9b97/download/Clutchingshadow-ezgif.com-crop.gif" },
            { "name": "Shadow Gun", "desc": "Ranged shadow shot.", "req": { "Shadowcast": 1 }, "gif": "https://trello.com/1/cards/68cf8a04ee0c7285c803c03a/attachments/691b741a648277c53e238feb/download/Shadowgun-ezgif.com-crop.gif" },
            { "name": "shadoww gun (blast spark)", "desc": "ceros.", "req": { "Shadowcast": 1 }, "gif": "https://media.discordapp.net/attachments/1142173279029829820/1452264472876945623/RobloxStudioBeta_YpGxwdg0W0.gif?ex=69492e30&is=6947dcb0&hm=91184210793bbef4e3183f9bde0f783c8fcc9e4a27a80907754c74af524c266c&=&width=644&height=530" },
            { "name": "Shadow Eruption", "desc": "Blast of shadow infused in your blade.", "req": { "Shadowcast": 20 }, "gif": "https://trello.com/1/cards/68cf8a04ee0c7285c803c03a/attachments/691b748a8b2becfe84cd8ebb/download/Shadoweruption-ezgif.com-crop.gif" },
            { "name": "Shadow Seekers", "desc": "Homing shadow orbs.", "req": { "Shadowcast": 20 }, "gif": "https://trello.com/1/cards/68cf8a04ee0c7285c803c03a/attachments/691b74adf39873020a782b60/download/Shadowseekers-ezgif.com-crop.gif" },
            { "name": "Shadow Flux", "desc": "Surrounding aura of darkness.", "req": { "Shadowcast": 20 }, "gif": "https://trello.com/1/cards/68cf8a04ee0c7285c803c03a/attachments/691b74d8ecb525ad102126f6/download/shadowflux-ezgif.com-crop.gif" },
            { "name": "Shadow Assault", "desc": "Dashing shadow attack.", "req": { "Shadowcast": 30 }, "gif": "https://trello.com/1/cards/68cf8a04ee0c7285c803c03a/attachments/691b756d3404d8b417ed1c09/download/shadowassault-ezgif.com-crop.gif" },
            { "name": "Shade Wisp", "desc": "Dark companion.", "req": { "Shadowcast": 30 }, "gif": "https://trello.com/1/cards/68cf8a04ee0c7285c803c03a/attachments/691b75806c325f19b8a9eba8/download/shadewisp-ezgif.com-crop.gif" },
            { "name": "Rising Shadow (Base)", "desc": "rising flame enemy.", "req": { "Shadowcast": 30 }, "gif": "https://trello.com/1/cards/68cf8a04ee0c7285c803c03a/attachments/691b744b06a079f6bd42f480/download/Risingshadow-ezgif.com-crop.gif" },
            { "name": "Rising Shadow (Blast Spark)", "desc": "Keeps targets stuck on ground, steals ether.", "req": { "Shadowcast": 30 }, "gif": "https://trello.com/1/cards/68cf8a04ee0c7285c803c03a/attachments/6929cc4a4e16d041898da6c7/download/risingshadowblastspark-ezgif.com-crop.gif" },
            { "name": "Eclipse Kick", "desc": "Brutal shadow kick.", "req": { "Shadowcast": 50, "Strength": 30 }, "gif": "https://trello.com/1/cards/68cf8a04ee0c7285c803c03a/attachments/691b753137b96f5a213c227a/download/Eclipse_Kick-ezgif.com-optimize.gif" },
            { "name": "Shade Bringer", "desc": "Massive shadow slash.", "req": { "Shadowcast": 50 }, "gif": "https://trello.com/1/cards/68cf8a04ee0c7285c803c03a/attachments/691b74f91d950922f160376e/download/shadebringer-ezgif.com-crop.gif" },
            { "name": "shadow meteors", "desc": "3 shadow meteors.", "req": { "Shadowcast": 30 }, "gif": "https://media.discordapp.net/attachments/1142173279029829820/1452263696108749002/RobloxStudioBeta_3bLvt6kYSn.gif?ex=69492d76&is=6947dbf6&hm=f878ddd667b1cabb2dd82b2a2391b2bd68bb60d291ad554ac79217f847919ae5&=&width=820&height=571" },
            { "name": "umbral slash", "desc": "Very basic shadow-infused slash", "req": { "Shadowcast": 30 }, "gif": "https://media.discordapp.net/attachments/1142173279029829820/1452263808042012733/RobloxStudioBeta_zZcfYb1rAR.gif?ex=69492d91&is=6947dc11&hm=d59004d8f24af7134a8ae3ca5a7c15dd646521cabef33b9593ac57b5f622c49b&=&width=716&height=560" },
        ],
        "Ironsing": [
            { "name": "Metal Slash", "desc": "Basic iron slashes.", "req": { "Ironsing": 1 }, "gif": "https://trello.com/1/cards/68cf8b4b09f2fd31e820ec1a/attachments/691b762ae39b6fef749afca9/download/Metal_Slash-ezgif.com-video-to-gif-converter.gif" },
            { "name": "Metal Kick", "desc": "Spring Spark variant available. dm me or ping me if u got the gif", "req": { "Ironsing": 20 }, "gif": "https://trello.com/1/cards/68cf8b4b09f2fd31e820ec1a/attachments/691b76f7517ef4ed2d73e96e/download/metalkick-ezgif.com-crop.gif" },
            { "name": "Caltrops", "desc": "Deploy spike traps.(fuckass mantra)", "req": { "Ironsing": 20 }, "gif": "https://trello.com/1/cards/68cf8b4b09f2fd31e820ec1a/attachments/691b771568111857c62ed65c/download/caltrops-ezgif.com-crop.gif" },
            { "name": "Metal Fakeout", "desc": "Iron backshots.", "req": { "Ironsing": 20 }, "gif": "https://trello.com/1/cards/68cf8b4b09f2fd31e820ec1a/attachments/691b769eadadb60bfd220e1f/download/Metal_fakeout-ezgif.com-crop.gif" },
            { "name": "Metal Ball", "desc": "Launch yourself as an iron sphere.", "req": { "Ironsing": 20 }, "gif": "https://trello.com/1/cards/68cf8b4b09f2fd31e820ec1a/attachments/691b76cc782e4d10bc843ad6/download/metalball-ezgif.com-crop.gif" },
            { "name": "Iron Quills", "desc": "Burst of metal spikes.", "req": { "Ironsing": 20 }, "gif": "https://trello.com/1/cards/68cf8b4b09f2fd31e820ec1a/attachments/691b77368345ecfd1319d75d/download/ironquills-ezgif.com-crop.gif" },
            { "name": "Oxidizing Rush", "desc": "Fast metallic charge.", "req": { "Ironsing": 20 }, "gif": "https://trello.com/1/cards/68cf8b4b09f2fd31e820ec1a/attachments/691b777746294d80bc31f932/download/Oxidizingrush-ezgif.com-crop.gif" },
            { "name": "Metal Wisp", "desc": "Iron companion.", "req": { "Ironsing": 20 }, "gif": "https://trello.com/1/cards/68cf8b4b09f2fd31e820ec1a/attachments/691b78bc9ec33a556e1054b9/download/metalwisp-ezgif.com-crop.gif" },
            { "name": "Rocket Lance", "desc": "Metal piercing combo extender.", "req": { "Ironsing": 20 }, "gif": "https://trello.com/1/cards/68cf8b4b09f2fd31e820ec1a/attachments/691b7874850e609e878fdb64/download/Rocketlance-ezgif.com-crop.gif" },
            { "name": "Metal Gatling", "desc": "Barrage of iron.", "req": { "Ironsing": 50 }, "gif": "https://trello.com/1/cards/68cf8b4b09f2fd31e820ec1a/attachments/691b7898367de76073911258/download/metalgatling-ezgif.com-crop.gif" },
            { "name": "Iron Hug", "desc": "his hugs are kinda ironic.", "req": { "Ironsing": 50 }, "gif": "https://trello.com/1/cards/68cf8b4b09f2fd31e820ec1a/attachments/691b779a1c4308fe4bed6306/download/ironhug-ezgif.com-crop.gif" },
            { "name": "Iron Slam", "desc": "Massive iron slam.", "req": { "Ironsing": 50 }, "gif": "https://trello.com/1/cards/68cf8b4b09f2fd31e820ec1a/attachments/691b77da60c25f4c6a03fc75/download/ironslam-ezgif.com-crop.gif" },
            { "name": "Metal Armament", "desc": "Coats your weapon in iron.", "req": { "Ironsing": 50 }, "gif": "https://trello.com/1/cards/68cf8b4b09f2fd31e820ec1a/attachments/691b785b1ecb57036edac0b3/download/Metalarmament-ezgif.com-crop.gif" }
        ],
        "Bloodrend": [
            { "name": "Blood Orb", "desc": "Multiplying Spark available. dm me or ping me if u got the gif", "req": { "Bloodrend": 1 }, "gif": "https://trello.com/1/cards/68cf8b5295fc8b6a1568616b/attachments/691b78f70cca666299feab00/download/bloodorb-ezgif.com-crop.gif" },
            { "name": "Blood Beam", "desc": "choso aba move.", "req": { "Bloodrend": 1 }, "gif": "https://trello.com/1/cards/68cf8b5295fc8b6a1568616b/attachments/691b7914b5c4c36300631619/download/bloodbeam-ezgif.com-crop.gif" },
            { "name": "Blood Explosion", "desc": "dont use this shit.", "req": { "Bloodrend": 1 }, "gif": "https://trello.com/1/cards/68cf8b5295fc8b6a1568616b/attachments/691b7931004fd802aa749121/download/bloodexplosion-ezgif.com-crop.gif" },
            { "name": "Scarlet Cyclone", "desc": "blood tornado", "req": { "Bloodrend": 1 }, "gif": "https://trello.com/1/cards/68cf8b5295fc8b6a1568616b/attachments/691b794eeafb369e33db0522/download/scarletcyclone-ezgif.com-crop.gif" },
            { "name": "multiplying spark scarlet cyclone", "desc": "3 tornados instead of one!.", "req": { "Bloodrend": 50 }, "gif": "https://media.discordapp.net/attachments/1142173279029829820/1452264071184257198/RobloxStudioBeta_tv0Vpqqk4p.gif?ex=69492dd0&is=6947dc50&hm=06233d5060a8d8a0e3e850a4b5d38c30ac3a90337d04ee663580fcb3dee8146a&=&width=646&height=576" },
            { "name": "reversal spark scarlet cyclone", "desc": "the tornado noww comes back to you", "req": { "Bloodrend": 50 }, "gif": "https://media.discordapp.net/attachments/1142173279029829820/1452264295864733736/RobloxStudioBeta_U0vJuPcBDz.gif?ex=69492e05&is=6947dc85&hm=ff6820651bdf80f856670c55ce6833e8cf3fc80aaeb51632c930f9fa86f4d7a6&=&width=493&height=514" },
            { "name": "Bloodedge", "desc": "Blade of hardened blood. Works like gale lunge", "req": { "Bloodrend": 20 }, "gif": "https://trello.com/1/cards/68cf8b5295fc8b6a1568616b/attachments/691b796a69f256eaca966789/download/bloodedge-ezgif.com-crop.gif" },
            { "name": "Vicious Descent", "desc": "Dropping strike from above.", "req": { "Bloodrend": 20 }, "gif": "https://trello.com/1/cards/68cf8b5295fc8b6a1568616b/attachments/691b798a347720f0882b8b81/download/visciousdescent-ezgif.com-crop.gif" },
            { "name": "Exorcism", "desc": "Purging blood blast.", "req": { "Bloodrend": 20 }, "gif": "https://trello.com/1/cards/68cf8b5295fc8b6a1568616b/attachments/691b799b81a2973c71abcfe3/download/exorcism-ezgif.com-crop.gif" },
            { "name": "Blood Eruption", "desc": "3 blood explosions fused together.", "req": { "Bloodrend": 20 }, "gif": "https://trello.com/1/cards/68cf8b5295fc8b6a1568616b/attachments/691b79d9eafa8197f4d2b1c9/download/blooderuption-ezgif.com-crop.gif" },
            { "name": "Crimson Rain", "desc": "Summon alot of blood daggers. Cast the mantra again to recall them", "req": { "Bloodrend": 30 }, "gif": "https://trello.com/1/cards/68cf8b5295fc8b6a1568616b/attachments/691b7a0d96df60907c528db2/download/crimsonrain-ezgif.com-crop.gif" },
            { "name": "Blood Crucifixion", "desc": "dark vader move.", "req": { "Bloodrend": 30 }, "gif": "https://trello.com/1/cards/68cf8b5295fc8b6a1568616b/attachments/691b7a287f6d3b402f428ccb/download/Bloodcrucifixion-ezgif.com-crop.gif" },
            { "name": "Blood Wisp", "desc": "Blood companion.", "req": { "Bloodrend": 30 }, "gif": "https://trello.com/1/cards/68cf8b5295fc8b6a1568616b/attachments/691b7a4c1102749323a7611a/download/bloodwisp-ezgif.com-crop.gif" },
            { "name": "Razor Blitz", "desc": "he tryna be rising flame.", "req": { "Bloodrend": 30 }, "gif": "https://trello.com/1/cards/68cf8b5295fc8b6a1568616b/attachments/691b7a62dd13b3b4de6837f6/download/razorblitz-ezgif.com-crop.gif" },
            { "name": "Artery Rip", "desc": "Devastating close range rip.", "req": { "Bloodrend": 50 }, "gif": "https://trello.com/1/cards/68cf8b5295fc8b6a1568616b/attachments/691b7a8b4232ae16780f9127/download/arteryrip-ezgif.com-crop.gif" }
        ],
        "Earthbend": [
            { "name": "Earth Block", "desc": "Two-hit move.", "req": { "Earthbend": 1 }, "gif": "https://trello.com/1/cards/68cf8b4ef926bc1f78ef0cde/attachments/691b7bee3be8ecfab9341cbd/download/earthblockrange-ezgif.com-crop.gif" },
            { "name": "Earth Pillars", "desc": "Throw pillar of rocks at ppl, peak right?", "req": { "Earthbend": 1 }, "gif": "https://trello.com/1/cards/68cf8b4ef926bc1f78ef0cde/attachments/691b7c15b6188ee2f6f6f079/download/earthpillars-ezgif.com-crop.gif" },
            { "name": "Shatter Throw", "desc": "Throw only two rocks.", "req": { "Earthbend": 20 }, "gif": "https://trello.com/1/cards/68cf8b4ef926bc1f78ef0cde/attachments/691b7c4796ba56d41514585d/download/shatterthrow-ezgif.com-crop.gif" },
            { "name": "Crushing Slam", "desc": "Heavy rock slam.", "req": { "Earthbend": 30 }, "gif": "https://trello.com/1/cards/68cf8b4ef926bc1f78ef0cde/attachments/691b7c6a23973f37f1366ad7/download/crushingslam-ezgif.com-crop.gif" },
            { "name": "Pillar Barrage", "desc": "Continuous earth pillar barrages.", "req": { "Earthbend": 30 }, "gif": "https://trello.com/1/cards/68cf8b4ef926bc1f78ef0cde/attachments/691b7c94fc3b70c74fa709ff/download/Pillar_Barrage-ezgif.com-crop.gif" },
            { "name": "Rocker Punch", "desc": "Earth-infused punch.", "req": { "Earthbend": 30 }, "gif": "https://trello.com/1/cards/68cf8b4ef926bc1f78ef0cde/attachments/691b7cb85caa0547a2614c6a/download/rockerpunch-ezgif.com-crop.gif" },
            { "name": "Elbow Strike", "desc": "Ex-strike ripoff.", "req": { "Earthbend": 30 }, "gif": "https://trello.com/1/cards/68cf8b4ef926bc1f78ef0cde/attachments/691b7cd06e4e9603f7dc5416/download/elbowstrike-ezgif.com-crop.gif" },
            { "name": "Compress", "desc": "gb ppl with two walls", "req": { "Earthbend": 50 }, "gif": "https://trello.com/1/cards/68cf8b4ef926bc1f78ef0cde/attachments/691b7cc9ce5d51236520103e/download/compress-ezgif.com-crop.gif" },
            { "name": "Rock Flow", "desc": "Moving earth wave. works like gale lunge", "req": { "Earthbend": 50 }, "gif": "https://trello.com/1/cards/68cf8b4ef926bc1f78ef0cde/attachments/691b7ceba2334ac1b9b2cd13/download/rockflow-ezgif.com-crop.gif" },
            { "name": "Hard Impact", "desc": "battleground ahhh mantra", "req": { "Earthbend": 50 }, "gif": "https://media.discordapp.net/attachments/1142173279029829820/1452263290771083264/RobloxStudioBeta_Ab7RrgY3nl.gif?ex=69492d16&is=6947db96&hm=13d8682c223f03e0c11dd220eec2512730a8b2ee2acb76fbddffe3aa1e078f99&=&width=433&height=411" },
            { "name": "Formation", "desc": "Create homing pillars that deals too much dmg", "req": { "Earthbend": 50 }, "gif": "https://media.discordapp.net/attachments/1142173279029829820/1452263430005325846/RobloxStudioBeta_cVjDBUl7mx.gif?ex=69492d37&is=6947dbb7&hm=88b986bd85b42e43e29050bd20b08c22013d29212acbd58f71b0d76eccd52464&=&width=356&height=515" }
        ],
        "Hybrid Mantras": [
            { "name": "Vivisect", "desc": "Blood and shadow fusion.", "req": { "Bloodrend": 50, "Shadowcast": 30 }, "gif": "https://trello.com/1/cards/691b7d11431876c5b273c5db/attachments/691b7d221275122b130e9b4d/download/vivisect-ezgif.com-crop.gif" },
            { "name": "Soul Beam", "desc": "Requires Oathless. Fusion of all elements.", "req": { "Flamecharm": 30, "Frostdraw": 30, "Thundercall": 30, "Shadowcast": 30, "Galebreathe": 30, "Ironsing": 30, "Bloodrend": 30 }, "gif": "https://media.discordapp.net/attachments/1142173279029829820/1452264665038983168/RobloxStudioBeta_RogMqjruF7.gif?ex=69492e5d&is=6947dcdd&hm=becd7b4f0d3c40e768f338dd09427ffb2c80864575d911a7d2fba84723714b16&=&width=429&height=500" }
        ],
        "Attunementless": [
            { "name": "Breeze Blitz", "desc": "Extends with that one Talent.", "req": { "Light Weapon": 40 }, "gif": "https://trello.com/1/cards/690e78bd709c72616adb9145/attachments/691b7fb66ed634af015422ae/download/breezeextend-ezgif.com-crop.gif" },
            { "name": "Strong Left", "desc": "one punch man mantra", "req": { "Strength": 10 }, "gif": "https://trello.com/1/cards/690e78bd709c72616adb9145/attachments/692737b491d651bff4802647/download/300px-Strong_left_Attunmentless___Deepwoken_Arena_Wiki.gif" },
            { "name": "Rapid Punches", "desc": "barrage of punchs", "req": { "Strength": 30 }, "gif": "https://trello.com/1/cards/690e78bd709c72616adb9145/attachments/692737a63ade2bf1d6c7e893/download/300px-Rapid_punches_Attunmentless___Deepwoken_Arena_Wiki.gif" },
            { "name": "Skyshatter Kick", "desc": "two gb kicks that AT LEAST deal a bar", "req": { "Strength": 80 }, "gif": "https://trello.com/1/cards/690e78bd709c72616adb9145/attachments/6927379fc1db12a2630360a6/download/300px-Skyshatter_Kick_Attunmentless___Deepwoken_Arena_Wiki.gif" },
            { "name": "Precise Slashes", "desc": "Dashing barrage of slashes.", "req": { "Precision": 20 }, "gif": "https://trello.com/1/cards/690e78bd709c72616adb9145/attachments/692737e072ad98da9cfd1591/download/300px-Precise_slashes_Attunmentless___Deepwoken_Arena_Wiki.gif" },
            { "name": "Controlled Punch", "desc": "Focused strike that moves you forward.", "req": { "Precision": 20 }, "gif": "https://trello.com/1/cards/6929bbdbf90a3014494e1169/download/2025-11-2810-05-02-ezgif.com-video-to-gif-converter.gif" },
            { "name": "Shoulder Bash", "desc": "Charging bash.", "req": { "Fortitude": 20 }, "gif": "https://trello.com/1/cards/690e78bd709c72616adb9145/attachments/692738043806879911e152df/download/300px-Shoulder_bash_Attunmentless___Deepwoken_Arena_Wiki.gif" },
            { "name": "Reinforce", "desc": "Stat buff + free heal.", "req": { "Fortitude": 50 }, "gif": "https://trello.com/1/cards/690e78bd709c72616adb9145/attachments/69273806176d8f57629165ba/download/300px-Reinforce_Attunmentless___Deepwoken_Arena_Wiki.gif" },
            { "name": "Revenge", "desc": "top 3 mantras", "req": { "Agility": 1 }, "gif": "https://trello.com/1/cards/690e78bd709c72616adb9145/attachments/692738443c466c12d2a02d3b/download/Revenge_Attunmentless___Deepwoken_Arena_Wiki.gif" },
            { "name": "Adrenaline Surge", "desc": "Increases Movement Speed + swingspeed if you have that one talent.", "req": { "Agility": 20 }, "gif": "https://trello.com/1/cards/690e78bd709c72616adb9145/attachments/69273d9bbfa287da4af2656f/download/2025-11-2612-47-48-ezgif.com-video-to-gif-converter.gif" },
            { "name": "Dash", "desc": "dash.", "req": { "Agility": 40 }, "gif": "https://trello.com/1/cards/690e78bd709c72616adb9145/attachments/69273853d19087346402c5e8/download/300px-Dash_Attunmentless___Deepwoken_Arena_Wiki.gif" },
            { "name": "Shadestep", "desc": "cooler dash.", "req": { "Agility": 60 }, "gif": "https://trello.com/1/cards/690e78bd709c72616adb9145/attachments/6927385f52fbed3237fd6d86/download/300px-Shadestep_Attunmentless___Deepwoken_Arena_Wiki.gif" },
            { "name": "Ambush", "desc": "Sneaky attack.", "req": { "Light Weapon": 60 }, "gif": "https://trello.com/1/cards/690e78bd709c72616adb9145/attachments/6929bb18d3745fd64c37cc1f/download/2025-11-2810-04-43-ezgif.com-video-to-gif-converter.gif" },
            { "name": "Prediction", "desc": "Engi's favorite mantra.", "req": { "Intelligence": 50 }, "gif": "https://trello.com/1/cards/690e78bd709c72616adb9145/attachments/69273c719db6bd932a20517c/download/Prediction-ezgif.com-crop.gif" },
            { "name": "Exhaustion Strike", "desc": "best mantra oath.", "req": { "Willpower": 40 }, "gif": "https://trello.com/1/cards/690e78bd709c72616adb9145/attachments/69273c8b899fefbb14665738/download/Exhaustion-ezgif.com-crop.gif" },
            { "name": "Glare", "desc": "Intimidate targets (gives insanity to you for some fuckass reason).", "req": { "Willpower": 60 }, "gif": "https://trello.com/1/cards/690e78bd709c72616adb9145/attachments/69273dff3c8f1cf7f0925558/download/2025-11-2612-49-40-ezgif.com-video-to-gif-converter.gif" },
            { "name": "Lunatism", "desc": "Sets people to Max Insanity.", "req": { "Willpower": 100 }, "gif": "https://trello.com/1/cards/690e78bd709c72616adb9145/attachments/69273e13474ba56e3cbdea9a/download/2025-11-2612-49-33-ezgif.com-video-to-gif-converter.gif" },
            { "name": "Sing", "desc": "Charm ppl with your voice.", "req": { "Charisma": 25 }, "gif": "https://trello.com/1/cards/690e78bd709c72616adb9145/attachments/69273caa6c8bb8e190ba194b/download/Sing-ezgif.com-crop.gif" },
            { "name": "Taunt", "desc": "Increases DMG Dealt and Taken.", "req": { "Charisma": 25 }, "gif": "https://trello.com/1/cards/690e78bd709c72616adb9145/attachments/69273cac82313121e2f36240/download/Taunt-ezgif.com-crop.gif" },
            { "name": "Flashdraw Strike", "desc": "Swift weapon attack.", "req": { "Agility": 25, "Medium Weapon": 50 }, "gif": "https://trello.com/1/cards/691b7e1198f2c19343c7d07c/attachments/691b7ea5ad05f34cd4756dae/download/flashdraw-ezgif.com-crop.gif" },
            { "name": "Air Rending", "desc": "Annoying tp move.", "req": { "Strength": 25, "Light Weapon": 40 }, "gif": "https://trello.com/1/cards/691b7e1198f2c19343c7d07c/attachments/691b7eb599b0ac7874b7c39a/download/Air_rending-ezgif.com-crop.gif" },
            { "name": "Skyshatter Pierce", "desc": "High impact piercing (windup so slow).", "req": { "Strength": 30, "Precision": 50 }, "gif": "https://trello.com/1/cards/691b7e1198f2c19343c7d07c/attachments/691b7eb9b2a8170eedbeae9e/download/Skyshatter_Pierce-ezgif.com-crop.gif" },
            { "name": "Twinstrikes", "desc": "basic double kicks.", "req": { "Agility": 40, "Strength": 60 }, "gif": "https://trello.com/1/cards/691b7e1198f2c19343c7d07c/attachments/6929bb75e2e60ae15a382243/download/2025-11-2810-05-15-ezgif.com-video-to-gif-converter.gif" }]
    }
};

const calcData = {
    dmg: [
        { n: "Flame Within", v: 10, cat: "UB_PB" }, { n: "Speed Demon", v: 7.5, cat: "WB_TB" }, { n: "Lose Your Mind", v: 10, cat: "UB_PB" }, { n: "Decisive Battle", v: 10, cat: "UB_TB" }, { n: "Perfect Flash", v: 25, cat: "MB_TB" }, { n: "Eureka", v: 10, cat: "MB_TB" }, { n: "Overflowing Dam", v: 10, cat: "WB_PB" }, { n: "Ardour Scream", v: 25, cat: "UB_TB" }, { n: "Underdog", v: 4, cat: "UB_PB" }, { n: "Tough Love", v: 10, cat: "UB_PB" }, { n: "Manipulator", v: 20, cat: "UB_PB" }, { n: "Matador", v: 20, cat: "UB_TB" }, { n: "Knife's Journey", v: 15, cat: "WB_TB" }, { n: "Rush Hours", v: 15, cat: "UB_PB" }, { n: "Reshape and Remold", v: 5, cat: "UB_PB" }, { n: "Exposed Durability", v: 10, cat: "UB_PB" }, { n: "Reinforce Mantra", v: 3, cat: "UB_TB" }, { n: "Raiton Path", v: 10, cat: "UB_PB" }
    ],
    pen: [
        { n: "Million Ton Piercer", v: 5 }, { n: "Dead Eye", v: 10 }, { n: "Upcoming Opportunity", v: 30 }, { n: "Cheap Shot", v: 10 }, { n: "Ether Overdrive", v: 5 }, { n: "Piercing Will", v: 15 }, { n: "Cult of Personality", v: 15 }, { n: "Sturdy Control", v: 15 }, { n: "Tooth and Claw", v: 20 }, { n: "Dancing With The Dead", v: 2.5 }
    ]
};

// --- 2. GLOBAL STATE & MAPS ---
let userStats = {};
let selectedTalents = new Set();
let selectedMantras = new Set();
let activeBuffs = new Set();
let collapsedCats = new Set();
let currentTab = 'talents';

// Short-link mapping setup
const talentList = Object.values(gameData.talents).flat();
const mantraList = Object.values(gameData.mantras).flat();
const talentMap = talentList.map(t => t.name);
const mantraMap = mantraList.map(m => m.name);
const allStatKeys = [...gameData.attributes, ...gameData.attunements];

const mutualExclusions = [
    ["Simple Path: Electrocution", "Raiton Path: Enlightened", "Surge Path: Unstable Capacitor"],
    ["Unyielding Frost", "Glass Path: Crystallization"],
    ["The Final Act", "Emperor Flame", "Eruption Path: Lava Serpent"],
    ["Gilded Path: Scrapsinger", "Decay Path: Oxidize"],
    ["Manipulation Path: Spirit Lantern", "Manipulation Path: Agile Misery", "Simple Manipulation: Unstable Blood"],
    ["Wraith Path: Umbra", "Eruption Path: Lava Serpent", "Flashboil"],
    ["Flashboil", "Glass Path: Crystallization"],
    ["Narcissist", "Tough Love"]
];

// --- 3. INITIALIZATION ---
function init() {
    const splash = ["hold it, this guy is cooking", "time for a shower twin", "DNI deepwoken classic", "Yzord NPC gives spec enchants and weps. however, you need to be whitelisted", "?timeout @nebula 27d ramadan", "FUCK MY LIFE NIGGA IM JUST A RETARD INCEL WHORE", "fart fart fart fart fart", "ping geo for prime kai theme", "bugs? dm or ping @faithandpray", "take a break","im a fat greasy pig", "TEST EVERYTHING FOR ME PLEASE IM BEGGING YOU"];
    const splashEl = document.getElementById('splash-text');
    if(splashEl) splashEl.innerText = splash[Math.floor(Math.random() * splash.length)];

    const core = document.getElementById('core-inputs');
    const att = document.getElementById('att-inputs');
    if(core) core.innerHTML = ""; 
    if(att) att.innerHTML = "";

    gameData.attributes.forEach(a => {
        userStats[a] = 0;
        if(core) core.innerHTML += `<div class="stat-row"><label>${a}</label><input type="number" id="in-${a}" value="0" min="0" max="100" onchange="setStat('${a}', this.value)"></div>`;
    });

    gameData.attunements.forEach(a => {
        userStats[a] = 0;
        if(att) att.innerHTML += `<div class="stat-row"><label>${a}</label><input type="number" id="in-${a}" value="0" min="0" max="100" onchange="setStat('${a}', this.value)"></div>`;
    });

    // Parse URL
    const params = new URLSearchParams(window.location.search);
    if (params.has('b')) {
        try {
            const code = params.get('b');
            const sections = code.split('_');
            if (sections[0]) {
                const statsArr = sections[0].split('.');
                allStatKeys.forEach((key, i) => {
                    let val = parseInt(statsArr[i]) || 0;
                    userStats[key] = val;
                    let inputEl = document.getElementById('in-' + key);
                    if (inputEl) inputEl.value = val;
                });
            }
            if (sections[1]) {
                sections[1].split('-').forEach(b36 => {
                    let name = talentMap[parseInt(b36, 36)];
                    if (name) selectedTalents.add(name);
                });
            }
            if (sections[2]) {
                sections[2].split('-').forEach(b36 => {
                    let name = mantraMap[parseInt(b36, 36)];
                    if (name) selectedMantras.add(name);
                });
            }
        } catch (e) { console.error("URL Load Error", e); }
    }
    updateUI();
}

// --- 4. LOGIC ---
function setStat(name, val) {
    let num = Math.min(100, Math.max(0, parseInt(val) || 0));
    userStats[name] = num;
    let el = document.getElementById('in-' + name);
    if (el) el.value = num;
    updateUI();
}

function updateUI() {
    let count = 0; 
    gameData.attunements.forEach(a => { if (userStats[a] > 0) count++; });
    let max = count === 0 ? 410 : 420 + Math.max(0, (count - 1) * 5);
    let used = 0; 
    Object.values(userStats).forEach(v => used += v);

    const maxPtsEl = document.getElementById('max-pts');
    const usedPtsEl = document.getElementById('used-pts');
    if(maxPtsEl) maxPtsEl.innerText = max;
    if(usedPtsEl) {
        usedPtsEl.innerText = used;
        usedPtsEl.style.color = used > max ? "#ff4444" : "#fff";
    }

    const list = document.getElementById('selection-list');
    if(list) {
        list.innerHTML = "";
        if(selectedTalents.size > 0) {
            list.innerHTML += `<div style="padding:10px; border-bottom:1px solid #000; font-weight:bold;">Talents</div>`;
            selectedTalents.forEach(t => list.innerHTML += `<div style="padding:4px 15px; font-size:0.9rem;">• ${t}</div>`);
        }
        if(selectedMantras.size > 0) {
            list.innerHTML += `<div style="padding:10px; border-bottom:1px solid #000; font-weight:bold; color:#2266aa; margin-top:10px;">Mantras</div>`;
            selectedMantras.forEach(m => list.innerHTML += `<div style="padding:4px 15px; font-size:0.9rem; color:#2266aa;">• ${m}</div>`);
        }
    }
    renderItems();
}

function checkReqs(reqObj) {
    if (!reqObj || Object.keys(reqObj).length === 0) return true;
    for (let r in reqObj) {
        if (r === "OR_Weapon" || r === "Weapon") {
            if (userStats["Light Weapon"] < reqObj[r] && userStats["Medium Weapon"] < reqObj[r] && userStats["Heavy Weapon"] < reqObj[r]) return false;
        } else if ((userStats[r] || 0) < reqObj[r]) return false;
    }
    return true;
}

function toggleItem(name, met) {
    if (!met) return;
    const set = currentTab === 'talents' ? selectedTalents : selectedMantras;
    
    // Safety check for mutual exclusions crash
    if (currentTab === 'talents' && !set.has(name)) {
        for (const group of mutualExclusions) {
            if (group && group.includes(name)) {
                for (const other of group) {
                    if (other !== name && set.has(other)) {
                        alert(`MUTUAL EXCLUSION:\n\nYou already have "${other}".`);
                        return;
                    }
                }
            }
        }
    }

    set.has(name) ? set.delete(name) : set.add(name);
    updateUI();
}

function renderItems() {
    const container = document.getElementById('item-container');
    if(!container) return;
    if (currentTab === 'calc') { renderCalculator(); return; }

    const search = document.getElementById('search-input').value.toLowerCase();
    const showMet = document.getElementById('filter-reqs').checked;
    const dataSet = currentTab === 'talents' ? gameData.talents : gameData.mantras;
    const selectedSet = currentTab === 'talents' ? selectedTalents : selectedMantras;

    container.innerHTML = "";
    for (let cat in dataSet) {
        const isCollapsed = collapsedCats.has(cat);
        let hasItems = false;
        let catHtml = `<div class="category-block ${isCollapsed ? 'collapsed' : ''}"><div class="category-title" onclick="toggleCategory('${cat}')">${cat}</div><div class="grid">`;
        
        dataSet[cat].forEach((item, idx) => {
            let met = checkReqs(item.req);
            if (showMet && !met) return;
            if (item.name.toLowerCase().includes(search) || item.desc.toLowerCase().includes(search)) {
                hasItems = true;
                let safeId = cat.replace(/\s/g, '') + idx;
                let reqFormatted = Object.entries(item.req).map(([k, v]) => `${k === "OR_Weapon" ? "Any Weapon" : k}: ${v}`).join(", ");
                catHtml += `
                    <div class="card ${met ? '' : 'locked'} ${selectedSet.has(item.name) ? 'selected' : ''}" onclick="toggleItem('${item.name}', ${met})">
                        <h3>${item.name}</h3><p>${item.desc}</p><hr>
                        <span class="req-text"><span style="color:#fff">Req:</span> ${reqFormatted || 'None'}</span>
                        ${item.gif ? `<button class="toggle-gif-btn" onclick="toggleGif('${safeId}', event)">Preview</button><div class="gif-container" id="gif-${safeId}"><img src="${item.gif}" loading="lazy"></div>` : ''}
                    </div>`;
            }
        });
        if (hasItems) container.innerHTML += catHtml + `</div></div>`;
    }
}

function renderCalculator() {
    const container = document.getElementById('item-container');
    let html = `<div class="calc-wrapper"><div class="calc-row" style="border-bottom:2px solid #000; justify-content:center; text-transform:uppercase;">Stat Modifiers</div>`;
    calcData.dmg.forEach((b, i) => {
        html += `<div class="calc-row"><label for="d${i}">${b.n} <span>${b.v}% DMG</span></label><input type="checkbox" id="d${i}" ${activeBuffs.has('d'+i)?'checked':''} onchange="toggleBuff('d${i}')"></div>`;
    });
    html += `<div class="calc-row" style="margin-top:20px; border-bottom:2px solid #000; justify-content:center; text-transform:uppercase;">Penetration</div>`;
    calcData.pen.forEach((b, i) => {
        html += `<div class="calc-row"><label for="p${i}">${b.n} <span>${b.v}% PEN</span></label><input type="checkbox" id="p${i}" ${activeBuffs.has('p'+i)?'checked':''} onchange="toggleBuff('p${i}')"></div>`;
    });

    let wPct = 0, mPct = 0, pen = 0;
    activeBuffs.forEach(key => {
        let idx = parseInt(key.slice(1));
        if(key[0]==='d') {
            let b = calcData.dmg[idx];
            if(b.cat.includes('UB') || b.cat.includes('WB')) wPct += b.v;
            if(b.cat.includes('UB') || b.cat.includes('MB')) mPct += b.v;
        } else pen += calcData.pen[idx].v;
    });

    const cap = (p) => {
        let m = 1 + (p/100);
        if(m > 1.25) m = 1.25 + (m-1.25)/2;
        return Math.min(1.5, m).toFixed(3);
    };

    html += `<div class="calc-result-box">
        <strong>Weapon Multiplier:</strong> ${cap(wPct)}x<br>
        <strong>Mantra Multiplier:</strong> ${cap(mPct)}x<br>
        <strong>Total Penetration:</strong> ${pen}%
    </div></div>`;
    container.innerHTML = html;
}

// --- 5. UI UTILITIES ---
function switchTab(t) { currentTab = t; ['talents','mantras','calc'].forEach(id => { let el = document.getElementById('tab-'+id); if(el) el.classList.toggle('active', id===t); }); let searchBar = document.getElementById('search-bar'); if(searchBar) searchBar.style.display = t==='calc'?'none':'block'; updateUI(); }
function toggleBuff(id) { activeBuffs.has(id) ? activeBuffs.delete(id) : activeBuffs.add(id); renderCalculator(); }
function toggleCategory(cat) { collapsedCats.has(cat) ? collapsedCats.delete(cat) : collapsedCats.add(cat); renderItems(); }
function toggleGif(id, e) { e.stopPropagation(); const el = document.getElementById('gif-'+id); if(el) el.style.display = el.style.display === 'block' ? 'none' : 'block'; }
function toggleSidebar(s) { document.body.classList.toggle('sidebar-open-'+s); }
function closeSidebars() { document.body.classList.remove('sidebar-open-left', 'sidebar-open-right'); }
function clearBuild() { if(confirm("Clear build?")) window.location.href = window.location.pathname; }

function saveBuild() {
    const statsPart = allStatKeys.map(k => userStats[k]||0).join('.');
    const tIndices = Array.from(selectedTalents).map(n => talentMap.indexOf(n).toString(36));
    const mIndices = Array.from(selectedMantras).map(n => mantraMap.indexOf(n).toString(36));
    const url = window.location.origin + window.location.pathname + '?b=' + `${statsPart}_${tIndices.join('-')}_${mIndices.join('-')}`;
    navigator.clipboard.writeText(url).then(() => alert("Short link copied!"));
}

window.onload = init;
</script>
</body>
</html>
