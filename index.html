<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Deepwoken modded builder made by taxes/faithandpray</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: radial-gradient(#18221a, #04100d);
            --sidebar-bg: #0a0a0b;
            --parchment: #d8d7ca;
            --parchment-text: #1a1a1a;
            --border-path: url('border.png');
            --border-slice: 10; 
        }

        * { box-sizing: border-box; }
        body { 
            background: var(--bg); color: #fff; font-family: 'Lora', serif; 
            margin: 0; display: flex; height: 100vh; overflow: hidden; 
        }

        #sidebar-left { 
            width: 320px; min-width: 320px; background: var(--sidebar-bg); 
            border-right: 2px solid #2f2f35; padding: 20px; overflow-y: auto; 
        }
        
        #sidebar-right {
            width: 340px; min-width: 340px; background: var(--parchment);
            color: var(--parchment-text); margin: 15px; display: flex; flex-direction: column;
            border: 12px solid transparent; 
            border-image: var(--border-path) var(--border-slice) repeat;
            image-rendering: pixelated;
        }

        #main-area { flex: 1; display: flex; flex-direction: column; padding: 20px; overflow: hidden; }
        #talent-container { flex: 1; overflow-y: auto; padding-right: 10px; }

        .search-bar-container {
            background: rgba(0,0,0,0.3); padding: 15px; border-radius: 4px;
            margin-bottom: 20px; border: 1px solid #333;
        }

        .category-block { margin-bottom: 10px; }
        .category-title { 
            font-size: 1.2rem; border-bottom: 2px solid #333; 
            margin-bottom: 10px; padding: 5px; color: #aaa;
            cursor: pointer; display: flex; justify-content: space-between;
            transition: background 0.2s;
        }
        .category-title:hover { background: rgba(255,255,255,0.05); color: #fff; }
        .category-title::after { content: '▼'; font-size: 0.8rem; opacity: 0.5; }
        .collapsed .category-title::after { content: '▶'; }
        .collapsed .grid { display: none; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; padding: 5px; }

        .card {
            background: rgba(255,255,255,0.03); padding: 10px; cursor: pointer;
            border: 8px solid transparent; 
            border-image: var(--border-path) var(--border-slice) repeat;
            image-rendering: pixelated;
            transition: 0.1s; position: relative;
        }
        .card:hover { transform: translateY(-1px); background: rgba(255,255,255,0.08); }
        .card.locked { 
            background: rgba(0,0,0,0.4); 
            border-color: rgba(255,255,255,0.05);
            opacity: 0.7;
            filter: grayscale(0.5); 
            cursor: not-allowed;
        }
        .card.selected { background: rgba(122, 184, 122, 0.15); border-image-source: url('border_gold.png'); }
        .req-text {
            color: #c2a35d; 
            font-size: 0.75rem;
            margin-top: 8px;
            font-weight: bold;
            letter-spacing: 0.02rem;
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-top: 4px;
        }
        button {
            background: #1a1a1c; border: 1px solid #444; color: #fff;
            padding: 8px 12px; cursor: pointer; font-family: 'Lora'; margin: 2px;
            transition: 0.2s;
        }
        button:hover { background: #333; border-color: #666; }
        .btn-danger:hover { background: #602020; border-color: #ff4444; }

        input[type="number"], input[type="text"] {
            background: #000; border: 1px solid #444; color: #fff; padding: 6px;
        }

        .stat-row { display: flex; justify-content: space-between; margin-bottom: 6px; align-items: center; }
        .selection-item { border-bottom: 1px dashed rgba(0,0,0,0.1); padding: 5px; font-size: 0.9rem; }
        /* Splash Text Styling */
#splash-container {
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 20px;
    perspective: 1000px;
}

#splash-text {
    color: #ffcc00; /* Vibrant Gold */
    font-size: 0.6rem;
    font-weight: bold;
    font-style: italic;
    text-align: center;
    text-shadow: 2px 2px 0px #000;
    animation: splash-pulse 1.5s infinite ease-in-out;
    pointer-events: none;
}

@keyframes splash-pulse {
    0% { transform: scale(1) rotate(-2deg); opacity: 0.8; }
    50% { transform: scale(1.1) rotate(1deg); opacity: 1; }
    100% { transform: scale(1) rotate(-2deg); opacity: 0.8; }
}
    </style>
</head>
<body>

<div id="sidebar-left">
    <h2 style="margin-top:0">Investment</h2>
    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 5px;">
        <span id="used-pts">0</span> / <span id="max-pts">410</span>
    </div>

    <!-- ADD THIS HERE -->
    <div id="splash-container">
        <div id="splash-text"></div>
    </div>

    <div class="category-title" style="font-size: 0.9rem; cursor: default; border: none;">Core Attributes</div>
    <div id="core-inputs"></div>

    <div class="category-title" style="font-size: 0.9rem; margin-top:20px; cursor: default; border: none;">Attunements</div>
    <div id="att-inputs"></div>

    <div style="margin-top: 30px; border-top: 1px solid #333; padding-top: 20px; display: flex; flex-wrap: wrap;">
        <button onclick="saveBuild()">Save Code</button>
        <button onclick="loadBuild()">Load Code</button>
        <button class="btn-danger" onclick="clearBuild()">Clear Build</button>
    </div>
</div>

<div id="main-area">
    <div class="search-bar-container">
        <input type="text" id="search-input" placeholder="Search talents..." oninput="renderTalents()" style="width: 60%;">
        <label style="margin-left: 20px; font-size: 0.85rem;">
            <input type="checkbox" id="filter-reqs" onchange="renderTalents()"> Meet Requirements Only
        </label>
    </div>

    <div id="talent-container"></div>
</div>

<div id="sidebar-right">
    <h3 style="text-align: center; margin-top: 10px;">Selected Talents</h3>
    <div id="selection-list" style="overflow-y: auto; flex: 1; padding: 0 15px;"></div>
</div>

<script>
const gameData = {
    attributes: ["Strength", "Fortitude", "Agility", "Intelligence", "Willpower", "Charisma", "Precision", "Light Weapon", "Medium Weapon", "Heavy Weapon"],
    attunements: ["Flamecharm", "Frostdraw", "Thundercall", "Shadowcast", "Galebreathe", "Ironsing", "Bloodrend", "Earthbend"],
    talents: {
        "No Stat Reqs": [{ "name": "Return to the Dark Ages", "desc": "10% less Outgoing and Incoming Mantra DMG. [5 hp]", "req": {} },{ "name": "Lightweight", "desc": "Move faster when armor is 0%. [+1 Posture]", "req": {} },{ "name": "The Sounds from Below", "desc": "[+150hp]", "req": {} },{ "name": "Armor Conserver", "desc": "15% less armor drain on hit.", "req": {} },{ "name": "Murmur: Ardour", "desc": "Deal 15% more posture DMG and take 15% less when pressing H.", "req": {} }],
        "Strength": [{ "name": "Duelist’s Dance", "desc": "25% more posture from parrying. [+2 Posture]", "req": { "Strength": 20 } },{ "name": "Harsh Response", "desc": "Enemies receive less posture when parrying you.", "req": { "Strength": 25 } },{ "name": "Bulldozer", "desc": "Enemies you flourish into a wall have a chance of breaking the wall and are guard broken on impact.", "req": { "Strength": 25 } },{ "name": "Lose Your Mind", "desc": "Deal more DMG scaling with insanity up to 10% max. [+5 hp]", "req": { "Strength": 30 } },{ "name": "Unwavering Resolve", "desc": "Getting parried punishes your posture 33% less. [+2 Posture]", "req": { "Strength": 40 } },{ "name": "Shield Breaker", "desc": "Blunt Damage now fully ignores the posture from Shields. [+1 Posture]", "req": { "Strength": 60 } },{ "name": "Piercing Blow", "desc": "Guardbreaks Ignore Armor Resistance.", "req": { "Strength": 80 } },{ "name": "Berserk", "desc": "Succumb to the burning rage within, nullifying your own armor in exchange for nullifying the armor of your foes on your Basic Attacks. Grants your Criticals +10% PEN while active.", "req": { "Strength": 80 } },{ "name": "Million Ton Piercer", "desc": "Gain 5% extra PEN and remove the cap on your PEN. Go beyond your limits.", "req": { "Strength": 90 } },{ "name": "Collapsed Lung", "desc": "Block breaking an opponent closes off their ability to Vent for 8s, duration scales with Strength.", "req": { "Strength": 100 } },{ "name": "Dreambreaker", "desc": "On Flourish, Disables Tempo Drain and gives Tempo gain for 10s, Decrease target tempo gain for 7.5s. (Locks Collapsed Lung)", "req": { "Strength": 100 } }],
        "Precision": [{ "name": "Deflecting Handyman", "desc": "Posture Removal cooldown on parry is decreased by 0.25s. [+1 Posture]", "req": { "Precision": 20 } },{ "name": "Dead Eye", "desc": "Opponents who dodge will take 10% PEN on next attack. (8s CD)", "req": { "Precision": 40 } },{ "name": "Deadly Blow", "desc": "After Dodge, +25% Posture DMG for 3s. (10s CD)", "req": { "Precision": 50 } },{ "name": "Successive Strikes", "desc": "M1 Strings and Criticals build up stacks of increased DMG that last 5s, Dead Eye will not cancel on next hit.", "req": { "Precision": 60 } },{ "name": "Decisive Battle", "desc": "Cancelling an opponents block from behind will increase the damage by 10%", "req": { "Precision": 60 } },{ "name": "Close Quarters", "desc": "The first parry in an aerial state won’t knock you back. (20s CD) [+1 Posture]", "req": { "Precision": 75 } },{ "name": "Fatality", "desc": "Guardbreaking an Opponents Stuns them for longer. [+1 Posture]", "req": { "Precision": 80 } },{ "name": "Pinpoint Accuracy", "desc": "Bullets are now faster.", "req": { "Precision": 80 } },{ "name": "Hidden Blade", "desc": "Spine Cutter now applies anti-heal", "req": { "Precision": 80 } },{ "name": "Upcoming Opportunity", "desc": "Uncap PEN + gain 30% PEN for 3s Upon Parry or Dodge. (5s CD)", "req": { "Precision": 90 } }],
        "Fortitude": [{ "name": "Battle Tendency", "desc": "20% faster posture regen.", "req": { "Fortitude": 15 } },{ "name": "Braced Collapse", "desc": "After being block broken, the next attack to hit you deals reduced damage.", "req": { "Fortitude": 25 } },{ "name": "Exoskeleton", "desc": "Natural Armor resists 10% Physical Damage when active. Replenishes when resting.", "req": { "Fortitude": 40 } },{ "name": "To the Finish", "desc": "You take 10% less damage when below 30% health.", "req": { "Fortitude": 50 } },{ "name": "Turtle Shell", "desc": "If your shield is on your back, take reduced backstab damage and negate Spine Cutter.", "req": { "Fortitude": 50 } },{ "name": "Dancing Guard", "desc": "Parrying an opponent and then parrying another enemy in quick succession applies slow for 7s.", "req": { "Fortitude": 55 } },{ "name": "Knuckle Guard", "desc": "Hitting Dazed enemies grants you 10% posture resistance for 15s.", "req": { "Fortitude": 55, "Strength": 25 } },{ "name": "Down to your Level", "desc": "While you have a speed debuff, your Basic Attacks slow your enemies for 5s.", "req": { "Fortitude": 60 } },{ "name": "Defensive Reprisal", "desc": "Being flourished grants you 10% posture resistance for 20s.", "req": { "Fortitude": 65 } },{ "name": "Reinforced Armor", "desc": "Incoming PEN is reduced by 30%.", "req": { "Fortitude": 90 } },{ "name": "Armorclad", "desc": "Flourishing, or Getting Guardbroken gives you slight dmg resistance for 10s.", "req": { "Fortitude": 100 } }],
        "Agility": [{ "name": "Lowstride", "desc": "Crouching stealth and roll distance increased. Smaller speed penalty. Silent weapon draw.", "req": { "Agility": 20 } },{ "name": "Kick Off", "desc": "No damage from short falls. Higher wall jumps. Speed boost after wall jumping.", "req": { "Agility": 20 } },{ "name": "Safety Dance", "desc": "Your base dodge frames are increased by 0.05s.", "req": { "Agility": 20 } },{ "name": "Observation", "desc": "Dodge frames are larger if you cancel your roll immediately.", "req": { "Agility": 20 } },{ "name": "Risky Moves", "desc": "When you successfully dodge, you'll automatically dodge the next attack.", "req": { "Agility": 25 } },{ "name": "Speed Emission", "desc": "Gain a slight speed boost after landing a vent.", "req": { "Agility": 25 } },{ "name": "Speed Demon", "desc": "Your attacks now inflict a reduced-strength bleed while you have a speed boost. 1s cooldown.", "req": { "Agility": 25 } },{ "name": "Blade Dancer", "desc": "Landing a Basic Attack removes your roll cooldown.", "req": { "Agility": 25 } },{ "name": "Deep Wound", "desc": "Assassinating a target applies anti-heal for 20s and gives you a speed boost for 6s.", "req": { "Agility": 35 } },{ "name": "Ghost", "desc": "Dodging a move will briefly make you invisible, ending early if you attack.", "req": { "Agility": 40 } },{ "name": "Lights Out", "desc": "Assassinations give 30% PEN and blind the target for 5s.", "req": { "Agility": 55 } },{ "name": "Tap Dancer", "desc": "Rolling immediately after a roll-cancel no longer puts your roll on a longer cooldown.", "req": { "Agility": 60 } },{ "name": "Unseen Threat", "desc": "Assassinate those with weapons out if not in combat. Targets are slowed and cannot jump for 3s.", "req": { "Agility": 60 } },{ "name": "Cheap Shot", "desc": "Attacks gain 10% PEN multiplicatively with an active speed boost.", "req": { "Agility": 65 } },{ "name": "Down Comes the Claw", "desc": "Landing Critical with speed boost prevents opponent from dodging twice in a row for 5s.", "req": { "Agility": 75 } },{ "name": "Pursuit", "desc": "If you land Revenge, Reset the Cooldown (25s CD)", "req": { "Agility": 90 } },{ "name": "Dustlunge", "desc": "Assassinate from farther via shade stepping. Chain assassinate nearby enemies.", "req": { "Agility": 90 } },{ "name": "Maiming Claws", "desc": "Down Comes the Claw now disables opponent's posture regeneration for 6s on proc.", "req": { "Agility": 100 } }],
        "Intelligence": [{ "name": "Ether Absorption", "desc": "Receive Ether back when inflicted with damage from Mantras.", "req": { "Intelligence": 15 } },{ "name": "Perfect Flash", "desc": "Over 95% health causes mantras to do +25% damage.", "req": { "Intelligence": 25 } },{ "name": "Eureka", "desc": "Gain Inspiration stacks on mantra land/parry. 3 stacks grant +10% Mantra Damage.", "req": { "Intelligence": 30 } },{ "name": "True Ether Bullets", "desc": "Ether Bullets apply elemental damage of highest investment.", "req": { "Intelligence": 30, "Weapon": 20 } },{ "name": "Overflowing Dam", "desc": "Full Ether for 2s grants an aura for 10% more damage.", "req": { "Intelligence": 40 } },{ "name": "Foolish Outburst", "desc": "Blocking or parrying a vent absorbs the Tempo cost of the vent.", "req": { "Intelligence": 50 } },{ "name": "Keen Recovery", "desc": "Basic attack after feinting a mantra restores the feinted mantra's ether cost.", "req": { "Intelligence": 55 } },{ "name": "Prime Ether Bullets", "desc": "Bullets take one less hit to proc elements and have intelligence scaling.", "req": { "Intelligence": 60, "Light": 90 } },{ "name": "Twelve Steps Ahead", "desc": "Landing Prediction halves cooldown; whiffing doubles it.", "req": { "Intelligence": 80 } },{ "name": "Ether Overdrive", "desc": "Gain 5% extra PEN and remove the cap on your PEN.", "req": { "Intelligence": 90, "Elemental": 20 } },{ "name": "Absolute Pitch", "desc": "You can cast ritual mantra’s instantly.", "req": { "Intelligence": 100 } }],
        "Willpower": [{ "name": "Disbelief", "desc": "Resistant to Illusion magic, charms, and tricks.", "req": { "Willpower": 25 } },{ "name": "Magical Resolve", "desc": "Being hit increases ether regen.", "req": { "Willpower": 40 } },{ "name": "Ardour Scream", "desc": "Amplify shout to make victims take 25% more DMG and Posture for 10s.", "req": { "Willpower": 40 } },{ "name": "Underdog", "desc": "Deal more damage to those with higher HP, scales with WIL.", "req": { "Willpower": 50 } },{ "name": "Heretic's Sutra", "desc": "A chant that steers you into the state of Insanity for 20 seconds.", "req": { "Willpower": 80 } },{ "name": "Piercing Will", "desc": "When sanity is below 35%, gain up to +15% PEN.", "req": { "Willpower": 80 } },{ "name": "Psychic", "desc": "Opponents with <50% sanity cannot proc Deep Gems against you briefly.", "req": { "Willpower": 80 } },{ "name": "Shared Misery", "desc": "Attacking while losing sanity causes enemies to lose sanity.", "req": { "Willpower": 90 } },{ "name": "Beleaguered But Unbowed", "desc": "Damage reduction when surrounded by 2 or more opponents.", "req": { "Willpower": 90 } },{ "name": "Sin Stacker", "desc": "All The Dead Gods' duration is based on enemy antiheal stacks.", "req": { "Willpower": 90 } },{ "name": "Indomitable Spirit", "desc": "Sanity attacks are redirected to nearby opponents.", "req": { "Willpower": 100 } }],
        "Charisma": [{ "name": "Charismatic Cast", "desc": "Landing mantras charms enemies, reducing damage done to you.", "req": { "Charisma": 25 } },{ "name": "Tough Love", "desc": "Deal 10% more damage to charmed enemies.", "req": { "Charisma": 25 } },{ "name": "Give and Take", "desc": "Deal and receive less DMG from comrades.", "req": { "Charisma": 35 } },{ "name": "Golden Tongue", "desc": "Typing or gestures give random buffs to you and allies.", "req": { "Charisma": 40 } },{ "name": "Lasting Charisma", "desc": "Enemies charmed by mantras stay charmed longer.", "req": { "Charisma": 55 } },{ "name": "Chaotic Charm", "desc": "At low health, naturally apply charm to reduce incoming damage.", "req": { "Charisma": 55 } },{ "name": "Dazing Finisher", "desc": "Flourishing charmed enemies dazes them instead of knockback.", "req": { "Charisma": 55 } },{ "name": "Manipulator", "desc": "Deal 20% more critical damage to charmed enemies; removes charm.", "req": { "Charisma": 60 } },{ "name": "Narcissist", "desc": "Charming an already charmed opponent Overcharms you briefly.", "req": { "Charisma": 60 } },{ "name": "Unnecessary Theatrics", "desc": "Deliver a one-liner on heavy attacks that charms opponents briefly.", "req": { "Charisma": 75 } },{ "name": "Cornered Fool", "desc": "Blockbreaking a charmed opponent procs Taunt.", "req": { "Charisma": 85 } },{ "name": "Cult of Personality", "desc": "Gain +3% PEN for each person Charmed, capping at 15%.", "req": { "Charisma": 90 } },{ "name": "Off Your Game", "desc": "Slow Taunted enemies when you hit them.", "req": { "Charisma": 90 } }],
        "Multi-Stats": [{ "name": "Parasol's Brain", "desc": "You feel as if your brain were expanding.", "req": { "Intelligence": 100, "Charisma": 50, "Willpower": 80 } },{ "name": "Sturdy Control", "desc": "Gain 2.5% pen for every M1/Crit after being hit, cap 15%.", "req": { "Precision": 1, "Fortitude": 40 } },{ "name": "Master of His Craft", "desc": "Parrying a vent grants +20% PEN for 5 seconds.", "req": { "Precision": 10, "Intelligence": 10 } },{ "name": "Concussion", "desc": "Flourishing enemies into walls dazes them longer and alters vision.", "req": { "Strength": 20, "Fortitude": 15 } },{ "name": "Matador", "desc": "Deal +20% more damage to human enemies with hyperarmor.", "req": { "Strength": 20, "Agility": 5 } },{ "name": "Lightspeed Reflexes", "desc": "Feinting gives a very brief auto-parry window.", "req": { "Agility": 20, "Intelligence": 20 } },{ "name": "Grasp on Reality", "desc": "Reduced damage from insanity; Shared Misery is less effective.", "req": { "Fortitude": 25, "Willpower": 5 } },{ "name": "Strong Stern", "desc": "The duration you are dazed from wall bangs is cut in half.", "req": { "Strength": 15, "Fortitude": 25 } },{ "name": "Endurance Runner", "desc": "Keep moving even when things look dire.", "req": { "Fortitude": 25, "Agility": 25 } },{ "name": "Conditioned Runner", "desc": "Regen faster while running, slower while not.", "req": { "Fortitude": 25, "Agility": 25 } },{ "name": "Spine Cutter", "desc": "Hit enemy in back after roll cancel for raw weapon damage follow-up.", "req": { "Strength": 20, "Agility": 25 } },{ "name": "Knight's Rally", "desc": "When using a shield, ready block more quickly after a hit.", "req": { "Fortitude": 30, "Willpower": 10 } },{ "name": "Breaking Stereotype", "desc": "Guard breaking an opponent with your critical applies knockdown.", "req": { "Precision": 50, "Strength": 50 } },{ "name": "All The Dead Gods", "desc": "Your Attacks now Apply Anti-Heal. [+5 hp]", "req": { "Intelligence": 40, "Willpower": 65 } },{ "name": "Stress Resistant", "desc": "While in Combat, Insanity only affects every 2nd time.", "req": { "Precision": 25, "Willpower": 40 } },{ "name": "Unfazed", "desc": "More resilient to insanity side effects. No shivering, less panic.", "req": { "Willpower": 50, "Fortitude": 50 } },{ "name": "Steady Nerves", "desc": "Successful dodges restore posture.", "req": { "Strength": 15, "Agility": 45 } },{ "name": "Tooth and Claw", "desc": "Precision & Strength mantras now have 20% PEN.", "req": { "Strength": 50, "Precision": 50 } },{ "name": "Behind You", "desc": "Basic attack behind enemy after mantra feint deals ether-scaling damage.", "req": { "Intelligence": 70, "Agility": 40 } },{ "name": "One of a Kind", "desc": "Crits/Flourishes extend Charm duration and ignore Disbelief.", "req": { "Charisma": 80, "Willpower": 80 } },{ "name": "Dancing With The Dead", "desc": "For every nearby enemy gain 2.5% PEN.", "req": { "Precision": 80, "Intelligence": 20 } },{ "name": "Bad Guy Coming Through", "desc": "Block-breaking an opponent applies 50% damage as Insanity.", "req": { "Strength": 100, "Willpower": 50 } },{ "name": "All Above, Gods Below", "desc": "Stun and steal any healing opponent would receive.", "req": { "Willpower": 100, "Intelligence": 100 } },{ "name": "Crisis Point", "desc": "At 30% Health, disable all anti-heals for 20s.", "req": { "Fortitude": 50, "Willpower": 100 } },{ "name": "Brick Wall", "desc": "Immune to knockdown until knocked unconscious.", "req": { "Fortitude": 100, "Willpower": 100 } },{ "name": "On Your Toes", "desc": "Gain brief auto-parry frames while equipping weapon.", "req": { "Agility": 40, "Willpower": 40 } }],
        "Weapon Talents": [
            { "name": "Flash Pressure", "desc": "Breeze Blitz extender.", "req": { "Light Weapon": 40 } },
            { "name": "Knife's Journey", "desc": "Cancelling enemy mantra windup with M1 deals 15% more damage.", "req": { "Light Weapon": 30 } },
            { "name": "Decisive Blow", "desc": "Critting after an enemy dodge procs Knife's Journey for 2x Armor dmg.", "req": { "Light Weapon": 30 } },
            { "name": "Successive Throw", "desc": "Throw a dagger after a successful flourish.", "req": { "Light Weapon": 35 } },
            { "name": "Switchblade", "desc": "Utilize Dagger Talents when not wielding a dagger.", "req": { "Light Weapon": 50, "Weapon": 50 } },
            { "name": "Mayday", "desc": "Aerial flourishes knockdown for much longer.", "req": { "Precision": 80, "Weapon": 40 } },
            { "name": "Virtuoso", "desc": "Temporarily proc talents of other weapon types in same class.", "req": { "Precision": 80, "Weapon": 80 } },
            { "name": "Prodigy of All", "desc": "Flourish/Uppercut allows procing talents from other weapon classes for 15s.", "req": { "Light Weapon": 80, "Medium Weapon": 80, "Heavy Weapon": 80 } },
            { "name": "Critical Engine", "desc": "Ability to use Deep Gems on your critical attack.", "req": { "Intelligence": 90, "Weapon": 30 } }
        ],
        "Flamecharm": [
            { "name": "Eruption Path: Lava Serpent", "desc": "Every time you would set people aflame, eruptions spawn at their feet instead.", "req": { "Flamecharm": 50 } },
            { "name": "Molten Defense", "desc": "Upon being Block Broken, cause an eruption. (30s CD)", "req": { "Flamecharm": 75, "Path": "Eruption" } },
            { "name": "Flash Point", "desc": "Landing 3 fire mantras will set your enemy aflame.", "req": { "Flamecharm": 100, "Path": "Eruption" } },
            { "name": "Double Trouble", "desc": "Landing a fire attack while eruption is charging causes an explosion.", "req": { "Flamecharm": 100, "Path": "Eruption" } },
            { "name": "The Floor is Lava", "desc": "Your eruptions leave burning pools of lava beneath them.", "req": { "Flamecharm": 100, "Path": "Eruption" } },
            { "name": "Flaming Flourish", "desc": "Your Flourish applies burn.", "req": { "Flamecharm": 25 } },
            { "name": "Pleeksty’s Faith", "desc": "When on fire, automatically put out the flames at the cost of some ether.", "req": { "Flamecharm": 25, "Willpower": 15, "Charisma": 15 } },
            { "name": "Meteor Impact", "desc": "Aerial moves follow up into a devastating slam.", "req": { "Flamecharm": 25 } },
            { "name": "Dancing Steps", "desc": "Dash forward whenever using a flame mantra.", "req": { "Flamecharm": 35 } },
            { "name": "Cauterized Wounds", "desc": "Blood loss from all sources is lowered.", "req": { "Flamecharm": 40, "Fortitude": 5 } },
            { "name": "Explosive Flourish", "desc": "Hitting opponents with a fire attack after a flourish causes an explosion. (15s CD)", "req": { "Flamecharm": 50 } },
            { "name": "Flame Within", "desc": "Set yourself on fire for a 10% DMG and 10% speed increase.", "req": { "Flamecharm": 50 } },
            { "name": "Immolation", "desc": "Mantras cost 70% less ether while burning. M1s gain innate blazing. Take 50% less dmg from Flame Within.", "req": { "Flamecharm": 50 } },
            { "name": "Mirage Clone", "desc": "Dodging an attack successfully sets the attacker on fire.", "req": { "Flamecharm": 65 } },
            { "name": "Azure Flames", "desc": "Flames burn blue, increasing DoT. Eruption variant delays eruptions but increases dmg.", "req": { "Flamecharm": 75, "Willpower": 40 } },
            { "name": "Ash Ember", "desc": "The more wither your opponent has, the more damage your burn deals.", "req": { "Flamecharm": 90, "Weapon": 1 } },
            { "name": "Scorching Decay", "desc": "The wither dealt from Emperor's Flame is massively increased.", "req": { "Flamecharm": 100, "Weapon": 100 } },
            { "name": "The Final Act", "desc": "M1s on burning enemies cause explosions. (15s CD) (Mutual with Eruption)", "req": { "Flamecharm": 75 } },
            { "name": "Emperor Flame", "desc": "Upon activating Final Act, coat yourself in flames, increasing DMG and speed for 20s. (60s CD)", "req": { "Flamecharm": 80 } }
        ],
        "Frostdraw": [
            { "name": "Glass Path: Crystallization", "desc": "Ice mantras no longer slow; instead, they grow crystals on opponents.", "req": { "Frostdraw": 40 } },
            { "name": "Crystal Shrapnel", "desc": "Crystal explosions have an AoE that applies crystals to all hit.", "req": { "Frostdraw": 60, "Path": "Glass" } },
            { "name": "Reclaimed Glass", "desc": "Crystal Shrapnel grants you and allies 10% Elemental Resistance for 10s.", "req": { "Frostdraw": 65, "Path": "Glass" } },
            { "name": "Frostbite", "desc": "Enemies no longer heal when under the effect of chill.", "req": { "Frostdraw": 25 } },
            { "name": "Saint Jay", "desc": "Redirect 60% of an enemy's nullified healing to yourself. Increased if enemy is on ice.", "req": { "Frostdraw": 25, "Talent": "Frostbite" } },
            { "name": "Cool Head", "desc": "Being set on fire while on ice puts it out and grants fire immunity for 30s. (15s CD)", "req": { "Frostdraw": 30 } },
            { "name": "Cryonis", "desc": "All ice spells cast on ice cost less ether.", "req": { "Frostdraw": 40 } },
            { "name": "Cold Front", "desc": "Your vent is imbued with glacial frost.", "req": { "Frostdraw": 40, "Talent": "Cryonis" } },
            { "name": "Chilling Flourish", "desc": "Flourish applies chill or crystals.", "req": { "Frostdraw": 50 } },
            { "name": "Fragile Freeze", "desc": "Light attacks and criticals freeze chilled opponents on guardbreak.", "req": { "Frostdraw": 55 } },
            { "name": "Frozen Pin-Cushion", "desc": "Ice Daggers freeze opponents in place.", "req": { "Frostdraw": 60, "Mantra": "Ice Daggers" } },
            { "name": "Orbital Ice", "desc": "Parrying on ice forms a ring that absorbs 15% physical damage.", "req": { "Frostdraw": 65 } },
            { "name": "Cryostasis", "desc": "Take decreased damage for 3s after being guard broken. (25s CD)", "req": { "Frostdraw": 80 } },
            { "name": "Stasis Strike", "desc": "Crystal explosions deal more damage if the opponent is bottom frozen.", "req": { "Frostdraw": 90, "Weapon": 90 } },
            { "name": "Frozen Anchor", "desc": "Apply bottom freeze and chill on flourish, uppercut, or crit.", "req": { "Frostdraw": 100, "Weapon": 100 } },
            { "name": "Unyielding Frost", "desc": "Chill procs through block at 80% duration.", "req": { "Frostdraw": 100 } }
        ],
        "Galebreathe": [
            { "name": "Haunted Path: Specter", "desc": "Lose suffocation for a spectral gauge.", "req": { "Galebreathe": 50 } },
            { "name": "Apparitions", "desc": "Phantoms apply winded; cannot be parried during phantom step.", "req": { "Galebreathe": 50, "Path": "Haunted" } },
            { "name": "Phantom Step", "desc": "High speed running and gale dashes (Requires 10% spectral gauge).", "req": { "Galebreathe": 55, "Path": "Haunted" } },
            { "name": "Vanishing Wraith", "desc": "Aerial attacks in phantom step teleport you behind the target.", "req": { "Galebreathe": 60, "Path": "Haunted" } },
            { "name": "Possession", "desc": "Apparition hits grant posture dmg or chip dmg depending on phantom step.", "req": { "Galebreathe": 75, "Path": "Haunted" } },
            { "name": "Suffocating Impact", "desc": "Suffocate enemies when flourishing them into walls.", "req": { "Galebreathe": 35, "Strength": 15 } },
            { "name": "Wind Step", "desc": "Gain a double jump and a large slide leap. (7s CD)", "req": { "Galebreathe": 40 } },
            { "name": "Haunted Gale", "desc": "Every 3 hits with perfect cast gale mantras strike the target with a wind phantom.", "req": { "Galebreathe": 40 } },
            { "name": "Cyclone Blade", "desc": "Gale dashes empower your next light attack with 30% bleed DMG and 10% chip.", "req": { "Galebreathe": 55, "Agility": 30 } },
            { "name": "Silencer's Blade", "desc": "Meleeing a suffocated opponent extends duration and grants speed.", "req": { "Galebreathe": 60 } },
            { "name": "Air Pressure", "desc": "Dodging or hitting blocks turns your next dash into a gale dash.", "req": { "Galebreathe": 50, "Agility": 20 } },
            { "name": "AWS (A World Without Song)", "desc": "Wind attacks inflict suffocation for 5s.", "req": { "Galebreathe": 75 } },
            { "name": "Silencer's Song", "desc": "Silencer’s Blade now procs on mantras.", "req": { "Galebreathe": 100, "Weapon": 100 } }
        ],
        "Thundercall": [
            { "name": "Surge Path: Unstable Capacitor", "desc": "Apply surge stacks instead of shock. Max stacks cause an overload arc.", "req": { "Thundercall": 40 } },
            { "name": "Fried Circuits", "desc": "Overloading an enemy applies Sapped for 5s.", "req": { "Thundercall": 40, "Path": "Surge" } },
            { "name": "Closed Circuit", "desc": "Failed overload arcs deal damage directly to the overloaded enemy.", "req": { "Thundercall": 40, "Path": "Surge" } },
            { "name": "Catalytic Strike", "desc": "Posture breaking a target overloads their surge stacks.", "req": { "Thundercall": 40, "Path": "Surge" } },
            { "name": "Human Battery", "desc": "Convert nearby surge stacks into ether when empty.", "req": { "Thundercall": 40, "Path": "Surge" } },
            { "name": "Raiton Path: Enlightened", "desc": "Decrease ether regen and tempo gain. 3 stacks overcharge the opponent.", "req": { "Thundercall": 50 } },
            { "name": "Raiton's Charge", "desc": "Overcharge now sets people on fire.", "req": { "Thundercall": 75, "Path": "Raiton" } },
            { "name": "Simple Path: Electrocution", "desc": "3 thunder hits apply Electrocution, increasing blood loss and burn dmg taken.", "req": { "Thundercall": 50 } },
            { "name": "Scatter", "desc": "Flourishing an enemy applies Electrocution.", "req": { "Thundercall": 50, "Path": "Electrocution" } },
            { "name": "Short Circuit", "desc": "Electrocution now sets the target on fire.", "req": { "Thundercall": 75, "Path": "Electrocution" } },
            { "name": "Static Fakeout", "desc": "Roll canceling after a parry teleports you behind the opponent.", "req": { "Thundercall": 35, "Agility": 30 } },
            { "name": "Static Link", "desc": "Flourishing or uppercutting creates a static link tether.", "req": { "Thundercall": 40, "Intelligence": 15 } },
            { "name": "Jumper Cables", "desc": "Getting knocked while tethered steals HP and prevents the knockdown. (3-4s CD)", "req": { "Thundercall": 1, "Fortitude": 20, "Talent": "Static Link" } },
            { "name": "Link Conduction", "desc": "Lightning mantras cost 30% less ether per active link.", "req": { "Thundercall": 65, "Talent": "Static Link" } },
            { "name": "Static Allure", "desc": "Two active tethers pull targets together; increased duration.", "req": { "Thundercall": 50, "Talent": "Static Link" } },
            { "name": "Grounding Bolt", "desc": "Summoned lightning strikes apply knockdown.", "req": { "Thundercall": 90, "Weapon": 90 } },
            { "name": "Overload", "desc": "Hitting opponent 3 times overloads yourself, increasing DMG and tempo. Raiton covers you in shock.", "req": { "Thundercall": 100 } }
        ],
        "Shadowcast": [
            { "name": "Withering Path: Decay", "desc": "Your shadow now withers away opponent health.", "req": { "Shadowcast": 50 } },
            { "name": "Voidcaller", "desc": "Opponents with no ether or tempo suffer additional wither damage.", "req": { "Shadowcast": 50, "Path": "Withering" } },
            { "name": "Infection", "desc": "Wither from shadowcast spreads to nearby enemies.", "req": { "Shadowcast": 60, "Path": "Withering" } },
            { "name": "Crushing Thrall", "desc": "Doubles wither received if a shadow mantra breaks guard.", "req": { "Shadowcast": 75, "Path": "Withering" } },
            { "name": "Suppression", "desc": "The ether of victims withers away.", "req": { "Shadowcast": 80 } },
            { "name": "Senseless Destruction", "desc": "Opponents with >10% wither take more damage from shadow attacks.", "req": { "Shadowcast": 100 } },
            { "name": "Dark Synergy", "desc": "Engulf enemies in shadows when flourishing.", "req": { "Shadowcast": 25 } },
            { "name": "Sightless Still", "desc": "Shadow attacks increasingly obscure vision. (Mutual with Singularity)", "req": { "Shadowcast": 30 } },
            { "name": "Singularity", "desc": "Enemies hang in place when hit by shadow. (Mutual with Sightless Still)", "req": { "Shadowcast": 40 } },
            { "name": "Blackhole", "desc": "Singularity pulls nearby people in.", "req": { "Shadowcast": 50, "Talent": "Singularity" } },
            { "name": "Energy Siphon", "desc": "Singularity pulls ether from those affected.", "req": { "Shadowcast": 50, "Talent": "Singularity" } },
            { "name": "Lord’s Tithe", "desc": "Drains the tempo of enemies you reinforce.", "req": { "Shadowcast": 40, "Mantra": "Reinforce" } },
            { "name": "Dark God", "desc": "Steal tempo if a mantra would drain enemy ether to 0.", "req": { "Shadowcast": 50 } },
            { "name": "Lasting Sorrow", "desc": "Shadows last longer on the opponent.", "req": { "Shadowcast": 50 } },
            { "name": "Fear The Dark", "desc": "Enemies stop in place when running from you.", "req": { "Shadowcast": 50 } },
            { "name": "Dark Rift", "desc": "Enter a rift with I-frames when dodging.", "req": { "Shadowcast": 60 } },
            { "name": "Dark Waltz", "desc": "Guardbreaking with light attacks/crits steals half of opponent's tempo.", "req": { "Shadowcast": 90, "Weapon": 90 } },
            { "name": "Night Terror", "desc": "Light attacks proc Fear the Dark.", "req": { "Shadowcast": 100, "Weapon": 100 } }
        ],
        "Ironsing": [
            { "name": "Decay Path: Oxidize", "desc": "Metal attacks store damage released 7.5s later.", "req": { "Ironsing": 50 } },
            { "name": "Decaying Posture", "desc": "Deal more damage to opponents with more posture than you.", "req": { "Ironsing": 75, "Path": "Decay" } },
            { "name": "Tetanus", "desc": "Hitting with 5+ rods negates healing based on damage and slows.", "req": { "Ironsing": 80, "Path": "Decay" } },
            { "name": "Laced Blade", "desc": "Light attacks on targets with tetanus apply poison.", "req": { "Ironsing": 90, "Path": "Decay" } },
            { "name": "Oxidizing Blitz", "desc": "Mantras apply DoT to Health/Blood. Tetanus redirects 20% of healing to you.", "req": { "Ironsing": 100, "Path": "Decay" } },
            { "name": "Gilded Path: Scrapsinger", "desc": "Flourish consumes rods to siphon enemy armor to you.", "req": { "Ironsing": 35 } },
            { "name": "Artisan's Blade", "desc": "Forges metal blades that fire upon landing metal-infused attacks.", "req": { "Ironsing": 45, "Path": "Gilded" } },
            { "name": "Refine and Reuse", "desc": "Consuming rods reduces incoming PEN multiplicatively.", "req": { "Ironsing": 45, "Path": "Gilded" } },
            { "name": "Songs Unforged", "desc": "Weapon criticals activate Scrapsinger.", "req": { "Ironsing": 50, "Path": "Gilded" } },
            { "name": "Masterwork", "desc": "Artisan’s Blades proc metal rods and deal 50% more damage.", "req": { "Ironsing": 60, "Path": "Gilded" } },
            { "name": "Reshape and Remold", "desc": "Scrapsinger procs increase opponent armor damage taken.", "req": { "Ironsing": 70, "Path": "Gilded" } },
            { "name": "Thornmail", "desc": "Getting flourished applies a metal rod to the attacker.", "req": { "Ironsing": 45 } },
            { "name": "Metal Thief", "desc": "Pulling an opponent absorbs a portion of their armor durability.", "req": { "Ironsing": 50 } },
            { "name": "Piercing Metal", "desc": "Deal additional armor damage per rod affecting the enemy.", "req": { "Ironsing": 60 } },
            { "name": "Exposed Durability", "desc": "10% more damage to opponents with no armor durability.", "req": { "Ironsing": 60 } },
            { "name": "Oh The Irony", "desc": "Taunted opponents receive double iron rods.", "req": { "Ironsing": 60, "Charisma": 45 } },
            { "name": "An Ironsinger's Instinct", "desc": "Dodging coats you in metal, reducing damage of next hit. (18s CD)", "req": { "Ironsing": 75 } },
            { "name": "Phantom Edge", "desc": "Basic attacks have +0.25 range.", "req": { "Ironsing": 75 } },
            { "name": "Polished Armor", "desc": "Receive 5-10% less damage when armor is above 90% durability.", "req": { "Ironsing": 75 } },
            { "name": "Metal Eater", "desc": "Consume armor durability to cast mantras when ether is empty.", "req": { "Ironsing": 80 } },
            { "name": "Alloyblood", "desc": "Bleed damage reduced by 30%; blood loss reduced by 75%.", "req": { "Ironsing": 100 } },
            { "name": "Rending Needle: Conductor", "desc": "Reflect non-ironsing mantra element if target has 5+ rods.", "req": { "Ironsing": 75 } },
            { "name": "Rending Needle: Jailer", "desc": "Restrain enemy instead of pulling if they have 5+ rods.", "req": { "Ironsing": 75 } },
            { "name": "Rending Needle: Impaler", "desc": "Pull rods out for damage if enemy has 5+ rods.", "req": { "Ironsing": 75 } }
        ],
        "Bloodrend": [
            { "name": "Harvest Season", "desc": "Critical attacks spawn blood pools under the opponent.", "req": { "Bloodrend": 25 } },
            { "name": "Not So Cheap Trick", "desc": "Chance to blind opponents with blood control.", "req": { "Bloodrend": 25 } },
            { "name": "Rush Hour", "desc": "Stab yourself for DMG/Speed; lose blood/HP over time.", "req": { "Bloodrend": 50 } },
            { "name": "Sow and Mend", "desc": "Sacrifice blood for temporary HP.", "req": { "Bloodrend": 60 } },
            { "name": "Cyclical Exsanguination", "desc": "Pause Temp HP decay on hit; reduces enemy posture regain from parries.", "req": { "Bloodrend": 65 } },
            { "name": "Smell of Blood", "desc": "See enemy blood/poison when they touch pools or are block broken.", "req": { "Bloodrend": 65 } },
            { "name": "Sucker Strike", "desc": "Landing a critical while inside a blood pool increases DMG.", "req": { "Bloodrend": 80 } },
            { "name": "Gruesome Harvest", "desc": "Landing attacks on heavily poisoned enemies gives Temp HP.", "req": { "Bloodrend": 85 } },
            { "name": "Hemorrhaging Blow", "desc": "Block breaking with a mantra turns enemy healing into damage for 8s.", "req": { "Bloodrend": 95 } },
            { "name": "Simple Manipulation: Unstable Blood", "desc": "Attacks spawn pools and cause heavy bleeding.", "req": { "Bloodrend": 50 } },
            { "name": "Peaking Control", "desc": "Chance for blood pool eruptions to explode.", "req": { "Bloodrend": 75, "Path": "Simple" } },
            { "name": "Piercing Totality", "desc": "Explosions affect everyone in range with increased PEN.", "req": { "Bloodrend": 100, "Path": "Simple" } },
            { "name": "Manipulation Path: Agile Misery", "desc": "Speed increased; agility mantras empowered with blood.", "req": { "Bloodrend": 50 } },
            { "name": "Rushing Demise", "desc": "Spawning pools grants a blood trail that empowers dashes.", "req": { "Bloodrend": 75, "Path": "Agile" } },
            { "name": "Protective Offense", "desc": "Spawn protective crosses on blood pool creation for defense.", "req": { "Bloodrend": 100, "Path": "Agile" } },
            { "name": "Manipulation Path: Spirit Lantern", "desc": "Attacks poison instead of spawning pools; increased blood regen.", "req": { "Bloodrend": 50 } },
            { "name": "Venomous Chain", "desc": "Poison bypasses resistance and deals 2% true damage on chain hits.", "req": { "Bloodrend": 75, "Path": "Lantern" } },
            { "name": "Heavy Disease", "desc": "Venomous Chain now also summons a blood pool.", "req": { "Bloodrend": 100, "Path": "Lantern" } }
        ],
        "Earthbend": [
            { "name": "Bastion Path: Reinforce", "desc": "Stand still for 3s to harden skin and reduce incoming damage by 20%.", "req": { "Earthbend": 50, "Fortitude": 25 } },
            { "name": "Immovable Fortress", "desc": "Bastion only requires 2s; immune to ragdoll while active.", "req": { "Earthbend": 70, "Fortitude": 30 } },
            { "name": "Kinetic Buffer", "desc": "Store damage while in Bastion to buff next Earth or Light attack.", "req": { "Earthbend": 70, "Fortitude": 40 } },
            { "name": "Reactive Plates", "desc": "Erupt rock shards when hit during active Bastion. (20s CD)", "req": { "Earthbend": 75, "Fortitude": 50 } },
            { "name": "Battlefield Strategist", "desc": "Long-range attacks spawn spikes; short-range spawn walls. (20s CD)", "req": { "Earthbend": 40 } },
            { "name": "Natural Disaster", "desc": "Apply Concussion on 3 hits, blinding and hiding enemy HP bar.", "req": { "Earthbend": 50 } },
            { "name": "Force of Nature", "desc": "Enemies hitting walls are dazed for longer.", "req": { "Earthbend": 50 } },
            { "name": "Momento Mori", "desc": "Going insane increases Earthbend destruction AoE.", "req": { "Earthbend": 50, "Willpower": 20 } },
            { "name": "Annihilator", "desc": "Attacks cause bone destruction, slowing opponents.", "req": { "Earthbend": 50, "Strength": 50 } },
            { "name": "Vengeful Chase", "desc": "Enemies flourished into walls are struck by Earth Spikes.", "req": { "Earthbend": 70 } },
            { "name": "Impermeable", "desc": "Close-range mantras coat you in dust, reducing blood loss.", "req": { "Earthbend": 80 } },
            { "name": "Solidifier", "desc": "Elemental hits grant resistance to further elemental damage for 10s.", "req": { "Earthbend": 100 } }
        ],
        "Multi-Elemental": [
            { "name": "Wraith Path: Umbra", "desc": "Darkened flames refuse enemy ether gain; puppets drawn to burned targets.", "req": { "Flamecharm": 50, "Shadowcast": 50 } },
            { "name": "Freezing Wight", "desc": "Haunted gale now procs Chilled.", "req": { "Galebreathe": 1, "Frostdraw": 40, "Talent": "Haunted Gale" } },
            { "name": "Fulgurite Formation", "desc": "Crystals cause lightning strikes; Overload causes double crystal application.", "req": { "Frostdraw": 50, "Thundercall": 50 } },
            { "name": "Flashboil", "desc": "Hitting chilled enemies with fire (and vice versa) creates steam DoT clouds.", "req": { "Flamecharm": 30, "Frostdraw": 30 } },
            { "name": "Volcanic Glass", "desc": "Detonating crystals will cause an eruption.", "req": { "Flamecharm": 1, "Frostdraw": 1, "Path": "Eruption/Glass" } },
            { "name": "Temperature Shock", "desc": "Flame mantras will now detonate crystals.", "req": { "Flamecharm": 40, "Path": "Glass" } },
            { "name": "Scorched Peak", "desc": "Blockbreaking burning opponents strikes them with lightning.", "req": { "Flamecharm": 50, "Thundercall": 25 } }
        ]
    }
};

let userStats = {};
let selectedItems = new Set();
let collapsedCats = new Set(); 

// --- MUTUAL EXCLUSIVE DEFINITIONS ---
const mutualGroups = [
    ["Simple Path: Electrocution", "Raiton Path: Enlightened", "Surge Path: Unstable Capacitor"],
    ["Unyielding Frost", "Glass Path: Crystallization"],
    ["The Final Act", "Eruption Path: Lava Serpent"],
    ["Gilded Path: Scrapsinger", "Decay Path: Oxidize"],
    ["Manipulation Path: Spirit Lantern", "Manipulation Path: Agile Misery", "Simple Manipulation: Unstable Blood"],
    ["Wraith Path: Umbra", "Eruption Path: Lava Serpent"],
    ["Flashboil", "Wraith Path: Umbra", "Eruption Path: Lava Serpent"],
    ["Flashboil", "Glass Path: Crystallization"],
    ["Volcanic Glass", "Flashboil"],
    ["Fulgurite Formation", "Unyielding Frost"],
    ["Emperor Flame", "Eruption Path: Lava Serpent"]
];

function init() {
    const splashes = [
        "time for a shower twin",
        "please dont go for more than 80 will",
        "FUCK MY LIFE... IM JUST A RETARD... -nnecrochromatic",
        "?timeout @Nebula 27d ramadan",
        "im a fat greasy pig -stank",
        "maybe its time to get out of the kitchen",
        "hold it, this guy is cooking",
        "your dragon backshots gave me ping spikes up to 3000+ ms -pepper",
        "@astr0phone Wanna be my valentine -yzord",
        "Dont make me hit one of yall wit my bbc -mon"
    ];
    
    const splashEl = document.getElementById('splash-text');
    splashEl.innerText = splashes[Math.floor(Math.random() * splashes.length)];

    const core = document.getElementById('core-inputs');
    core.innerHTML = "";
    gameData.attributes.forEach(a => {
        userStats[a] = 0;
        core.innerHTML += `<div class="stat-row"><label>${a}</label><input type="number" id="in-${a}" value="0" min="0" max="100" onchange="setStat('${a}', this.value)"></div>`;
    });

    const att = document.getElementById('att-inputs');
    att.innerHTML = "";
    gameData.attunements.forEach(a => {
        userStats[a] = 0;
        att.innerHTML += `<div class="stat-row"><label>${a}</label><input type="number" id="in-${a}" value="0" min="0" max="100" onchange="setStat('${a}', this.value)"></div>`;
    });

    updateUI();
    
}

function setStat(name, val) {
    val = Math.min(100, Math.max(0, parseInt(val) || 0));
    userStats[name] = val;
    document.getElementById(`in-${name}`).value = val;
    updateUI();
}

function calculateMaxPoints() {
    let activeAtts = 0;
    gameData.attunements.forEach(a => { if(userStats[a] > 0) activeAtts++; });
    let max = 410;
    if (activeAtts >= 1) max += 10;
    if (activeAtts > 1) max += (activeAtts - 1) * 5;
    return max;
}

function clearBuild() {
    if(!confirm("Reset everything?")) return;
    for(let s in userStats) {
        userStats[s] = 0;
        let el = document.getElementById(`in-${s}`);
        if(el) el.value = 0;
    }
    selectedItems.clear();
    updateUI();
}

function updateUI() {
    const max = calculateMaxPoints();
    let used = 0;
    Object.values(userStats).forEach(v => used += v);
    
    document.getElementById('max-pts').innerText = max;
    document.getElementById('used-pts').innerText = used;
    document.getElementById('used-pts').style.color = used > max ? "#ff4444" : "#fff";

    renderTalents();
    
    const list = document.getElementById('selection-list');
    list.innerHTML = "";
    selectedItems.forEach(item => {
        list.innerHTML += `<div class="selection-item">${item}</div>`;
    });
}

function toggleCategory(cat) {
    collapsedCats.has(cat) ? collapsedCats.delete(cat) : collapsedCats.add(cat);
    renderTalents();
}

function renderTalents() {
    const container = document.getElementById('talent-container');
    const search = document.getElementById('search-input').value.toLowerCase();
    const showOnlyMet = document.getElementById('filter-reqs').checked;
    
    container.innerHTML = "";

    for (let cat in gameData.talents) {
        const isCollapsed = collapsedCats.has(cat);
        let hasVisible = false;
        let catHtml = `<div class="category-block ${isCollapsed ? 'collapsed' : ''}">
                        <div class="category-title" onclick="toggleCategory('${cat}')">${cat}</div>
                        <div class="grid">`;

        gameData.talents[cat].forEach(t => {
            let met = true;
            for (let r in t.req) { if ((userStats[r] || 0) < t.req[r]) met = false; }

            const matchesSearch = t.name.toLowerCase().includes(search) || t.desc.toLowerCase().includes(search);
            const matchesMet = !showOnlyMet || met;

            if (matchesSearch && matchesMet) {
                hasVisible = true;
                const isSelected = selectedItems.has(t.name);

                let reqHtml = "";
                if (Object.keys(t.req).length > 0) {
                    const reqList = Object.entries(t.req)
                        .map(([stat, val]) => `${stat}: ${val}`)
                        .join(", ");
                    reqHtml = `<div class="req-text">Req: ${reqList}</div>`;
                }

                catHtml += `
                    <div class="card ${met ? '' : 'locked'} ${isSelected ? 'selected' : ''}" 
                         onclick="toggleTalent('${t.name}', ${met})">
                        <strong>${t.name}</strong><br>
                        <small style="opacity: 0.9;">${t.desc}</small>
                        ${reqHtml}
                    </div>`;
            }
        });

        catHtml += `</div></div>`;
        if (hasVisible) container.innerHTML += catHtml;
    }
}

function toggleTalent(name, met) {
    // Check for mutual exclusivity if trying to select a new one
    if (!selectedItems.has(name)) {
        if (!met) return;

        // Search through all groups for conflicts
        for (const group of mutualGroups) {
            if (group.includes(name)) {
                for (const other of group) {
                    if (other !== name && selectedItems.has(other)) {
                        alert(`❌ MUTUAL EXCLUSIVE ERROR:\n"${name}" cannot be picked because you already have "${other}".`);
                        return; // Stop the function here
                    }
                }
            }
        }
        selectedItems.add(name);
    } else {
        // Just remove it if already selected
        selectedItems.delete(name);
    }
    
    updateUI();
}

function saveBuild() {
    const data = { s: userStats, t: Array.from(selectedItems) };
    prompt("Copy this build code:", btoa(JSON.stringify(data)));
}

function loadBuild(manualCode = null) {
    const code = manualCode || prompt("Paste your build code:");
    if (!code) return;
    try {
        const data = JSON.parse(atob(code));
        userStats = data.s;
        selectedItems = new Set(data.t);
        for (let s in userStats) {
            const el = document.getElementById(`in-${s}`);
            if (el) el.value = userStats[s];
        }
        updateUI();
    } catch(e) { alert("Invalid Build Code"); }
}

window.onload = () => {
    init();
};
</script>
</body>
</html>
