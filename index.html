<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deepwoken modded Builder by taxes/faithandpray</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="peakwoken.png">
    <style>
        :root {
    --bg: radial-gradient(#18221a, #04100d);
    --sidebar-bg: #0a0a0b;
    --card-bg: #0c120f;
    --parchment: #d8d7ca;
    --parchment-text: #1a1a1a;
    --gold: #c2a35d;
    --accent-filter: sepia(1) saturate(15) hue-rotate(-5deg); /* Gold */
    --border-path: url('border.png'); 
    --thin-border: url('borderthin.png');
    --border-slice: 10;
}
body.theme-flame {
    --bg: radial-gradient(#2b1a10, #0f0804);
    --sidebar-bg: #140d08;
    --card-bg: #1a120c;
    --gold: #ffaa44;
    --accent-filter: saturate(15) hue-rotate(-15deg) brightness(1.1);
}

body.theme-frost {
    --bg: radial-gradient(#101b2b, #040910);
    --sidebar-bg: #080c14;
    --card-bg: #0c121a;
    --gold: #55aaff;
    --accent-filter: saturate(15) hue-rotate(180deg) brightness(1.2); /* Cyan/Blue */
}
body.theme-gale {
    --bg: radial-gradient(#102b18, #041006);
    --sidebar-bg: #08140c;
    --card-bg: #0c1a10;
    --gold: #33cc66;
    --accent-filter: saturate(10) hue-rotate(80deg);
}

/* Thundercall (Dark Yellow) */
body.theme-thunder {
    --bg: radial-gradient(#2b2810, #100f04);
    --sidebar-bg: #141308;
    --card-bg: #1a190c;
    --gold: #ccaa00;
    --accent-filter: saturate(20) hue-rotate(10deg);
}

body.theme-shadow {
    --bg: radial-gradient(#1a102b, #0a0410);
    --sidebar-bg: #0d0814;
    --card-bg: #120c1a;
    --gold: #aa55ff;
    --accent-filter: saturate(10) hue-rotate(240deg); /* Purple */
}
/* Ironsing (Gray/Metal) */
body.theme-iron {
    --bg: radial-gradient(#252525, #0a0a0a);
    --sidebar-bg: #121212;
    --card-bg: #1a1a1a;
    --gold: #9999aa;
    --accent-filter: grayscale(1) brightness(1.5);
}

/* Bloodrend (Brick Red) */
body.theme-blood {
    --bg: radial-gradient(#2b0a0a, #100404);
    --sidebar-bg: #140808;
    --card-bg: #1a0c0c;
    --gold: #b22222;
    --accent-filter: saturate(15) hue-rotate(-45deg) brightness(0.8);
}

/* Earthbend (Brown) */
body.theme-earth {
    --bg: radial-gradient(#2b1d10, #100a04);
    --sidebar-bg: #141008;
    --card-bg: #1a140c;
    --gold: #8b5a2b;
    --accent-filter: saturate(5) hue-rotate(-20deg) brightness(0.7);
}


        * { box-sizing: border-box; }
        body { 
            background: var(--bg); color: #fff; font-family: 'Lora', serif; 
            margin: 0; display: flex; height: 100vh; overflow: hidden; 
        }

        
        
#sidebar-left { 
    width: 320px; 
    min-width: 320px; 
    background: var(--sidebar-bg); 
    border-right: 2px solid #2f2f35; 
    padding: 20px; 
    overflow-y: auto;
    display: flex; 
    flex-direction: column; 
    align-items: center;
    height: 100vh;
}


.traits-medallion-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px 20px;
    margin-bottom: 20px;
    width: 100%;
    padding: 10px;
}

.trait-item {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.medallion {
    width: 70px;
    height: 70px;
    background: url('Traits.png') no-repeat center;
    background-size: contain;
    display: flex;
    align-items: center;
    justify-content: center;
    image-rendering: pixelated;
    position: relative;
}


.medallion input {
    background: transparent !important;
    border: none !important;
    color: #fff !important;
    width: 100%;
    height: 100%;
    text-align: center;
    font-size: 1.8rem; 
    font-weight: bold;
    font-family: 'Lora', serif;
    outline: none;
    cursor: pointer;
    text-shadow: 2px 2px 0px #000, -1px -1px 0px #000; 
    z-index: 2;
}

input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button { 
    -webkit-appearance: none; 
    margin: 0; 
}

input[type="number"] { 
    -moz-appearance: textfield; 
    appearance: textfield;
}
.trait-label {
    font-size: 1rem;
    color: #fff;
    margin-top: 2px;
    font-family: 'Lora', serif;
    text-shadow: 1px 1px 2px #000;
}

#trait-sum-display {
    font-size: 0.8rem;
    color: var(--gold);
    margin-bottom: 15px;
    font-weight: bold;
}


#oath-select {
    width: 100%;
    background: #000;
    color: var(--gold);
    border: 1px solid #444;
    padding: 10px;
    font-family: 'Lora';
    text-transform: uppercase;
    font-weight: bold;
    margin-top: 15px;
    cursor: pointer;
}

        
        
        #sidebar-right {
            width: 340px; min-width: 340px; background: var(--parchment);
            color: var(--parchment-text); margin: 15px; display: flex; flex-direction: column;
            border: 12px solid transparent; 
            border-image: var(--border-path) var(--border-slice) round;
            image-rendering: pixelated; overflow: hidden;
        }

        #main-area { flex: 1; display: flex; flex-direction: column; padding: 20px; overflow: hidden; }
        #item-container { flex: 1; overflow-y: auto; padding-right: 10px; }

        
        .investment-header { text-align: center; margin-bottom: 20px; width: 100%; }
        .investment-header h2 { margin: 0; font-size: 1.8rem; }
        .pts-display { font-size: 2.5rem; font-weight: bold; margin: 5px 0; display: block; }
        #splash-text { color: var(--gold); font-size: 0.8rem; font-style: italic; min-height: 1.2rem; }

        
        .tab-container { display: flex; gap: 15px; margin-bottom: 25px; }
        .tab-btn { 
            background: #000; color: #fff; font-family: 'Lora', serif; font-weight: 700;
            padding: 10px 20px; cursor: pointer; text-transform: uppercase;
            border: 10px solid transparent; border-image: var(--border-path) 10 round;
            background-clip: padding-box; image-rendering: pixelated; transition: 0.1s;
        }
       .tab-btn.active { filter: var(--accent-filter); }

        /* Search Bar */
        .search-bar-container { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 4px; margin-bottom: 20px; border: 1px solid #333; }
        #search-input { width: 100%; padding: 10px; background:#000; color:#fff; border:1px solid #444; font-family: 'Lora'; margin-bottom: 10px; }

        /* Cards */
        .category-title {
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    user-select: none;
}

.category-title::after {
    content: '▼';
    font-size: 0.8rem;
    transition: transform 0.2s;
}

.category-block { 
    margin-bottom: 20px; 
}
.category-title { 
    font-size: 1rem; 
    margin-bottom: 10px; 
    padding: 10px 15px; 
    color: #fff; 
    cursor: pointer; 
    display: flex; 
    justify-content: space-between; 
    align-items: center;
    text-transform: uppercase;
    font-weight: bold;
    letter-spacing: 1px;

    /* Border for Titles */
    border: 8px solid transparent;
    border-image: var(--border-path) var(--thin-border) 10 round;
    background: #050505;
    background-clip: padding-box;
    image-rendering: pixelated;
}

.category-title:hover {
    filter: brightness(1.3);
}

.category-title::after {
    content: '▼';
    font-size: 0.7rem;
    transition: transform 0.2s;
}
.category-block.collapsed .grid { display: none; }
.category-block.collapsed .category-title::after { transform: rotate(-90deg); }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .card {
    background: var(--card-bg); 
    padding: 15px; 
    cursor: pointer;
    
    border: 10px solid transparent;
    border-image-source: var(--border-path);
    border-image-slice: 10;
    border-image-repeat: round;
    background-clip: padding-box;
    image-rendering: pixelated;
    
    
    transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), filter 0.2s, background 0.2s;
}


.card:hover:not(.locked) {
    transform: translateY(-5px); 
    filter: brightness(1.2);      
    background: #121a16;          
    z-index: 10;
}

.card.selected {
    filter: sepia(1) saturate(12) hue-rotate(5deg) brightness(1.1);
    background: rgba(194, 163, 93, 0.1);
    transform: scale(1.02); 
}


.card.locked:hover {
    transform: none;
}
        .card.selected { filter: var(--accent-filter) brightness(1.1); }
        .card.locked {
    opacity: 0.6; 
    filter: grayscale(0.7) contrast(0.8);
    cursor: not-allowed;
    border-image-source: var(--border-path); 
}
        .card h3 { margin: 0 0 5px 0; font-size: 1.1rem; color: #fff; }
        .card p { margin: 0; font-size: 0.85rem; color: #bbb; }
        .card hr { border: 0; border-top: 1px solid rgba(255,255,255,0.1); margin: 12px 0; }
        .req-text { color: var(--gold); font-size: 0.85rem; font-weight: 700; }

        
        .stat-row { display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 8px; }
        input[type="number"] { background: #000; border: 1px solid #444; color: #fff; padding: 5px; width: 65px; text-align: center; font-family: 'Lora'; font-size: 1rem; }

        
        .calc-wrapper { background: var(--parchment); color: var(--parchment-text); padding: 25px; border: 10px solid transparent; border-image: var(--border-path) 10 round; max-width: 600px; margin: 0 auto; }
        .calc-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px dotted rgba(0,0,0,0.2); font-weight: bold; }
        .calc-row span { font-weight: normal; color: #666; font-style: italic; }

        
        .action-btn { background: #1a1a1c; border: 1px solid #444; color: #fff; padding: 12px; cursor: pointer; width: 100%; margin-top: 8px; font-family: 'Lora'; font-weight: bold; }

        
        #mobile-nav { display: none; padding: 10px; background: #000; border-bottom: 1px solid #333; justify-content: space-between; }
        .overlay { 
    display: none; 
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    background: rgba(0,0,0,0.7); 
    z-index: 900; 
}


body.sidebar-open-left .overlay, 
body.sidebar-open-right .overlay { 
    display: block; 
}

        @media (max-width: 1024px) {
    body {
        flex-direction: column;
        overflow-y: auto; 
        height: auto;
    }

    
    #sidebar-left, #sidebar-right {
        position: fixed;
        top: 0;
        height: 100%;
        width: 280px;
        z-index: 2000; 
        display: flex; 
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 5px 0 15px rgba(0,0,0,0.5);
    }

    #sidebar-left {
        left: 0;
        transform: translateX(-100%);
        background: #0a0a0b; 
    }

    #sidebar-right {
        right: 0;
        transform: translateX(100%);
        margin: 0;
        background: var(--parchment); 
    }

    
    body.sidebar-open-left #sidebar-left { transform: translateX(0); }
    body.sidebar-open-right #sidebar-right { transform: translateX(0); }

   
    #main-area {
        padding: 10px;
        overflow: visible;
        width: 100%;
    }

    
    .tab-container {
        flex-wrap: wrap;
        gap: 5px;
        justify-content: center;
    }

    .tab-btn {
        font-size: 0.75rem;
        padding: 8px 12px;
        border-width: 6px; 
    }

    
    #mobile-nav {
        display: flex;
        position: sticky;
        top: 0;
        z-index: 1500;
        background: #000;
    }
}

        .toggle-gif-btn { background: transparent; border: none; color: #55aaff; padding: 0; font-size: 0.75rem; cursor: pointer; text-decoration: underline; margin-top: 8px; }
        .gif-container { margin-top: 10px; display: none; width: 100%; border: 1px solid #333; }
        .gif-container img { width: 100%; display: block; }
        body.sidebar-open-left #sidebar-left { transform: translateX(0); }
    body.sidebar-open-right #sidebar-right { transform: translateX(0); }
    
    /* Show Overlay when menu is open */
    body.sidebar-open-left .overlay, body.sidebar-open-right .overlay { display: block; }

    /* Shrink search bar for mobile */
    .search-bar-container { padding: 10px; margin-bottom: 10px; }

.weapon-card {
    background: rgba(255, 255, 255, 0.15) !important; 
    border: 10px solid transparent;
    border-image: var(--border-path) 10 round;
    color: #1a1a1a !important; 
    padding: 15px;
    image-rendering: pixelated;
    transition: transform 0.2s;
}

.weapon-card h3 { color: #000 !important; margin-top: 0; }
.weapon-card .dmg-value { color: #8b0000 !important; font-weight: bold; font-size: 1.2rem; }
.weapon-card .potential-text { color: #555 !important; font-style: italic; font-size: 0.8rem; }

/* Selection state for weapons */
.weapon-card.selected {
    background: rgba(194, 163, 93, 0.4) !important;
    outline: 2px solid var(--gold);
}

.weapon-card.locked {
    opacity: 0.4;
    filter: grayscale(1);
}
/* Champion Weapon Styling */
.weapon-card.best-match {
    border-image-source: url('outline.png') !important;
    border-image-slice: 35 fill !important;
    border-width: 25px !important;
    border-image-repeat: round !important;
    box-shadow: 0 0 30px rgba(194, 163, 93, 0.5) !important;
    padding: 15px !important;
    transform: scale(1.03);
    z-index: 5;
}
.weapon-card.best-match h3 {
    background: linear-gradient(to right, #000 20%, #8b0000 40%, #8b0000 60%, #000 80%);
    background-size: 200% auto;
    color: #000;
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: shine 3s linear infinite;
}

@keyframes shine {
    to {
        background-position: 200% center;
    }
}

.best-tag {
    background: #c2a35d;
    color: #000;
    padding: 2px 8px;
    font-size: 0.7rem;
    font-weight: bold;
    text-transform: uppercase;
    display: inline-block;
    margin-bottom: 5px;
}
.auto-stat-btn {
    background: #1a1a1c;
    border: 1px solid var(--gold);
    color: var(--gold);
    padding: 4px 8px;
    font-size: 0.7rem;
    cursor: pointer;
    font-family: 'Lora';
    margin-top: 8px;
    text-transform: uppercase;
    transition: 0.2s;
    width: 100%;
}

.auto-stat-btn:hover {
    background: var(--gold);
    color: #000;
}
 .roulette-btn {
    background: linear-gradient(45deg, #4a0000, #000);
    color: #ff4444;
    border: 1px solid #ff4444;
    padding: 10px;
    margin-top: 10px;
    width: 100%;
    font-family: 'Lora';
    font-weight: bold;
    cursor: pointer;
}
.roulette-btn:hover { background: #ff4444; color: #000; }

.user-bar {
    background: #a8a392;
    border: 1px solid #777;
    border-radius: 4px;
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
.user-info { display: flex; align-items: center; gap: 15px; }
.user-pfp { width: 50px; height: 50px; border-radius: 50%; border: 2px solid #c2a35d; object-fit: cover; background: #000; }
.user-text { display: flex; flex-direction: column; }
.user-name { font-weight: bold; font-size: 1.2rem; color: #000; }
.user-status { font-size: 0.8rem; color: #444; }

.auth-btn {
    background: #8b0000; color: #fff; border: 1px solid #500;
    padding: 8px 15px; font-family: 'Lora'; font-weight: bold; cursor: pointer;
    text-transform: uppercase; margin-left: 10px;
}
.comm-btn {
    background: #111; color: var(--gold); border: 1px solid #444;
    padding: 8px 15px; font-family: 'Lora'; font-weight: bold; cursor: pointer;
    text-transform: uppercase;
}

/* Modal Styles */
.modal { display: none; position: fixed; z-index: 3000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); }
.modal-content { 
    background: var(--parchment); color: #000; margin: 10% auto; padding: 20px; 
    border: 10px solid transparent; border-image: var(--border-path) 10 round; 
    width: 400px; text-align: center; position: relative;
}
.modal input, .modal select { 
    width: 100%; padding: 10px; margin: 5px 0; background: #fff; 
    color: #000; border: 1px solid #888; font-family: 'Lora'; 
}

/* Post Styles */
.forum-feed { margin-top: 20px; }
.post-card {
    background: #e6e4d9; /* Light parchment */
    border: 1px solid #aaa;
    margin-bottom: 20px;
    padding: 15px;
    position: relative;
    border-left: 4px solid var(--gold); 
}
.post-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
.post-author-info { display: flex; align-items: center; gap: 10px; }
.post-pfp { width: 35px; height: 35px; border-radius: 50%; border: 1px solid #555; object-fit: cover; }
.post-author-name { font-weight: bold; color: #000; font-size: 1rem; }
.admin-badge { color: red; font-weight: bold; font-size: 0.7rem; margin-left: 5px; }

.post-title { font-size: 1.6rem; font-weight: bold; color: #000; margin: 5px 0; font-family: 'Lora'; }
.post-desc { font-style: italic; color: #444; margin-bottom: 15px; border-left: 2px solid #ccc; padding-left: 10px; }

.tag-container { display: flex; gap: 5px; margin-bottom: 10px; flex-wrap: wrap; }
.tag-pill { 
    background: #333; color: var(--gold); padding: 2px 8px; 
    font-size: 0.7rem; border-radius: 4px; text-transform: uppercase; 
}
.tag-pill.filter-active { background: var(--gold); color: #000; border: 1px solid #000; }

.load-build-btn {
    background: #1a1a1c; color: var(--gold); border: 1px solid var(--gold);
    padding: 10px 20px; font-weight: bold; cursor: pointer; font-family: 'Lora';
    text-transform: uppercase; margin-bottom: 15px; width: 100%;
}
.load-build-btn:hover { background: var(--gold); color: #000; }

/* Voting */
.vote-bar { display: flex; align-items: center; gap: 10px; background: rgba(0,0,0,0.05); padding: 5px 10px; border-radius: 20px; width: fit-content; margin-top: 10px; }
.vote-arrow { background: none; border: none; cursor: pointer; font-size: 1.2rem; color: #666; font-weight: bold; }
.vote-arrow.up.active { color: #ff4444; } /* Red for upvote */
.vote-arrow.down.active { color: #4444ff; }
.vote-score { font-weight: bold; color: #000; min-width: 20px; text-align: center; }

/* Comments */
.comments-section { margin-top: 15px; border-top: 1px solid #ccc; padding-top: 10px; display: none; }
.comment-box { display: flex; gap: 10px; margin-bottom: 10px; }
.comment-item { background: rgba(255,255,255,0.5); padding: 10px; margin-bottom: 8px; border-radius: 4px; border: 1px solid #ddd; }
.comment-img-preview { max-height: 150px; max-width: 100%; display: block; margin-top: 5px; border-radius: 4px; cursor: pointer; }
.comment-deleted { color: #888; font-style: italic; background: #eee; padding: 5px; }

.admin-actions { margin-left: auto; font-size: 0.8rem; }
.del-btn { color: red; cursor: pointer; font-weight: bold; text-decoration: underline; }
.reset-btn { color: blue; cursor: pointer; text-decoration: underline; margin-right: 10px; }

/* The Button to open the forums */
.browse-btn {
    background: #000; color: var(--gold); border: 1px solid var(--gold);
    padding: 15px; width: 100%; font-family: 'Lora'; font-weight: bold; font-size: 1.1rem;
    cursor: pointer; text-transform: uppercase; margin-top: 10px;
    transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px;
}
.browse-btn:hover { background: var(--gold); color: #000; }

/* The Container for the Forum View */
.forum-view-container {
    display: none; 
    border-top: 2px solid #333;
    margin-top: 20px;
    padding-top: 20px;
    animation: fadeIn 0.3s ease;
}

/* Search Bar */
.forum-search-bar {
    width: 100%; padding: 12px; background: #fff; border: 1px solid #888;
    font-family: 'Lora'; font-size: 1rem; margin-bottom: 10px;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>');
    background-repeat: no-repeat;
    background-position: 98% center;
}

/* Post Card Updates */
.post-card { cursor: pointer; transition: transform 0.1s, border-color 0.2s; }
.post-card:hover { border-color: var(--gold); transform: translateY(-2px); }


#focus-view {
    display: none;
    background: rgba(0, 0, 0, 0.85); /* Dimmed backdrop */
    backdrop-filter: blur(5px);
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    z-index: 2500;
    overflow-y: auto;
    padding: 20px;
}

.focus-inner {
    max-width: 900px; 
    margin: 40px auto; 
    background: var(--sidebar-bg); /* Matches Theme */
    border: 1px solid #333; 
    border-radius: 8px;
    padding: 0; 
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    min-height: auto;
    color: #fff !important; /* Force white text for dark mode */
    display: flex;
    flex-direction: column;
}


.focus-inner h1, .focus-inner h2, .focus-inner h3, .focus-inner span, .focus-inner div, .focus-inner p {
    color: #eee !important;
}

.focus-header {
    background: rgba(0,0,0,0.2);
    padding: 20px;
    border-bottom: 1px solid #333;
    border-radius: 8px 8px 0 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.focus-body {
    padding: 20px;
}


.comment-item {
    background: rgba(255,255,255,0.05) !important; /* Glassy dark */
    border: none !important;
    border-left: 2px solid var(--gold) !important;
    color: #fff !important;
    margin-bottom: 12px;
}

.comment-box input {
    background: #222 !important;
    color: #fff !important;
    border: 1px solid #444 !important;
}

/* Voter List Tooltip */
.voter-list-container {
    font-size: 0.75rem;
    color: #aaa !important;
    margin-left: 10px;
    cursor: help;
    position: relative;
}

.voter-tooltip {
    visibility: hidden;
    width: 200px;
    background-color: #000;
    color: #fff;
    text-align: left;
    border-radius: 6px;
    padding: 10px;
    position: absolute;
    z-index: 1;
    bottom: 125%;
    left: 50%;
    margin-left: -100px;
    border: 1px solid var(--gold);
    opacity: 0;
    transition: opacity 0.3s;
}

.voter-list-container:hover .voter-tooltip {
    visibility: visible;
    opacity: 1;
}


.media-btn {
    background: #444; color: #fff; border: 1px solid #666; cursor: pointer; padding: 0 10px; font-size: 1.2rem;
}

@keyframes adminPulse {
    0% { 
        text-shadow: 0 0 5px var(--glow-color), 0 0 10px #fff; 
        color: #fff; 
    }
    50% { 
        text-shadow: 0 0 20px var(--glow-color), 0 0 30px var(--glow-color); 
        color: #fff; 
    }
    100% { 
        text-shadow: 0 0 5px var(--glow-color), 0 0 10px #fff; 
        color: #fff; 
    }
}

.admin-badge-glow {
    background: #000;
    border: 1px solid var(--glow-color);
    border-radius: 4px;
    padding: 2px 6px;
    font-size: 0.7rem;
    font-weight: bold;
    margin-left: 8px;
    display: inline-block;
    vertical-align: middle;
    --glow-color: #ff0000; 
    color: var(--glow-color);
    animation: adminPulse 2s infinite alternate;
}

/* --- MEDIA LIB --- */
.media-item-container { position: relative; display: inline-block; margin-right: 5px; }
.media-delete { 
    position: absolute; top: 0; right: 0; background: red; color: white; 
    font-size: 0.6rem; width: 15px; height: 15px; text-align: center; 
    cursor: pointer; border-radius: 50%; line-height: 15px;
}
.media-thumb { width: 50px; height: 50px; object-fit: cover; border: 1px solid #555; cursor: pointer; background: #000; }


.reply-spine {
    position: absolute;
    top: -15px;
    left: -10px;
    width: 25px;
    height: 12px;
    border-left: 2px solid #555;
    border-top: 2px solid #555;
    border-top-left-radius: 6px;
    pointer-events: none;
}
.reply-context {
    font-size: 0.75rem;
    color: #b9bbbe; 
    margin-bottom: 4px;
    display: flex;
    align-items: center;
    position: relative;
    margin-left: 35px; 
    cursor: pointer;
    opacity: 0.8;
    transition: opacity 0.2s;
}
.reply-context:hover {
    opacity: 1;
    text-decoration: underline;
}
.reply-preview-text {
    color: #72767d; 
    margin-left: 5px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 300px;
}
.reply-avatar-tiny {
    width: 16px; height: 16px; border-radius: 50%; margin-right: 5px;
}
@keyframes highlightFlash {
    0% { background: rgba(194, 163, 93, 0.3); } /* Gold tint */
    100% { background: transparent; }
}
.highlight-flash {
    animation: highlightFlash 1.5s ease-out;
}
.reply-input-bar {
    display: none; 
    background: #2b2d31;
    color: #ccc;
    font-size: 0.8rem;
    padding: 5px 10px;
    border-radius: 5px 5px 0 0;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #444;
}
/* --- PINNED POSTS --- */
.post-card.pinned-post {
    border: 2px solid var(--gold);
    background: rgba(194, 163, 93, 0.05); /* Slight gold tint background */
}

.pinned-badge {
    background: var(--gold);
    color: #000;
    font-size: 0.7rem;
    font-weight: bold;
    padding: 2px 6px;
    border-radius: 4px;
    margin-right: 5px;
    display: inline-flex;
    align-items: center;
    gap: 3px;
}

.pin-btn {
    color: var(--gold);
    cursor: pointer;
    font-size: 0.8rem;
    margin-left: 10px;
    font-weight: bold;
}
.pin-btn:hover { text-decoration: underline; }
::-webkit-scrollbar { width: 8px; height: 8px; }
::-webkit-scrollbar-track { background: #0a0a0b; }
::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; border: 1px solid #000; }
::-webkit-scrollbar-thumb:hover { background: var(--gold); }
    </style>
    <!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
</head>
<body>

<div class="overlay" onclick="closeSidebars()"></div>

<div id="mobile-nav">
    <button onclick="toggleSidebar('left')" style="background:none; border:1px solid #fff; color:#fff; padding:5px 15px;">Stats</button>
    <button onclick="toggleSidebar('right')" style="background:none; border:1px solid #fff; color:#fff; padding:5px 15px;">Build</button>
</div>

<div id="sidebar-left">
   <div style="width: 100%; margin-bottom: 20px;">
    <label style="font-size: 0.7rem; color: var(--gold); text-transform: uppercase; letter-spacing: 1px;">Appearance</label>
    <select id="theme-select" onchange="changeTheme(this.value)" style="width: 100%; background: #000; color: #fff; border: 1px solid #444; padding: 5px; font-family: 'Lora';">
        <option value="default">Classic</option>
        <option value="theme-flame">Flame</option>
        <option value="theme-frost">Frost</option>
        <option value="theme-gale">Gale</option>
        <option value="theme-thunder">Thunder</option>
        <option value="theme-shadow">Shadow</option>
        <option value="theme-iron">Iron</option>
        <option value="theme-blood">Blood</option>
        <option value="theme-earth">Earth</option>
    </select>
</div>

<!-- Traits Section -->
<div class="traits-medallion-container">
    <!-- Top Row -->
    <div class="trait-item">
        <div class="medallion"><input type="number" id="trait-Songchant" value="0" oninput="setTrait('Songchant', this.value)"></div>
        <div class="trait-label">Songchant</div>
    </div>
    <div class="trait-item">
        <div class="medallion"><input type="number" id="trait-Erudition" value="0" oninput="setTrait('Erudition', this.value)"></div>
        <div class="trait-label">Erudition</div>
    </div>
    
    <!-- Bottom Row -->
    <div class="trait-item">
        <div class="medallion"><input type="number" id="trait-Vitality" value="0" oninput="setTrait('Vitality', this.value)"></div>
        <div class="trait-label">Vitality</div>
    </div>
    <div class="trait-item">
        <div class="medallion"><input type="number" id="trait-Proficiency" value="0" oninput="setTrait('Proficiency', this.value)"></div>
        <div class="trait-label">Proficiency</div>
    </div>
</div>
<div id="trait-sum-display">Points: <span id="trait-sum">0</span> / 12</div>

<div class="investment-header">
    <h2>Investment</h2>
    <span class="pts-display">
        <div style="font-size: 0.9rem; margin-top: 5px; color: var(--gold);">
            Talents: <span id="talent-count">0</span> / 80
        </div>
        <span id="used-pts">0</span> / <span id="max-pts">410</span>
    </span>
    <div id="splash-text"></div>
</div>

<select id="oath-select" onchange="setOath(this.value)">
    <option value="">SELECT OATH</option>
    <option value="Saintsworn">Saintsworn</option>
    <option value="Blightsurger">Blightsurger</option>
    <option value="Linkstrider">Linkstrider</option>
    <option value="Fadetrimmer">Fadetrimmer</option>
    <option value="Dawnwalker">Dawnwalker</option>
    <option value="Contractor">Contractor</option>
    <option value="Soulbreaker">Soulbreaker</option>
    <option value="Silentheart">Silentheart</option>
    <option value="Warmaster">Warmaster</option>
    <option value="Starkindred">Starkindred</option>
    <option value="BladeHarper">BladeHarper</option>
    <option value="Tetherlance">Tetherlance</option>
    <option value="Blindseer">Blindseer</option>
    <option value="Chainwarden">Chainwarden</option>
    <option value="Ironfist">Ironfist</option>
    <option value="Arcwarder">Arcwarder</option>
    <option value="Jetstriker">Jetstriker</option>
    <option value="Aetherkeeper">Aetherkeeper</option>
    <option value="Kingslayer">Kingslayer</option>
    <option value="Timeripper">Timeripper</option>
    <option value="Fearfighter">Fearfighter</option>
    <option value="oathless">oathless</option>
    <option value="Edencrusher">Edencrusher</option>
</select>

<hr style="width:100%; border:0; border-top:1px solid #333; margin:15px 0;">
<div id="core-inputs" style="width: 100%;"></div>
<hr style="width:100%; border:0; border-top:1px solid #333; margin:15px 0;">
<div id="att-inputs" style="width: 100%;"></div>

<div style="width: 100%; margin-top: auto;">
    <button class="action-btn" onclick="saveBuild()" style="background: var(--gold); color: #000; border:none;">SHARE BUILD LINK</button>
    <button class="action-btn" onclick="exportBuildToDWM()" style="background: #2f2f35; color: #fff; border:none; margin-top: 5px;">EXPORT BUILD TO DWM</button>
    <button class="action-btn" style="color:#ff4444;" onclick="clearBuild()">CLEAR BUILD</button>
    <button class="roulette-btn" onclick="buildRoulette()">Evil ass button</button>
</div>
</div>

<div id="main-area">
    <div class="tab-container">
        <div class="tab-btn active" id="tab-talents" onclick="switchTab('talents')">Talents</div>
        <div class="tab-btn" id="tab-mantras" onclick="switchTab('mantras')">Mantras</div>
        <div class="tab-btn" id="tab-weapons" onclick="switchTab('weapons')">Weapons</div>
        <div class="tab-btn" id="tab-summary" onclick="switchTab('summary')">Summary</div>
        <div class="tab-btn" id="tab-community" onclick="switchTab('community')">Community</div>
        <div class="tab-btn" id="tab-guide" onclick="switchTab('guide')">Guide</div>
    </div>

    <div id="search-bar" class="search-bar-container">
        <input type="text" id="search-input" placeholder="Search..." oninput="renderItems()">
        <label style="font-size: 0.85rem; color: #ccc; cursor: pointer;">
            <input type="checkbox" id="filter-reqs" onchange="renderItems()"> Show things that fit Requirements
        </label>
    </div>

    <div id="item-container"></div>
</div>

<div id="sidebar-right">
    <div style="padding: 15px; text-align: center; font-weight: bold; border-bottom: 2px solid #000; font-size: 1.1rem; text-transform: uppercase;">Build Overview</div>
    <div id="selection-list" style="overflow-y: auto; flex: 1;"></div>
</div>
<div id="focus-view" style="display: none;">
    <div class="focus-inner">
        <div id="focus-content"></div>
    </div>

<!-- 1. AUTH MODAL -->
<div id="auth-modal" class="modal" style="display:none; position:fixed; z-index:4000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.8); backdrop-filter:blur(3px);">
    <div class="modal-content" style="background: var(--sidebar-bg); color: #fff; border: 1px solid #444; margin: 10% auto; padding: 20px; width: 400px; box-shadow: 0 0 20px rgba(0,0,0,0.8); position:relative;">
        <span onclick="document.getElementById('auth-modal').style.display='none'" style="float:right; cursor:pointer; font-size:1.5rem; color:#fff;">&times;</span>
        <h2 id="auth-title" style="margin-top:0; text-align:center; font-family:'Lora';">Login</h2>
        
        <input type="text" id="auth-user" placeholder="Username" style="display:none; width:100%; padding:12px; margin:5px 0; background:#0a0a0b; color:#fff; border:1px solid #333; font-family:'Lora';">
        <input type="email" id="auth-email" placeholder="Email" style="width:100%; padding:12px; margin:5px 0; background:#0a0a0b; color:#fff; border:1px solid #333; font-family:'Lora';">
        <input type="text" id="auth-pfp" placeholder="PFP URL (Optional)" style="display:none; width:100%; padding:12px; margin:5px 0; background:#0a0a0b; color:#fff; border:1px solid #333; font-family:'Lora';">
        <input type="password" id="auth-pass" placeholder="Password" style="width:100%; padding:12px; margin:5px 0; background:#0a0a0b; color:#fff; border:1px solid #333; font-family:'Lora';">
        
        <button class="action-btn" onclick="submitAuth()" style="margin-top:15px; background:var(--gold); color:#000; border:none; font-weight:bold; width:100%; padding:10px;">SUBMIT</button>
        <div style="margin-top:15px; font-size:0.8rem; cursor:pointer; text-decoration:underline; color:#aaa; text-align:center;" onclick="toggleAuthMode()">Switch to Sign Up / Login</div>
    </div>
</div>

<!-- 2. POST MODAL -->
<div id="post-modal" class="modal" style="display:none; position:fixed; z-index:4000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.8);">
    <div class="modal-content" style="background: var(--sidebar-bg); color: #fff; border: 1px solid #444; margin: 5% auto; padding: 20px; width: 500px;">
        <span onclick="document.getElementById('post-modal').style.display='none'" style="float:right; cursor:pointer; color:#fff;">&times;</span>
        <h2 style="margin-top:0;">Publish Build</h2>
        
        <input type="text" id="post-title" placeholder="Build Title" style="width:100%; padding:10px; margin-bottom:10px; background:#000; color:#fff; border:1px solid #333;">
        <textarea id="post-desc" style="width:100%; height:80px; padding:10px; margin-bottom:10px; background:#000; color:#fff; border:1px solid #333; font-family:'Lora';" placeholder="Description"></textarea>
        
        <div style="margin-bottom:10px;">
            <label style="color:#aaa; font-size:0.9rem;">Select Tags:</label><br>
            <!-- Tags Container -->
            <div id="post-tag-container" style="display:flex; flex-wrap:wrap; gap:10px; margin-top:5px; color:#ddd;">
                <!-- Will be filled by JS -->
            </div>
        </div>

        <button class="action-btn" onclick="submitPost()">PUBLISH</button>
    </div>
</div>
</div>
</div>
<script>

// how to add talents / { "name": "Return to the Dark Ages", "desc": "10% less Outgoing and Incoming Mantra DMG.", "req": {} } 
// the req should be like "Strength": 20 if no req, leave it empty
// OR_weapon means any weapon req for example, 80 light or hvy or med works 
// there are: MedOrHeavy , MedOrLight , LightOrHeavy for better reqs
const gameData = {
    attributes: ["Strength", "Fortitude", "Agility", "Intelligence", "Willpower", "Charisma", "Precision", "Light Weapon", "Medium Weapon", "Heavy Weapon"],
    attunements: ["Flamecharm", "Frostdraw", "Thundercall", "Shadowcast", "Galebreathe", "Ironsing", "Bloodrend", "Earthbend"],
    talents: {
        "No Stat Reqs": [{ "name": "Return to the Dark Ages", "desc": "10% less Outgoing and Incoming Mantra DMG. [5 hp]", "req": {} },{ "name": "Lightweight", "desc": "Move faster when armor is 0%. [+1 Posture]", "req": {} },{ "name": "The Sounds from Below", "desc": "[+115hp]", "req": {} },{ "name": "Armor Conserver", "desc": "15% less armor drain on hit.", "req": {} },{ "name": "Murmur: Ardour", "desc": "Deal 15% more posture DMG and take 15% less when pressing H.", "req": {} }],
        "Strength": [{ "name": "Duelist’s Dance", "desc": "25% more posture from parrying. [+2 Posture]", "req": { "Strength": 20 } },{ "name": "Harsh Response", "desc": "Enemies receive less posture when parrying you.", "req": { "Strength": 25 } },{ "name": "Bulldozer", "desc": "Enemies you flourish into a wall have a chance of breaking the wall and are guard broken on impact.", "req": { "Strength": 25 } },{ "name": "Lose Your Mind", "desc": "Deal more DMG scaling with insanity up to 10% max. [+5 hp]", "req": { "Strength": 30 } },{ "name": "Unwavering Resolve", "desc": "Getting parried punishes your posture 33% less. [+2 Posture]", "req": { "Strength": 40 } },{ "name": "Shield Breaker", "desc": "Blunt Damage now fully ignores the posture from Shields. [+1 Posture]", "req": { "Strength": 60 } },{ "name": "Piercing Blow", "desc": "Guardbreaks Ignore Armor Resistance.", "req": { "Strength": 80 } },{ "name": "Berserk", "desc": "Succumb to the burning rage within, nullifying your own armor in exchange for nullifying the armor of your foes on your Basic Attacks. Grants your Criticals +10% PEN while active.", "req": { "Strength": 80 } },{ "name": "Million Ton Piercer", "desc": "Gain 5% extra PEN and remove the cap on your PEN. Go beyond your limits.", "req": { "Strength": 90 } },{ "name": "Collapsed Lung", "desc": "Block breaking an opponent closes off their ability to Vent for 8s, duration scales with Strength.", "req": { "Strength": 100 } },{ "name": "Dreambreaker", "desc": "On Flourish, Disables Tempo Drain and gives Tempo gain for 10s, Decrease target tempo gain for 7.5s. (Locks Collapsed Lung)", "req": { "Strength": 100 } }],
        "Precision": [{ "name": "Deflecting Handyman", "desc": "Posture Removal cooldown on parry is decreased by 0.25s. [+1 Posture]", "req": { "Precision": 20 } },{ "name": "Dead Eye", "desc": "Opponents who dodge will take 10% PEN on next attack. (8s CD)", "req": { "Precision": 40 } },{ "name": "Deadly Blow", "desc": "After Dodge, +25% Posture DMG for 3s. (10s CD)", "req": { "Precision": 50 } },{ "name": "Successive Strikes", "desc": "M1 Strings and Criticals build up stacks of increased DMG that last 5s, Dead Eye will not cancel on next hit.", "req": { "Precision": 60 } },{ "name": "Decisive Battle", "desc": "Cancelling an opponents block from behind will increase the damage by 10%", "req": { "Precision": 60 } },{ "name": "Close Quarters", "desc": "The first parry in an aerial state won’t knock you back. (20s CD) [+1 Posture]", "req": { "Precision": 75 } },{ "name": "Fatality", "desc": "Guardbreaking an Opponents Stuns them for longer. [+1 Posture]", "req": { "Precision": 80 } },{ "name": "Pinpoint Accuracy", "desc": "Bullets are now faster.", "req": { "Precision": 80 } },{ "name": "Hidden Blade", "desc": "Spine Cutter now applies anti-heal", "req": { "Precision": 80 } },{ "name": "Upcoming Opportunity", "desc": "Uncap PEN + gain 30% PEN for 3s Upon Parry or Dodge. (5s CD)", "req": { "Precision": 90 } }],
        "Fortitude": [{ "name": "Battle Tendency", "desc": "20% faster posture regen.", "req": { "Fortitude": 15 } },{ "name": "Braced Collapse", "desc": "After being block broken, the next attack to hit you deals reduced damage.", "req": { "Fortitude": 25 } },{ "name": "Exoskeleton", "desc": "Natural Armor resists 10% Physical Damage when active. Replenishes when resting.", "req": { "Fortitude": 40 } },{ "name": "To the Finish", "desc": "You take 10% less damage when below 30% health.", "req": { "Fortitude": 50 } },{ "name": "Turtle Shell", "desc": "If your shield is on your back, take reduced backstab damage and negate Spine Cutter.", "req": { "Fortitude": 50 } },{ "name": "Dancing Guard", "desc": "Parrying an opponent and then parrying another enemy in quick succession applies slow for 7s.", "req": { "Fortitude": 55 } },{ "name": "Knuckle Guard", "desc": "Hitting Dazed enemies grants you 10% posture resistance for 15s.", "req": { "Fortitude": 55, "Strength": 25 } },{ "name": "Down to your Level", "desc": "While you have a speed debuff, your Basic Attacks slow your enemies for 5s.", "req": { "Fortitude": 60 } },{ "name": "Defensive Reprisal", "desc": "Being flourished grants you 10% posture resistance for 20s.", "req": { "Fortitude": 65 } },{ "name": "Reinforced Armor", "desc": "Incoming PEN is reduced by 30%.", "req": { "Fortitude": 90 } },{ "name": "Armorclad", "desc": "Flourishing, or Getting Guardbroken gives you slight dmg resistance for 10s.", "req": { "Fortitude": 100 } }],
        "Agility": [{ "name": "Lowstride", "desc": "Crouching stealth and roll distance increased. Smaller speed penalty. Silent weapon draw.", "req": { "Agility": 20 } },{ "name": "Kick Off", "desc": "No damage from short falls. Higher wall jumps. Speed boost after wall jumping.", "req": { "Agility": 20 } },{ "name": "Safety Dance", "desc": "Your base dodge frames are increased by 0.05s.", "req": { "Agility": 20 } },{ "name": "Observation", "desc": "Dodge frames are larger if you cancel your roll immediately.", "req": { "Agility": 20 } },{ "name": "Risky Moves", "desc": "When you successfully dodge, you'll automatically dodge the next attack.", "req": { "Agility": 25 } },{ "name": "Speed Emission", "desc": "Gain a slight speed boost after landing a vent.", "req": { "Agility": 25 } },{ "name": "Speed Demon", "desc": "Your attacks now inflict a reduced-strength bleed while you have a speed boost. 1s cooldown.", "req": { "Agility": 25 } },{ "name": "Blade Dancer", "desc": "Landing a Basic Attack removes your roll cooldown.", "req": { "Agility": 25 } },{ "name": "Deep Wound", "desc": "Assassinating a target applies anti-heal for 20s and gives you a speed boost for 6s.", "req": { "Agility": 35 } },{ "name": "Ghost", "desc": "Dodging a move will briefly make you invisible, ending early if you attack.", "req": { "Agility": 40 } },{ "name": "Lights Out", "desc": "Assassinations give 30% PEN and blind the target for 5s.", "req": { "Agility": 55 } },{ "name": "Tap Dancer", "desc": "Rolling immediately after a roll-cancel no longer puts your roll on a longer cooldown.", "req": { "Agility": 60 } },{ "name": "Unseen Threat", "desc": "Assassinate those with weapons out if not in combat. Targets are slowed and cannot jump for 3s.", "req": { "Agility": 60 } },{ "name": "Cheap Shot", "desc": "Attacks gain 10% PEN multiplicatively with an active speed boost.", "req": { "Agility": 65 } },{ "name": "Down Comes the Claw", "desc": "Landing Critical with speed boost prevents opponent from dodging twice in a row for 5s.", "req": { "Agility": 75 } },{ "name": "Pursuit", "desc": "If you land Revenge, Reset the Cooldown (25s CD)", "req": { "Agility": 90 } },{ "name": "Dustlunge", "desc": "Assassinate from farther via shade stepping. Chain assassinate nearby enemies.", "req": { "Agility": 90 } },{ "name": "Maiming Claws", "desc": "Down Comes the Claw now disables opponent's posture regeneration for 6s on proc.", "req": { "Agility": 100 } }],
        "Intelligence": [{ "name": "Ether Absorption", "desc": "Receive Ether back when inflicted with damage from Mantras.", "req": { "Intelligence": 15 } },{ "name": "Perfect Flash", "desc": "Over 95% health causes mantras to do +25% damage.", "req": { "Intelligence": 20 } },{ "name": "Eureka", "desc": "Gain Inspiration stacks on mantra land/parry. 3 stacks grant +10% Mantra Damage.", "req": { "Intelligence": 30 } },{ "name": "True Ether Bullets", "desc": "Ether Bullets apply elemental damage of highest investment.", "req": { "Intelligence": 30, "Weapon": 20 } },{ "name": "Overflowing Dam", "desc": "Full Ether for 2s grants an aura for 10% more damage.", "req": { "Intelligence": 40 } },{ "name": "Foolish Outburst", "desc": "Blocking or parrying a vent absorbs the Tempo cost of the vent.", "req": { "Intelligence": 50 } },{ "name": "Keen Recovery", "desc": "Basic attack after feinting a mantra restores the feinted mantra's ether cost.", "req": { "Intelligence": 55 } },{ "name": "Prime Ether Bullets", "desc": "Bullets take one less hit to proc elements and have intelligence scaling.", "req": { "Intelligence": 60, "Light": 90 } },{ "name": "Twelve Steps Ahead", "desc": "Landing Prediction halves cooldown; whiffing doubles it.", "req": { "Intelligence": 80 } },{ "name": "Ether Overdrive", "desc": "Gain 5% extra PEN and remove the cap on your PEN.", "req": { "Intelligence": 90 } },{ "name": "Absolute Pitch", "desc": "You can cast ritual mantra’s instantly.", "req": { "Intelligence": 100 } }],
        "Willpower": [{ "name": "Disbelief", "desc": "Resistant to Illusion magic, charms, and tricks.", "req": { "Willpower": 25 } },{ "name": "Magical Resolve", "desc": "Being hit increases ether regen.", "req": { "Willpower": 40 } },{ "name": "Ardour Scream", "desc": "Amplify shout to make victims take 25% more DMG and Posture for 10s.", "req": { "Willpower": 40 } },{ "name": "Underdog", "desc": "Deal more damage to those with higher HP, scales with WILL.", "req": { "Willpower": 40 } },{ "name": "Heretic's Sutra", "desc": "A chant that steers you into the state of Insanity for 20 seconds.", "req": { "Willpower": 80 }},{ "name": "Piercing Will", "desc": "When sanity is below 35%, gain up to +15% PEN.", "req": { "Willpower": 80 } },{ "name": "Psychic", "desc": "Opponents with <50% sanity cannot proc Deep Gems against you briefly.", "req": { "Willpower": 80 } },{ "name": "Shared Misery", "desc": "Attacking while losing sanity causes enemies to lose sanity.", "req": { "Willpower": 90 } },{ "name": "Beleaguered But Unbowed", "desc": "Damage reduction when surrounded by 2 or more opponents.", "req": { "Willpower": 90 } },{ "name": "Sin Stacker", "desc": "All The Dead Gods' duration is based on enemy antiheal stacks.", "req": { "Willpower": 90 } },{ "name": "Indomitable Spirit", "desc": "Sanity attacks are redirected to nearby opponents.", "req": { "Willpower": 100 } }],
        "Charisma": [{ "name": "Vow of mastery", "desc": "Vow of Mastery Grants the master the power to command their subject. to initiate a vow, you ask the other player if they'd like to make a vow E.G. wanna make a vow of mastery? / U NEED 75 charm to use every command on VoM. / reseting yourself to remove the VoM cds and spam them are bannable", "req": { "Charisma": 20 } }, { "name": "Charismatic Cast", "desc": "Landing mantras charms enemies, reducing damage done to you.", "req": { "Charisma": 25 } },{ "name": "Tough Love", "desc": "Deal 10% more damage to charmed enemies.", "req": { "Charisma": 25 } },{ "name": "Give and Take", "desc": "Deal and receive less DMG from comrades.", "req": { "Charisma": 35 } },{ "name": "Golden Tongue", "desc": "Typing or gestures give random buffs to you and allies.", "req": { "Charisma": 40 } },{ "name": "Lasting Charisma", "desc": "Enemies charmed by mantras stay charmed longer.", "req": { "Charisma": 55 } },{ "name": "Chaotic Charm", "desc": "At low health, naturally apply charm to reduce incoming damage.", "req": { "Charisma": 55 } },{ "name": "Dazing Finisher", "desc": "Flourishing charmed enemies dazes them instead of knockback.", "req": { "Charisma": 55 } },{ "name": "Manipulator", "desc": "Deal 20% more critical damage to charmed enemies; removes charm.", "req": { "Charisma": 60 } },{ "name": "Narcissist", "desc": "Charming an already charmed opponent Overcharms you briefly.", "req": { "Charisma": 60 } },{ "name": "Unnecessary Theatrics", "desc": "Deliver a one-liner on heavy attacks that charms opponents briefly.", "req": { "Charisma": 75 } },{ "name": "Cornered Fool", "desc": "Blockbreaking a charmed opponent procs Taunt.", "req": { "Charisma": 85 } },{ "name": "Cult of Personality", "desc": "Gain +3% PEN for each person Charmed, capping at 15%.", "req": { "Charisma": 90 } },{ "name": "Off Your Game", "desc": "Slow Taunted enemies when you hit them.", "req": { "Charisma": 90 } }],
        "Multi-Stats": [{ "name": "Parasol's Brain", "desc": "You feel as if your brain were expanding. (IT BUFFS YOUR GEM, HERE IS THE LIST OF BUFFS)  / Aegis Gem: Duration increased from 8s to 15s / Blessed Gem: Cooldown reduction increased, from divided by 2 to divided by 3 / Bloodless Gem: Damage reduced by 50%, healing increased to 50% / Insignia Gem: Decreases Insignia Cooldown from 10 to 7 seconds / Might Gem: Posture damage buff increased from +20% to +35%. Wayward Gem: Cooldown is decreased from 8s to 3s / Wind Gem: Speed boost increased from 5 to 9 / Wrath Gem: Critical damage buff increased from 20% to 30% / Fraud Gem: Damages sanity from maximum sanity divided by 15 to divided by 5 / Erosion Gem: Armor drain increased from damage divided by 2 to damage divided by 1.5 / Sealing Gem: Increases Anti-Heal duration from 10 to 15 seconds.", "req": {"Intelligence": 100 , "Willpower": 80 , "Charisma": 50} }, { "name": "Professional's Standard", "desc": "Charmed opponents take +10% pen","req": { "Precision": 50, "Charisma": 25 } },{ "name": "Sturdy Control", "desc": "Gain 2.5% pen for every M1/Crit after being hit, cap 15%.", "req": { "Precision": 50, "Fortitude": 40 } },{ "name": "Master of His Craft", "desc": "Parrying a vent grants +20% PEN for 5 seconds.", "req": { "Precision": 10, "Intelligence": 10 } },{ "name": "Concussion", "desc": "Flourishing enemies into walls dazes them longer and alters vision.", "req": { "Strength": 20, "Fortitude": 15 } },{ "name": "Matador", "desc": "Deal +20% more damage to human enemies with hyperarmor.", "req": { "Strength": 20, "Agility": 5 } },{ "name": "Lightspeed Reflexes", "desc": "Feinting gives a very brief auto-parry window.", "req": { "Agility": 20, "Intelligence": 20 } },{ "name": "Grasp on Reality", "desc": "Reduced damage from insanity; Shared Misery is less effective.", "req": { "Fortitude": 25, "Willpower": 5 } },{ "name": "Strong Stern", "desc": "The duration you are dazed from wall bangs is cut in half.", "req": { "Strength": 15, "Fortitude": 25 } },{ "name": "Endurance Runner", "desc": "Keep moving even when things look dire.", "req": { "Fortitude": 25, "Agility": 25 } },{ "name": "Conditioned Runner", "desc": "Regen faster while running, slower while not.", "req": { "Fortitude": 25, "Agility": 25 } },{ "name": "Spine Cutter", "desc": "Hit enemy in back after roll cancel for raw weapon damage follow-up.", "req": { "Strength": 20, "Agility": 25 } },{ "name": "Knight's Rally", "desc": "When using a shield, ready block more quickly after a hit.", "req": { "Fortitude": 30, "Willpower": 10 } },{ "name": "Breaking Stereotype", "desc": "Guard breaking an opponent with your critical applies knockdown.", "req": { "Precision": 50, "Strength": 50 } },{ "name": "All The Dead Gods", "desc": "Your Attacks now Apply Anti-Heal. [+5 hp]", "req": { "Intelligence": 40, "Willpower": 65 } },{ "name": "Stress Resistant", "desc": "While in Combat, Insanity only affects every 2nd time.", "req": { "Precision": 25, "Willpower": 40 } },{ "name": "Unfazed", "desc": "More resilient to insanity side effects. No shivering, less panic.", "req": { "Willpower": 50, "Fortitude": 50 } },{ "name": "Steady Nerves", "desc": "Successful dodges restore posture.", "req": { "Strength": 15, "Agility": 45 } },{ "name": "Tooth and Claw", "desc": "Precision & Strength mantras now have 20% PEN.", "req": { "Strength": 50, "Precision": 50 } },{ "name": "Behind You", "desc": "Basic attack behind enemy after mantra feint deals ether-scaling damage.", "req": { "Intelligence": 70, "Agility": 40 } },{ "name": "One of a Kind", "desc": "Crits/Flourishes extend Charm duration and ignore Disbelief.", "req": { "Charisma": 80, "Willpower": 80 } },{ "name": "Dancing With The Dead", "desc": "For every nearby enemy gain 2.5% PEN.", "req": { "Precision": 80, "Intelligence": 20 } },{ "name": "Bad Guy Coming Through", "desc": "Block-breaking an opponent applies 50% damage as Insanity.", "req": { "Strength": 100, "Willpower": 50 } },{ "name": "All Above, Gods Below", "desc": "Stun and steal any healing opponent would receive.", "req": { "Willpower": 100, "Intelligence": 100 } },{ "name": "Crisis Point", "desc": "At 30% Health, disable all anti-heals for 20s.", "req": { "Fortitude": 50, "Willpower": 100 } },{ "name": "Brick Wall", "desc": "Immune to knockdown until knocked unconscious.", "req": { "Fortitude": 100, "Willpower": 100 } },{ "name": "On Your Toes", "desc": "Gain brief auto-parry frames while equipping weapon.", "req": { "Agility": 40, "Willpower": 40 } }],
        "Weapon Talents": [
            { "name": "Flash Pressure", "desc": "Breeze Blitz extender.", "req": { "Light Weapon": 40 } },
            { "name": "Knife's Journey", "desc": "Cancelling enemy mantra windup with M1 deals 15% more damage.", "req": { "Light Weapon": 30 } },
            { "name": "Decisive Blow", "desc": "Critting after an enemy dodge procs Knife's Journey for 2x Armor dmg.", "req": { "Light Weapon": 30 } },
            { "name": "Successive Throw", "desc": "Throw a dagger after a successful flourish.", "req": { "Light Weapon": 35 } },
            { "name": "Switchblade", "desc": "Utilize Dagger Talents when not wielding a dagger.", "req": { "Light Weapon": 50, "MedOrHeavy": 50 } },
            { "name": "Mayday", "desc": "Aerial flourishes knockdown for much longer.", "req": { "Precision": 80, "Weapon": 40 } },
            { "name": "Virtuoso", "desc": "Temporarily proc talents of other weapon types in same class.", "req": { "Precision": 80, "OR_Weapon": 80 } },
            { "name": "Prodigy of All", "desc": "Flourish/Uppercut allows procing talents from other weapon classes for 15s.", "req": { "Light Weapon": 80, "Medium Weapon": 80, "Heavy Weapon": 80 } },
            { "name": "Critical Engine", "desc": "Ability to use Deep Gems on your critical attack.", "req": { "Intelligence": 90, "Weapon": 30 } },
            {  "name": "Ambidexterity", "desc": "Shields and parrying daggers by default are slightly stronger. Offhand guns are slightly faster.", "req": { "Light Weapon": 80, "MedOrHeavy": 50 } }
        ],
        "Flamecharm": [{ "name": "Eruption Path: Lava Serpent", "desc": "Every time you would set people aflame, eruptions spawn at their feet instead.", "req": { "Flamecharm": 50 } },{ "name": "Molten Defense", "desc": "Upon being Block Broken, cause an eruption. (30s CD)", "req": { "Flamecharm": 75, "Path": "Eruption" } },{ "name": "Flash Point", "desc": "Landing 3 fire mantras will set your enemy aflame.", "req": { "Flamecharm": 100, "Path": "Eruption" } },{ "name": "Double Trouble", "desc": "Landing a fire attack while eruption is charging causes an explosion.", "req": { "Flamecharm": 100, "Path": "Eruption" } },{ "name": "The Floor is Lava", "desc": "Your eruptions leave burning pools of lava beneath them.", "req": { "Flamecharm": 100, "Path": "Eruption" } },{ "name": "Flaming Flourish", "desc": "Your Flourish applies burn.", "req": { "Flamecharm": 25 } },{ "name": "Pleeksty’s Faith", "desc": "When on fire, automatically put out the flames at the cost of some ether.", "req": { "Flamecharm": 25, "Willpower": 15, "Charisma": 15 } },{ "name": "Meteor Impact", "desc": "Aerial moves follow up into a devastating slam.", "req": { "Flamecharm": 25 } },{ "name": "Dancing Steps", "desc": "Dash forward whenever using a flame mantra.", "req": { "Flamecharm": 35 } },{ "name": "Cauterized Wounds", "desc": "Blood loss from all sources is lowered.", "req": { "Flamecharm": 40, "Fortitude": 5 } },{ "name": "Explosive Flourish", "desc": "Hitting opponents with a fire attack after a flourish causes an explosion. (15s CD)", "req": { "Flamecharm": 50 } },{ "name": "Flame Within", "desc": "Set yourself on fire for a 10% DMG and 10% speed increase.", "req": { "Flamecharm": 50 } },{ "name": "Immolation", "desc": "Mantras cost 70% less ether while burning. M1s gain innate blazing. Take 50% less dmg from Flame Within.", "req": { "Flamecharm": 50 } },{ "name": "Mirage Clone", "desc": "Dodging an attack successfully sets the attacker on fire.", "req": { "Flamecharm": 65 } },{ "name": "Azure Flames", "desc": "Flames burn blue, increasing DoT. Eruption variant delays eruptions but increases dmg.", "req": { "Flamecharm": 75, "Willpower": 40 } },{ "name": "Ash Ember", "desc": "The more wither your opponent has, the more damage your burn deals.", "req": { "Flamecharm": 90, "Weapon": 1 } },{ "name": "Scorching Decay", "desc": "The wither dealt from Emperor's Flame is massively increased.", "req": { "Flamecharm": 100, "Weapon": 100 } },{ "name": "The Final Act", "desc": "M1s on burning enemies cause explosions. (15s CD) (Mutual with Eruption)", "req": { "Flamecharm": 75 } },{ "name": "Emperor Flame", "desc": "Upon activating Final Act, coat yourself in flames, increasing DMG and speed for 20s. (60s CD)", "req": { "Flamecharm": 80 } }],
        "Frostdraw": [{ "name": "Glass Path: Crystallization", "desc": "Ice mantras no longer slow; instead, they grow crystals on opponents.", "req": { "Frostdraw": 40 } },{ "name": "Crystal Shrapnel", "desc": "Crystal explosions have an AoE that applies crystals to all hit.", "req": { "Frostdraw": 60, "Path": "Glass" } },{ "name": "Reclaimed Glass", "desc": "Crystal Shrapnel grants you and allies 10% Elemental Resistance for 10s.", "req": { "Frostdraw": 65, "Path": "Glass" } },{ "name": "Frostbite", "desc": "Enemies no longer heal when under the effect of chill.", "req": { "Frostdraw": 25 } },{ "name": "Saint Jay", "desc": "Redirect 60% of an enemy's nullified healing to yourself. Increased if enemy is on ice.", "req": { "Frostdraw": 25, "Talent": "Frostbite" } },{ "name": "Cool Head", "desc": "Being set on fire while on ice puts it out and grants fire immunity for 30s. (15s CD)", "req": { "Frostdraw": 30 } },{ "name": "Cryonis", "desc": "All ice spells cast on ice cost less ether.", "req": { "Frostdraw": 40 } },{ "name": "Cold Front", "desc": "Your vent is imbued with glacial frost.", "req": { "Frostdraw": 40, "Talent": "Cryonis" } },{ "name": "Chilling Flourish", "desc": "Flourish applies chill or crystals.", "req": { "Frostdraw": 50 } },{ "name": "Fragile Freeze", "desc": "Light attacks and criticals freeze chilled opponents on guardbreak.", "req": { "Frostdraw": 55 } },{ "name": "Frozen Pin-Cushion", "desc": "Ice Daggers freeze opponents in place.", "req": { "Frostdraw": 60, "Mantra": "Ice Daggers" } },{ "name": "Orbital Ice", "desc": "Parrying on ice forms a ring that absorbs 15% physical damage.", "req": { "Frostdraw": 65 } },{ "name": "Cryostasis", "desc": "Take decreased damage for 3s after being guard broken. (25s CD)", "req": { "Frostdraw": 80 } },{ "name": "Stasis Strike", "desc": "Crystal explosions deal more damage if the opponent is bottom frozen.", "req": { "Frostdraw": 90, "Weapon": 90 } },{ "name": "Frozen Anchor", "desc": "Apply bottom freeze and chill on flourish, uppercut, or crit.", "req": { "Frostdraw": 100, "Weapon": 100 } },{ "name": "Unyielding Frost", "desc": "Chill procs through block at 80% duration.", "req": { "Frostdraw": 100 } }],
        "Galebreathe": [{ "name": "Haunted Path: Specter", "desc": "Lose suffocation for a spectral gauge.", "req": { "Galebreathe": 50 } },{ "name": "Apparitions", "desc": "Phantoms apply winded; cannot be parried during phantom step.", "req": { "Galebreathe": 50, "Path": "Haunted" } },{ "name": "Phantom Step", "desc": "High speed running and gale dashes (Requires 10% spectral gauge).", "req": { "Galebreathe": 55, "Path": "Haunted" } },{ "name": "Vanishing Wraith", "desc": "Aerial attacks in phantom step teleport you behind the target.", "req": { "Galebreathe": 60, "Path": "Haunted" } },{ "name": "Possession", "desc": "Apparition hits grant posture dmg or chip dmg depending on phantom step.", "req": { "Galebreathe": 75, "Path": "Haunted" } },{ "name": "Suffocating Impact", "desc": "Suffocate enemies when flourishing them into walls.", "req": { "Galebreathe": 35, "Strength": 15 } },{ "name": "Wind Step", "desc": "Gain a double jump and a large slide leap. (7s CD)", "req": { "Galebreathe": 40 } },{ "name": "Haunted Gale", "desc": "Every 3 hits with perfect cast gale mantras strike the target with a wind phantom.", "req": { "Galebreathe": 40 } },{ "name": "Cyclone Blade", "desc": "Gale dashes empower your next light attack with 30% bleed DMG and 10% chip.", "req": { "Galebreathe": 55, "Agility": 30 } },{ "name": "Silencer's Blade", "desc": "Meleeing a suffocated opponent extends duration and grants speed.", "req": { "Galebreathe": 60 } },{ "name": "Air Pressure", "desc": "Dodging or hitting blocks turns your next dash into a gale dash.", "req": { "Galebreathe": 50, "Agility": 20 } },{ "name": "AWS (A World Without Song)", "desc": "Wind attacks inflict suffocation for 5s.", "req": { "Galebreathe": 75 } },{ "name": "Silencer's Song", "desc": "Silencer’s Blade now procs on mantras.", "req": { "Galebreathe": 100, "Weapon": 100 } }],
        "Thundercall": [{ "name": "Surge Path: Unstable Capacitor", "desc": "Apply surge stacks instead of shock. Max stacks cause an overload arc.", "req": { "Thundercall": 40 } },{ "name": "Fried Circuits", "desc": "Overloading an enemy applies Sapped for 5s.", "req": { "Thundercall": 40, "Path": "Surge" } },{ "name": "Closed Circuit", "desc": "Failed overload arcs deal damage directly to the overloaded enemy.", "req": { "Thundercall": 40, "Path": "Surge" } },{ "name": "Catalytic Strike", "desc": "Posture breaking a target overloads their surge stacks.", "req": { "Thundercall": 40, "Path": "Surge" } },{ "name": "Human Battery", "desc": "Convert nearby surge stacks into ether when empty.", "req": { "Thundercall": 40, "Path": "Surge" } },{ "name": "Raiton Path: Enlightened", "desc": "Decrease ether regen and tempo gain. 3 stacks overcharge the opponent.", "req": { "Thundercall": 50 } },{ "name": "Raiton's Charge", "desc": "Overcharge now sets people on fire.", "req": { "Thundercall": 75, "Path": "Raiton" } },{ "name": "Simple Path: Electrocution", "desc": "3 thunder hits apply Electrocution, increasing blood loss and burn dmg taken.", "req": { "Thundercall": 50 } },{ "name": "Scatter", "desc": "Flourishing an enemy applies Electrocution.", "req": { "Thundercall": 50, "Path": "Electrocution" } },{ "name": "Short Circuit", "desc": "Electrocution now sets the target on fire.", "req": { "Thundercall": 75, "Path": "Electrocution" } },{ "name": "Static Fakeout", "desc": "Roll canceling after a parry teleports you behind the opponent.", "req": { "Thundercall": 35, "Agility": 30 } },{ "name": "Static Link", "desc": "Flourishing or uppercutting creates a static link tether.", "req": { "Thundercall": 40, "Intelligence": 15 } },{ "name": "Jumper Cables", "desc": "Getting knocked while tethered steals HP and prevents the knockdown. (3-4s CD)", "req": { "Thundercall": 1, "Fortitude": 20, "Talent": "Static Link" } },{ "name": "Link Conduction", "desc": "Lightning mantras cost 30% less ether per active link.", "req": { "Thundercall": 65, "Talent": "Static Link" } },{ "name": "Static Allure", "desc": "Two active tethers pull targets together; increased duration.", "req": { "Thundercall": 50, "Talent": "Static Link" } },{ "name": "Grounding Bolt", "desc": "Summoned lightning strikes apply knockdown.", "req": { "Thundercall": 90, "Weapon": 90 } },{ "name": "Overload", "desc": "Hitting opponent 3 times overloads yourself, increasing DMG and tempo. Raiton covers you in shock.", "req": { "Thundercall": 100 } }],
        "Shadowcast": [{ "name": "Withering Path: Decay", "desc": "Your shadow now withers away opponent health.", "req": { "Shadowcast": 50 } },{ "name": "Voidcaller", "desc": "Opponents with no ether or tempo suffer additional wither damage.", "req": { "Shadowcast": 50, "Path": "Withering" } },{ "name": "Infection", "desc": "Wither from shadowcast spreads to nearby enemies.", "req": { "Shadowcast": 60, "Path": "Withering" } },{ "name": "Crushing Thrall", "desc": "Doubles wither received if a shadow mantra breaks guard.", "req": { "Shadowcast": 75, "Path": "Withering" } },{ "name": "Suppression", "desc": "The ether of victims withers away.", "req": { "Shadowcast": 80 } },{ "name": "Senseless Destruction", "desc": "Opponents with >10% wither take more damage from shadow attacks.", "req": { "Shadowcast": 100 } },{ "name": "Dark Synergy", "desc": "Engulf enemies in shadows when flourishing.", "req": { "Shadowcast": 25 } },{ "name": "Sightless Still", "desc": "Shadow attacks increasingly obscure vision. (Mutual with Singularity)", "req": { "Shadowcast": 30 } },{ "name": "Singularity", "desc": "Enemies hang in place when hit by shadow. (Mutual with Sightless Still)", "req": { "Shadowcast": 40 } },{ "name": "Blackhole", "desc": "Singularity pulls nearby people in.", "req": { "Shadowcast": 50, "Talent": "Singularity" } },{ "name": "Energy Siphon", "desc": "Singularity pulls ether from those affected.", "req": { "Shadowcast": 50, "Talent": "Singularity" } },{ "name": "Lord’s Tithe", "desc": "Drains the tempo of enemies you reinforce.", "req": { "Shadowcast": 40, "Mantra": "Reinforce" } },{ "name": "Dark God", "desc": "Steal tempo if a mantra would drain enemy ether to 0.", "req": { "Shadowcast": 50 } },{ "name": "Lasting Sorrow", "desc": "Shadows last longer on the opponent.", "req": { "Shadowcast": 50 } },{ "name": "Fear The Dark", "desc": "Enemies stop in place when running from you.", "req": { "Shadowcast": 50 } },{ "name": "Dark Rift", "desc": "Enter a rift with I-frames when dodging.", "req": { "Shadowcast": 60 } },{ "name": "Dark Waltz", "desc": "Guardbreaking with light attacks/crits steals half of opponent's tempo.", "req": { "Shadowcast": 90, "Weapon": 90 } },{ "name": "Night Terror", "desc": "Light attacks proc Fear the Dark.", "req": { "Shadowcast": 100, "Weapon": 100 } }],
        "Ironsing": [{ "name": "Decay Path: Oxidize", "desc": "Metal attacks store damage released 7.5s later.", "req": { "Ironsing": 50 } },{ "name": "Decaying Posture", "desc": "Deal more damage to opponents with more posture than you.", "req": { "Ironsing": 75, "Path": "Decay" } },{ "name": "Tetanus", "desc": "Hitting with 5+ rods negates healing based on damage and slows.", "req": { "Ironsing": 80, "Path": "Decay" } },{ "name": "Laced Blade", "desc": "Light attacks on targets with tetanus apply poison.", "req": { "Ironsing": 90, "Path": "Decay" } },{ "name": "Oxidizing Blitz", "desc": "Mantras apply DoT to Health/Blood. Tetanus redirects 20% of healing to you.", "req": { "Ironsing": 100, "Path": "Decay" } },{ "name": "Gilded Path: Scrapsinger", "desc": "Flourish consumes rods to siphon enemy armor to you.", "req": { "Ironsing": 35 } },{ "name": "Artisan's Blade", "desc": "Forges metal blades that fire upon landing metal-infused attacks.", "req": { "Ironsing": 45, "Path": "Gilded" } },{ "name": "Refine and Reuse", "desc": "Consuming rods reduces incoming PEN multiplicatively.", "req": { "Ironsing": 45, "Path": "Gilded" } },{ "name": "Songs Unforged", "desc": "Weapon criticals activate Scrapsinger.", "req": { "Ironsing": 50, "Path": "Gilded" } },{ "name": "Masterwork", "desc": "Artisan’s Blades proc metal rods and deal 50% more damage.", "req": { "Ironsing": 60, "Path": "Gilded" } },{ "name": "Reshape and Remold", "desc": "Scrapsinger procs increase opponent armor damage taken.", "req": { "Ironsing": 70, "Path": "Gilded" } },{ "name": "Thornmail", "desc": "Getting flourished applies a metal rod to the attacker.", "req": { "Ironsing": 45 } },{ "name": "Metal Thief", "desc": "Pulling an opponent absorbs a portion of their armor durability.", "req": { "Ironsing": 50 } },{ "name": "Piercing Metal", "desc": "Deal additional armor damage per rod affecting the enemy.", "req": { "Ironsing": 60 } },{ "name": "Exposed Durability", "desc": "10% more damage to opponents with no armor durability.", "req": { "Ironsing": 60 } },{ "name": "Oh The Irony", "desc": "Taunted opponents receive double iron rods.", "req": { "Ironsing": 60, "Charisma": 45 } },{ "name": "An Ironsinger's Instinct", "desc": "Dodging coats you in metal, reducing damage of next hit. (18s CD)", "req": { "Ironsing": 75 } },{ "name": "Phantom Edge", "desc": "Basic attacks have +0.25 range.", "req": { "Ironsing": 75 } },{ "name": "Polished Armor", "desc": "Receive 5-10% less damage when armor is above 90% durability.", "req": { "Ironsing": 75 } },{ "name": "Metal Eater", "desc": "Consume armor durability to cast mantras when ether is empty.", "req": { "Ironsing": 80 } },{ "name": "Alloyblood", "desc": "Bleed damage reduced by 30%; blood loss reduced by 75%.", "req": { "Ironsing": 100 } },{ "name": "Rending Needle: Conductor", "desc": "Reflect non-ironsing mantra element if target has 5+ rods.", "req": { "Ironsing": 75 } },{ "name": "Rending Needle: Jailer", "desc": "Restrain enemy instead of pulling if they have 5+ rods.", "req": { "Ironsing": 75 } },{ "name": "Rending Needle: Impaler", "desc": "Pull rods out for damage if enemy has 5+ rods.", "req": { "Ironsing": 75 } }],
        "Bloodrend": [{ "name": "Harvest Season", "desc": "Critical attacks spawn blood pools under the opponent.", "req": { "Bloodrend": 25 } },{ "name": "Not So Cheap Trick", "desc": "Chance to blind opponents with blood control.", "req": { "Bloodrend": 25 } },{ "name": "Rush Hour", "desc": "Stab yourself for DMG/Speed; lose blood/HP over time.", "req": { "Bloodrend": 50 } },{ "name": "Sow and Mend", "desc": "Sacrifice blood for temporary HP.", "req": { "Bloodrend": 60 } },{ "name": "Cyclical Exsanguination", "desc": "Pause Temp HP decay on hit; reduces enemy posture regain from parries.", "req": { "Bloodrend": 65 } },{ "name": "Smell of Blood", "desc": "See enemy blood/poison when they touch pools or are block broken.", "req": { "Bloodrend": 65 } },{ "name": "Sucker Strike", "desc": "Landing a critical while inside a blood pool increases DMG.", "req": { "Bloodrend": 80 } },{ "name": "Gruesome Harvest", "desc": "Landing attacks on heavily poisoned enemies gives Temp HP.", "req": { "Bloodrend": 85 } },{ "name": "Hemorrhaging Blow", "desc": "Block breaking with a mantra turns enemy healing into damage for 8s.", "req": { "Bloodrend": 95 } },{ "name": "Simple Manipulation: Unstable Blood", "desc": "Attacks spawn pools and cause heavy bleeding.", "req": { "Bloodrend": 50 } },{ "name": "Peaking Control", "desc": "Chance for blood pool eruptions to explode.", "req": { "Bloodrend": 75, "Path": "Simple" } },{ "name": "Piercing Totality", "desc": "Explosions affect everyone in range with increased PEN.", "req": { "Bloodrend": 100, "Path": "Simple" } },{ "name": "Manipulation Path: Agile Misery", "desc": "Speed increased; agility mantras empowered with blood.", "req": { "Bloodrend": 50 } },{ "name": "Rushing Demise", "desc": "Spawning pools grants a blood trail that empowers dashes.", "req": { "Bloodrend": 75, "Path": "Agile" } },{ "name": "Protective Offense", "desc": "Spawn protective crosses on blood pool creation for defense.", "req": { "Bloodrend": 100, "Path": "Agile" } },{ "name": "Manipulation Path: Spirit Lantern", "desc": "Attacks poison instead of spawning pools; increased blood regen.", "req": { "Bloodrend": 50 } },{ "name": "Venomous Chain", "desc": "Poison bypasses resistance and deals 2% true damage on chain hits.", "req": { "Bloodrend": 75, "Path": "Lantern" } },{ "name": "Heavy Disease", "desc": "Venomous Chain now also summons a blood pool.", "req": { "Bloodrend": 100, "Path": "Lantern" } }],
        "Earthbend": [{ "name": "Bastion Path: Reinforce", "desc": "Stand still for 3s to harden skin and reduce incoming damage by 20%.", "req": { "Earthbend": 50, "Fortitude": 25 } },{ "name": "Immovable Fortress", "desc": "Bastion only requires 2s; immune to ragdoll while active.", "req": { "Earthbend": 70, "Fortitude": 30 } },{ "name": "Kinetic Buffer", "desc": "Store damage while in Bastion to buff next Earth or Light attack.", "req": { "Earthbend": 70, "Fortitude": 40 } },{ "name": "Reactive Plates", "desc": "Erupt rock shards when hit during active Bastion. (20s CD)", "req": { "Earthbend": 75, "Fortitude": 50 } },{ "name": "Battlefield Strategist", "desc": "Long-range attacks spawn spikes; short-range spawn walls. (20s CD)", "req": { "Earthbend": 40 } },{ "name": "Natural Disaster", "desc": "Apply Concussion on 3 hits, blinding and hiding enemy HP bar.", "req": { "Earthbend": 50 } },{ "name": "Force of Nature", "desc": "Enemies hitting walls are dazed for longer.", "req": { "Earthbend": 50 } },{ "name": "Momento Mori", "desc": "Going insane increases Earthbend destruction AoE.", "req": { "Earthbend": 50, "Willpower": 20 } },{ "name": "Annihilator", "desc": "Attacks cause bone destruction, slowing opponents.", "req": { "Earthbend": 50, "Strength": 50 } },{ "name": "Vengeful Chase", "desc": "Enemies flourished into walls are struck by Earth Spikes.", "req": { "Earthbend": 70 } },{ "name": "Impermeable", "desc": "Close-range mantras coat you in dust, reducing blood loss.", "req": { "Earthbend": 80 } },{ "name": "Solidifier", "desc": "Elemental hits grant resistance to further elemental damage for 10s.", "req": { "Earthbend": 100 } }],
        "Multi-Elemental": [{ "name": "Wraith Path: Umbra", "desc": "Darkened flames refuse enemy ether gain; puppets drawn to burned targets.", "req": { "Flamecharm": 50, "Shadowcast": 50 } },{ "name": "Freezing Wight", "desc": "Haunted gale now procs Chilled.", "req": { "Galebreathe": 40, "Frostdraw": 40, "Talent": "Haunted Gale" } },{ "name": "Fulgurite Formation", "desc": "Crystals cause lightning strikes; Overload causes double crystal application.", "req": { "Frostdraw": 50, "Thundercall": 50 } },{ "name": "Flashboil", "desc": "Hitting chilled enemies with fire (and vice versa) creates steam DoT clouds.", "req": { "Flamecharm": 30, "Frostdraw": 30 } },{ "name": "Volcanic Glass", "desc": "Detonating crystals will cause an eruption.", "req": { "Flamecharm": 50, "Frostdraw": 50, "Path": "Eruption/Glass" } },{ "name": "Temperature Shock", "desc": "Flame mantras will now detonate crystals.", "req": { "Flamecharm": 40, "Frostdraw": 40 } },{ "name": "Scorched Peak", "desc": "Blockbreaking burning opponents strikes them with lightning.", "req": { "Flamecharm": 50, "Thundercall": 25 } },{"name": "Chorus of Souls", "desc": "Alone, the wisp lack a voice. but surrounded by so many, The frequencies overlap and you hear it true. (NEEDS OATHLESS TO WORK)", "req": {"Flamecharm": 30, "Frostdraw": 30, "Thundercall": 30, "Shadowcast": 30, "Galebreathe": 30, "Ironsing": 30, "Bloodrend": 30}},{"name": "Wisp Convergence", "desc": " When empowered by the Chorus, your Wisps now grant their elements to your strikes. (Oathless, All Wisps, Chorus of Souls)", "req": {"Flamecharm": 30, "Frostdraw": 30, "Thundercall": 30, "Shadowcast": 30, "Galebreathe": 30, "Ironsing": 30, "Bloodrend": 30}}, { "name": "Golden Age", "desc": "Your Iron Pull now detonates Crystals and overloads Surges.", "req": { "Frostdraw": 40, "Thundercall": 50, "Ironsing": 35 } }]
    },
    enchants: ["no enchant", "Adustio", "Astral", "Aflame", "blazing", "bluster", "Chilling", "Curse of deadlock", "Curse of Authoritative", "Curse of Lone warrior", "Curse of Yun'shul", "Curse of Bloodthirsty", "Curse of No-life king", "Curse of the Unbidden", "Curse of Repulsion", "Curse of Rhaemen's Ember", "Curse of Greed", "Deferred", "Detonation", "elastic", "Fallen knight", "Gluttony", "grim", "Harrowing", "Heroism", "Metal", "Nemesis", "nightbring", "Providence's Thorn", "Sear", "Stone", "Storm", "Solar", "Tears of the Edenkite", "Vampirism", "Obfuscation", "Wild", "Windswept", "Withering", "Tainted Sorrows", "Umbral knight", "Scalding", "Mayhem"],
weapons: [
        { name: "Adretian axe", type: "GreatAxe", base: 24.0, scaling: { "Heavy Weapon": 8.0 }, speed: 0.55, range: 8, bleed: false, pen: 10, chip: 10 },
        { name: "Acheron's Warspear", type: "Spear", base: 18.0, scaling: { "Medium Weapon": 6.7 }, speed: 0.72, range: 9, bleed: true, pen: 25, chip: 0 },
        { name: "Alloyed Katana", type: "Sword", base: 23.5, scaling: { "Medium Weapon": 5.0 }, speed: 0.68, range: 8, bleed: false, pen: 0, chip: 0 },
        { name: "Alloyed Zweihander", type: "GreatSword", base: 24.5, scaling: { "Heavy Weapon": 10.0 }, speed: 0.54, range: 10, bleed: false, pen: 10, chip: 0 },
        { name: "Ancient glaive", type: "Spear", base: 19.0, scaling: { "Medium Weapon": 8.0 }, speed: 0.7, range: 9, bleed: false, pen: 25, chip: 0 },
        { name: "Anklets of Alsin", type: "Fist", base: 16.0, scaling: { "Light Weapon": 6.5 }, speed: 0.66, range: 7, bleed: false, pen: 20, chip: 0 },
        { name: "Apprentice rapier", type: "Rapier", base: 17.0, scaling: { "Light Weapon": 7.5 }, speed: 0.66, range: 8, bleed: false, pen: 0, chip: 0 },
        { name: "Astral Greatsword", type: "GreatSword", base: 24.5, scaling: { "Heavy Weapon": 10.0 }, speed: 0.54, range: 10, bleed: false, pen: 10, chip: 0 },
        { name: "Bloodlust Katana", type: "Sword", base: 21.0, scaling: { "Medium Weapon": 7.5 }, speed: 0.68, range: 8, bleed: false, pen: 0, chip: 0 },
        { name: "Bloodtide Trident", type: "Spear", base: 16.0, scaling: { "Medium Weapon": 6.0 }, speed: 0.72, range: 9, bleed: true, pen: 25, chip: 0 },
        { name: "Bloodfouler", type: "GreatSword", base: 19.5, scaling: { "Heavy Weapon": 6.5, "Bloodrend": 5.0 }, speed: 0.5, range: 9, bleed: true, pen: 10, chip: 0 },
        { name: "Broodalloy Cestus", type: "Fist", base: 15.0, scaling: { "Light Weapon": 9.5 }, speed: 0.67, range: 6, bleed: false, pen: 5, chip: 0 },
        { name: "Boltcrusher", type: "GreatAxe", base: 25.0, scaling: { "Heavy Weapon": 4.2, "Thundercall": 7.0 }, speed: 0.55, range: 8.5, bleed: false, pen: 20, chip: 0 },
        { name: "Canor Fang", type: "Dagger", base: 13.5, scaling: { "Light Weapon": 10.0 }, speed: 0.65, range: 6, bleed: false, pen: 5, chip: 0 },
        { name: "Cavalry Saber", type: "Sword", base: 21.0, scaling: { "Medium Weapon": 5.0 }, speed: 0.68, range: 8, bleed: false, pen: 0, chip: 0 },
        { name: "Caestus", type: "Fist", base: 16.0, scaling: { "Light Weapon": 8.0 }, speed: 0.66, range: 6, bleed: false, pen: 5, chip: 0 },
        { name: "Champion's sword", type: "Sword", base: 19.5, scaling: { "Medium Weapon": 5.5 }, speed: 0.67, range: 8, bleed: false, pen: 0, chip: 0 },
        { name: "Chorus of agonies", type: "GreatAxe", base: 26.0, scaling: { "Heavy Weapon": 11.0 }, speed: 0.63, range: 10, bleed: false, pen: 0, chip: 25 },
        { name: "Cerulean Thread", type: "Dagger", base: 15.0, scaling: { "Light Weapon": 9.0 }, speed: 0.63, range: 6.5, bleed: false, pen: 30, chip: 0 },
        { name: "Crypt Blade", type: "GreatSword", base: 22.0, scaling: { "Heavy Weapon": 4.0, "Shadowcast": 9.0 }, speed: 0.57, range: 10, bleed: false, pen: 0, chip: 0 },
        { name: "Crescendo", type: "Twinblades", base: 22.0, scaling: { "Medium Weapon": 6.0 }, speed: 0.72, range: 7.5, bleed: false, pen: 5, chip: 0 },
        { name: "Conqueror's blade", type: "GreatSword", base: 24.5, scaling: { "Heavy Weapon": 8.5 }, speed: 0.55, range: 9.5, bleed: false, pen: 0, chip: 10 },
        { name: "Conqueror's Sword", type: "Sword", base: 20.5, scaling: { "Medium Weapon": 8.5 }, speed: 0.68, range: 7.5, bleed: false, pen: 0, chip: 0 },
        { name: "Curved Blade of Winds", type: "Sword", base: 17.5, scaling: { "Medium Weapon": 5.0, "Galebreathe": 5.0 }, speed: 0.67, range: 8, bleed: false, pen: 15, chip: 5 },
        { name: "Curved Blade", type: "Sword", base: 20.0, scaling: { "Medium Weapon": 8.0 }, speed: 0.65, range: 8, bleed: false, pen: 25, chip: 0 },
        { name: "Deepspindle", type: "Rapier", base: 14.0, scaling: { "Light Weapon": 1.7, "Shadowcast": 5.0 }, speed: 0.67, range: 8, bleed: false, pen: 20, chip: 0 },
        { name: "Death's Reverie", type: "Twinblades", base: 18.0, scaling: { "Medium Weapon": 5.0 }, speed: 0.69, range: 8, bleed: true, pen: 15, chip: 0 },
        { name: "Darksteal Greatsword", type: "GreatSword", base: 26.0, scaling: { "Heavy Weapon": 8.0 }, speed: 0.55, range: 9.5, bleed: false, pen: 0, chip: 0 },
        { name: "Drakemaw Gauntlets", type: "Fist", base: 16.0, scaling: { "Light Weapon": 8.5 }, speed: 0.66, range: 6, bleed: true, pen: 5, chip: 0 },
        { name: "Edenbrand Hellcoil", type: "GreatCannon", base: 27.0, scaling: { "Heavy Weapon": 8.3 }, speed: 0.63, range: 8.5, bleed: false, pen: 0, chip: 20 },
        { name: "Enforcer's axe", type: "GreatAxe", base: 25.0, scaling: { "Heavy Weapon": 11.0 }, speed: 0.55, range: 10, bleed: false, pen: 0, chip: 0 },
        { name: "Enforcer's blade", type: "GreatSword", base: 24.5, scaling: { "Heavy Weapon": 8.5 }, speed: 0.55, range: 9.5, bleed: false, pen: 0, chip: 10 },
        { name: "Enforcer's hammer", type: "GreatHammer", base: 25.5, scaling: { "Heavy Weapon": 10.0 }, speed: 0.55, range: 10, bleed: false, pen: 0, chip: 0 },
        { name: "Evanspear greataxe", type: "GreatAxe", base: 26.0, scaling: { "Heavy Weapon": 10.5 }, speed: 0.62, range: 9.5, bleed: true, pen: 0, chip: 0 },
        { name: "Eye of Malice", type: "Sword", base: 20.0, scaling: { "Medium Weapon": 8.0 }, speed: 0.77, range: 9.5, bleed: false, pen: 25, chip: 15 },
        { name: "Falchion", type: "Sword", base: 16.0, scaling: { "Medium Weapon": 8.0 }, speed: 0.65, range: 7.5, bleed: false, pen: 20, chip: 0 },
        { name: "Flamekeeper cestus", type: "Fist", base: 18.0, scaling: { "Light Weapon": 8.0 }, speed: 0.66, range: 6, bleed: false, pen: 5, chip: 0 },
        { name: "Flareblood Kamas", type: "Dagger", base: 16.0, scaling: { "Light Weapon": 3.2, "Intelligence": 2.0 }, speed: 0.65, range: 7, bleed: true, pen: 30, chip: 0 },
        { name: "First Light", type: "GreatSword", base: 22.0, scaling: { "Heavy Weapon": 8.0 }, speed: 0.54, range: 9.5, bleed: false, pen: 30, chip: 10 },
        { name: "Forgotten Gladius", type: "Sword", base: 19.5, scaling: { "Medium Weapon": 8.2 }, speed: 0.67, range: 8, bleed: false, pen: 10, chip: 0 },
        { name: "Fractine", type: "GreatSword", base: 22.0, scaling: { "Heavy Weapon": 7.0, "Intelligence": 4.0 }, speed: 0.55, range: 9.5, bleed: false, pen: 25, chip: 20 },
        { name: "Forge Greathammer", type: "GreatHammer", base: 25.5, scaling: { "Heavy Weapon": 8.0 }, speed: 0.55, range: 9, bleed: false, pen: 0, chip: 0 },
        { name: "Gaunts of Emnity", type: "Fist", base: 15.0, scaling: { "Light Weapon": 11.0 }, speed: 0.66, range: 6, bleed: false, pen: 0, chip: 20 },
        { name: "Godseeker Wraps", type: "Fist", base: 20.0, scaling: { "Light Weapon": 4.5 }, speed: 0.66, range: 6, bleed: false, pen: 5, chip: 0 },
        { name: "Gran Sudaruska", type: "GreatAxe", base: 24.0, scaling: { "Heavy Weapon": 4.0, "Frostdraw": 8.0 }, speed: 0.53, range: 9.5, bleed: false, pen: 0, chip: 0 },
        { name: "Great Maul", type: "GreatHammer", base: 25.5, scaling: { "Heavy Weapon": 9.5 }, speed: 0.56, range: 10, bleed: false, pen: 0, chip: 0 },
        { name: "Hailbreaker", type: "GreatSword", base: 22.0, scaling: { "Heavy Weapon": 7.0, "Frostdraw": 4.0 }, speed: 0.6, range: 8.5, bleed: false, pen: 15, chip: 10 },
        { name: "Halberd", type: "GreatAxe", base: 23.0, scaling: { "Heavy Weapon": 9.5 }, speed: 0.53, range: 10, bleed: false, pen: 15, chip: 0 },
        { name: "Hearthwarden", type: "GreatSword", base: 26.0, scaling: { "Heavy Weapon": 5.0, "Earthbend": 3.5 }, speed: 0.63, range: 12, bleed: false, pen: 0, chip: 0 },
        { name: "Hivelord Hubris", type: "GreatHammer", base: 28.0, scaling: { "Heavy Weapon": 10.0 }, speed: 0.63, range: 12, bleed: false, pen: 0, chip: 0 },
        { name: "Hivelord Fist", type: "Fist", base: 18.5, scaling: { "Light Weapon": 6.0, "Strength": 2.0 }, speed: 0.66, range: 6, bleed: false, pen: 5, chip: 0 },
        { name: "Iron Blunderbuss", type: "Rifle", base: 18.5, scaling: { "Medium Weapon": 7.0 }, speed: 0.68, range: 8, bleed: false, pen: 25, chip: 0 },
        { name: "Injuria", type: "Sword", base: 19.5, scaling: { "Medium Weapon": 9.0 }, speed: 0.72, range: 9, bleed: false, pen: 25, chip: 10 },
        { name: "Iron Spear", type: "Spear", base: 17.0, scaling: { "Medium Weapon": 8.5 }, speed: 0.71, range: 10, bleed: false, pen: 10, chip: 0 },
        { name: "Iron Twinblade", type: "Twinblades", base: 22.0, scaling: { "Medium Weapon": 4.0 }, speed: 0.7, range: 8, bleed: false, pen: 0, chip: 30 },
        { name: "Imperial Staff", type: "Staff", base: 19.5, scaling: { "Medium Weapon": 5.0, "Strength": 3.5 }, speed: 0.68, range: 8, bleed: false, pen: 10, chip: 10 },
        { name: "Imperators Edge", type: "Spear", base: 20.0, scaling: { "Medium Weapon": 2.0, "Fortitude": 4.0, "Strength": 3.0 }, speed: 0.75, range: 11, bleed: false, pen: 20, chip: 0 },
        { name: "Ignition Deepcrusher", type: "Club", base: 17.5, scaling: { "Medium Weapon": 2.0, "Ironsing": 3.0 }, speed: 0.68, range: 7.5, bleed: false, pen: 0, chip: 0 },
        { name: "Flame HB", type: "Sword", base: 20.0, scaling: { "Flamecharm": 7.5 }, speed: 0.67, range: 8, bleed: false, pen: 0, chip: 0 },
        { name: "Frost HB", type: "Sword", base: 20.0, scaling: { "Frostdraw": 7.5 }, speed: 0.67, range: 8, bleed: false, pen: 0, chip: 0 },
        { name: "Lightning HB", type: "Sword", base: 20.0, scaling: { "Thundercall": 7.5 }, speed: 0.67, range: 8, bleed: false, pen: 0, chip: 0 },
        { name: "Shadow HB", type: "Sword", base: 20.0, scaling: { "Shadowcast": 7.5 }, speed: 0.67, range: 8, bleed: false, pen: 0, chip: 0 },
        { name: "Wind HB", type: "Sword", base: 20.0, scaling: { "Galebreathe": 7.5 }, speed: 0.67, range: 8, bleed: false, pen: 0, chip: 0 },
        { name: "Inferno Blade", type: "GreatSword", base: 24.0, scaling: { "Flamecharm": 9.5 }, speed: 0.55, range: 10, bleed: false, pen: 0, chip: 10 },
        { name: "Inferno Cleaver", type: "GreatAxe", base: 23.5, scaling: { "Flamecharm": 9.5 }, speed: 0.55, range: 10, bleed: false, pen: 0, chip: 10 },
        { name: "Inferno Hammer", type: "GreatHammer", base: 24.5, scaling: { "Flamecharm": 9.5 }, speed: 0.55, range: 9.5, bleed: false, pen: 0, chip: 10 },
        { name: "Inferno Dagger", type: "Dagger", base: 17.5, scaling: { "Flamecharm": 4.0 }, speed: 0.63, range: 6.5, bleed: false, pen: 25, chip: 0 },
        { name: "Inferno Piercer", type: "Rapier", base: 16.5, scaling: { "Flamecharm": 7.5 }, speed: 0.66, range: 8.5, bleed: false, pen: 0, chip: 0 },
        { name: "Inferno Gauntlet", type: "Fist", base: 19.0, scaling: { "Flamecharm": 4.0 }, speed: 0.66, range: 6, bleed: false, pen: 5, chip: 0 },
        { name: "Inferno Glaive", type: "Spear", base: 18.0, scaling: { "Flamecharm": 8.0 }, speed: 0.7, range: 9, bleed: false, pen: 25, chip: 0 },
        { name: "Inferno Club", type: "Club", base: 21.0, scaling: { "Flamecharm": 3.5 }, speed: 0.68, range: 8, bleed: false, pen: 0, chip: 0 },
        { name: "Glacier Blade", type: "GreatSword", base: 24.0, scaling: { "Frostdraw": 9.5 }, speed: 0.55, range: 10, bleed: false, pen: 0, chip: 10 },
        { name: "Glacier Cleaver", type: "GreatAxe", base: 23.5, scaling: { "Frostdraw": 9.5 }, speed: 0.55, range: 10, bleed: false, pen: 0, chip: 10 },
        { name: "Glacier Hammer", type: "GreatHammer", base: 24.5, scaling: { "Frostdraw": 9.5 }, speed: 0.55, range: 9.5, bleed: false, pen: 0, chip: 10 },
        { name: "Glacier Dagger", type: "Dagger", base: 17.5, scaling: { "Frostdraw": 4.0 }, speed: 0.63, range: 6.5, bleed: false, pen: 25, chip: 0 },
        { name: "Glacier Piercer", type: "Rapier", base: 16.5, scaling: { "Frostdraw": 7.5 }, speed: 0.66, range: 8.5, bleed: false, pen: 0, chip: 0 },
        { name: "Glacier Gauntlet", type: "Fist", base: 19.0, scaling: { "Frostdraw": 4.0 }, speed: 0.66, range: 6, bleed: false, pen: 5, chip: 0 },
        { name: "Glacier Glaive", type: "Spear", base: 18.0, scaling: { "Frostdraw": 8.0 }, speed: 0.7, range: 9, bleed: false, pen: 25, chip: 0 },
        { name: "Glacier Club", type: "Club", base: 21.0, scaling: { "Frostdraw": 3.5 }, speed: 0.68, range: 8, bleed: false, pen: 0, chip: 0 },
        { name: "Thunderbolt Blade", type: "GreatSword", base: 24.0, scaling: { "Thundercall": 9.5 }, speed: 0.55, range: 10, bleed: false, pen: 0, chip: 10 },
        { name: "Thunderbolt Cleaver", type: "GreatAxe", base: 23.5, scaling: { "Thundercall": 9.5 }, speed: 0.55, range: 10, bleed: false, pen: 0, chip: 10 },
        { name: "Thunderbolt Hammer", type: "GreatHammer", base: 24.5, scaling: { "Thundercall": 9.5 }, speed: 0.55, range: 9.5, bleed: false, pen: 0, chip: 10 },
        { name: "Thunderbolt Dagger", type: "Dagger", base: 17.5, scaling: { "Thundercall": 4.0 }, speed: 0.63, range: 6.5, bleed: false, pen: 25, chip: 0 },
        { name: "Thunderbolt Piercer", type: "Rapier", base: 16.5, scaling: { "Thundercall": 7.5 }, speed: 0.66, range: 8.5, bleed: false, pen: 0, chip: 0 },
        { name: "Thunderbolt Gauntlet", type: "Fist", base: 19.0, scaling: { "Thundercall": 4.0 }, speed: 0.66, range: 6, bleed: false, pen: 5, chip: 0 },
        { name: "Thunderbolt Glaive", type: "Spear", base: 18.0, scaling: { "Thundercall": 8.0 }, speed: 0.7, range: 9, bleed: false, pen: 25, chip: 0 },
        { name: "Thunderbolt Club", type: "Club", base: 21.0, scaling: { "Thundercall": 3.5 }, speed: 0.68, range: 8, bleed: false, pen: 0, chip: 0 },
        { name: "Penumbra Blade", type: "GreatSword", base: 24.0, scaling: { "Shadowcast": 9.5 }, speed: 0.55, range: 10, bleed: false, pen: 0, chip: 10 },
        { name: "Penumbra Blade Cleaver", type: "GreatAxe", base: 23.5, scaling: { "Shadowcast": 9.5 }, speed: 0.55, range: 10, bleed: false, pen: 0, chip: 10 },
        { name: "Penumbra Hammer", type: "GreatHammer", base: 24.5, scaling: { "Shadowcast": 9.5 }, speed: 0.55, range: 9.5, bleed: false, pen: 0, chip: 10 },
        { name: "Penumbra Dagger", type: "Dagger", base: 17.5, scaling: { "Shadowcast": 4.0 }, speed: 0.63, range: 6.5, bleed: false, pen: 25, chip: 0 },
        { name: "Penumbra Piercer", type: "Rapier", base: 16.5, scaling: { "Shadowcast": 7.5 }, speed: 0.66, range: 8.5, bleed: false, pen: 0, chip: 0 },
        { name: "Penumbra Gauntlet", type: "Fist", base: 19.0, scaling: { "Shadowcast": 4.0 }, speed: 0.66, range: 6, bleed: false, pen: 5, chip: 0 },
        { name: "Penumbra Glaive", type: "Spear", base: 18.0, scaling: { "Shadowcast": 8.0 }, speed: 0.7, range: 9, bleed: false, pen: 25, chip: 0 },
        { name: "Penumbra Club", type: "Club", base: 21.0, scaling: { "Shadowcast": 3.5 }, speed: 0.68, range: 8, bleed: false, pen: 0, chip: 0 },
        { name: "Zephyr Blade", type: "GreatSword", base: 24.0, scaling: { "Galebreathe": 9.5 }, speed: 0.55, range: 10, bleed: false, pen: 0, chip: 10 },
        { name: "Zephyr Cleaver", type: "GreatAxe", base: 23.5, scaling: { "Galebreathe": 9.5 }, speed: 0.55, range: 10, bleed: false, pen: 0, chip: 10 },
        { name: "Zephyr Hammer", type: "GreatHammer", base: 24.5, scaling: { "Galebreathe": 9.5 }, speed: 0.55, range: 9.5, bleed: false, pen: 0, chip: 10 },
        { name: "Zephyr Dagger", type: "Dagger", base: 17.5, scaling: { "Galebreathe": 4.0 }, speed: 0.63, range: 6.5, bleed: false, pen: 25, chip: 0 },
        { name: "Zephyr Piercer", type: "Rapier", base: 16.5, scaling: { "Galebreathe": 7.5 }, speed: 0.66, range: 8.5, bleed: false, pen: 0, chip: 0 },
        { name: "Zephyr Gauntlet", type: "Fist", base: 19.0, scaling: { "Galebreathe": 4.0 }, speed: 0.66, range: 6, bleed: false, pen: 5, chip: 0 },
        { name: "Zephyr Glaive", type: "Spear", base: 18.0, scaling: { "Galebreathe": 8.0 }, speed: 0.7, range: 9, bleed: false, pen: 25, chip: 0 },
        { name: "Zephyr Club", type: "Club", base: 21.0, scaling: { "Galebreathe": 3.5 }, speed: 0.68, range: 8, bleed: false, pen: 0, chip: 0 },
        { name: "Alloy Blade", type: "GreatSword", base: 24.0, scaling: { "Ironsing": 9.5 }, speed: 0.55, range: 10, bleed: false, pen: 0, chip: 10 },
        { name: "Alloy Cleaver", type: "GreatAxe", base: 23.5, scaling: { "Ironsing": 9.5 }, speed: 0.55, range: 10, bleed: false, pen: 0, chip: 10 },
        { name: "Alloy Hammer", type: "GreatHammer", base: 24.5, scaling: { "Ironsing": 9.5 }, speed: 0.55, range: 9.5, bleed: false, pen: 0, chip: 10 },
        { name: "Alloy Dagger", type: "Dagger", base: 17.5, scaling: { "Ironsing": 4.0 }, speed: 0.63, range: 6.5, bleed: false, pen: 25, chip: 0 },
        { name: "Alloy Piercer", type: "Rapier", base: 16.5, scaling: { "Ironsing": 7.5 }, speed: 0.66, range: 8.5, bleed: false, pen: 0, chip: 0 },
        { name: "Alloy Gauntlet", type: "Fist", base: 19.0, scaling: { "Ironsing": 4.0 }, speed: 0.66, range: 6, bleed: false, pen: 5, chip: 0 },
        { name: "Alloy Glaive", type: "Spear", base: 18.0, scaling: { "Ironsing": 8.0 }, speed: 0.7, range: 9, bleed: false, pen: 25, chip: 0 },
        { name: "Alloy Club", type: "Club", base: 21.0, scaling: { "Ironsing": 3.5 }, speed: 0.68, range: 8, bleed: false, pen: 0, chip: 0 },
        { name: "Vital Blade", type: "GreatSword", base: 24.0, scaling: { "Bloodrend": 9.5 }, speed: 0.55, range: 10, bleed: false, pen: 0, chip: 10 },
        { name: "Vital Cleaver", type: "GreatAxe", base: 23.5, scaling: { "Bloodrend": 9.5 }, speed: 0.55, range: 10, bleed: false, pen: 0, chip: 10 },
        { name: "Vital Hammer", type: "GreatHammer", base: 24.5, scaling: { "Bloodrend": 9.5 }, speed: 0.55, range: 9.5, bleed: false, pen: 0, chip: 10 },
        { name: "Vital Dagger", type: "Dagger", base: 17.5, scaling: { "Bloodrend": 4.0 }, speed: 0.63, range: 6.5, bleed: false, pen: 25, chip: 0 },
        { name: "Vital Piercer", type: "Rapier", base: 16.5, scaling: { "Bloodrend": 7.5 }, speed: 0.66, range: 8.5, bleed: false, pen: 0, chip: 0 },
        { name: "Vital Gauntlet", type: "Fist", base: 19.0, scaling: { "Bloodrend": 4.0 }, speed: 0.66, range: 6, bleed: false, pen: 5, chip: 0 },
        { name: "Vital Glaive", type: "Spear", base: 18.0, scaling: { "Bloodrend": 8.0 }, speed: 0.7, range: 9, bleed: false, pen: 25, chip: 0 },
        { name: "Vital Club", type: "Club", base: 21.0, scaling: { "Bloodrend": 3.5 }, speed: 0.68, range: 8, bleed: false, pen: 0, chip: 0 },
        { name: "Kanabo", type: "GreatHammer", base: 25.0, scaling: { "Heavy Weapon": 6.0, "Strength": 3.0 }, speed: 0.55, range: 9, bleed: false, pen: 0, chip: 10 },
        { name: "Krulian Knife", type: "Dagger", base: 15.0, scaling: { "Light Weapon": 8.5 }, speed: 0.63, range: 6.5, bleed: false, pen: 25, chip: 0 },
        { name: "Kyrsblade", type: "Sword", base: 21.5, scaling: { "Medium Weapon": 7.5 }, speed: 0.67, range: 7.5, bleed: false, pen: 0, chip: 0 },
        { name: "Kyrscleave", type: "GreatSword", base: 25.0, scaling: { "Heavy Weapon": 9.5 }, speed: 0.55, range: 10, bleed: true, pen: 0, chip: 10 },
        { name: "Kyrsglaive", type: "Spear", base: 18.0, scaling: { "Medium Weapon": 8.5 }, speed: 0.72, range: 9, bleed: true, pen: 20, chip: 0 },
        { name: "Kyrstreza", type: "Rapier", base: 17.0, scaling: { "Light Weapon": 7.5 }, speed: 0.66, range: 8.5, bleed: false, pen: 0, chip: 0 },
        { name: "Kyrsedge", type: "Dagger", base: 16.0, scaling: { "Light Weapon": 9.0 }, speed: 0.63, range: 7, bleed: false, pen: 20, chip: 0 },
        { name: "Kyrswynter", type: "Spear", base: 16.5, scaling: { "Medium Weapon": 3.0, "Frostdraw": 3.0 }, speed: 0.72, range: 9, bleed: true, pen: 20, chip: 0 },
        { name: "Legion Caestus", type: "Fist", base: 18.0, scaling: { "Light Weapon": 8.0 }, speed: 0.66, range: 7, bleed: false, pen: 5, chip: 0 },
        { name: "Lights Final Toll", type: "Fist", base: 13.0, scaling: { "Willpower": 13.0 }, speed: 0.68, range: 7, bleed: false, pen: 5, chip: 0 },
        { name: "Lifecrusher", type: "Club", base: 17.5, scaling: { "Medium Weapon": 1.5, "Bloodrend": 5.5 }, speed: 0.68, range: 8, bleed: true, pen: 20, chip: 0 },
        { name: "Lords Warcry", type: "Spear", base: 20.0, scaling: { "Medium Weapon": 3.0, "Flamecharm": 6.5 }, speed: 0.67, range: 7.5, bleed: false, pen: 0, chip: 0 },
        { name: "Nemits Sickle", type: "Dagger", base: 13.0, scaling: { "Light Weapon": 13.0 }, speed: 0.65, range: 6, bleed: false, pen: 30, chip: 0 },
        { name: "Night Axe", type: "GreatAxe", base: 22.0, scaling: { "Heavy Weapon": 8.0 }, speed: 0.6, range: 8.5, bleed: false, pen: 5, chip: 80 },
        { name: "Nocturne", type: "Sword", base: 19.0, scaling: { "Medium Weapon": 8.0 }, speed: 0.66, range: 7.5, bleed: false, pen: 30, chip: 0 },
        { name: "Otakemaru", type: "GreatSword", base: 26.5, scaling: { "Heavy Weapon": 5.5 }, speed: 0.5, range: 9.5, bleed: false, pen: 15, chip: 0 },
        { name: "Officer Saber", type: "Sword", base: 22.0, scaling: { "Medium Weapon": 4.5 }, speed: 0.68, range: 8, bleed: false, pen: 0, chip: 0 },
        { name: "Markors Inheritor", type: "GreatSword", base: 24.0, scaling: { "Heavy Weapon": 8.0 }, speed: 0.54, range: 9.5, bleed: false, pen: 0, chip: 0 },
        { name: "Master Hawk Handaxe", type: "GreatAxe", base: 26.0, scaling: { "Heavy Weapon": 10.5 }, speed: 0.57, range: 10, bleed: false, pen: 0, chip: 0 },
        { name: "Pale Briar", type: "GreatSword", base: 25.0, scaling: { "Heavy Weapon": 7.0 }, speed: 0.55, range: 10, bleed: false, pen: 25, chip: 10 },
        { name: "Pale Morning", type: "GreatHammer", base: 25.5, scaling: { "Heavy Weapon": 10.0 }, speed: 0.57, range: 10, bleed: false, pen: 0, chip: 0 },
        { name: "Petras Anchor", type: "GreatHammer", base: 25.5, scaling: { "Heavy Weapon": 10.0 }, speed: 0.56, range: 10, bleed: false, pen: 0, chip: 0 },
        { name: "Pernach", type: "Club", base: 20.0, scaling: { "Medium Weapon": 5.0 }, speed: 0.68, range: 7.5, bleed: true, pen: 10, chip: 5 },
        { name: "Poison Spear", type: "Spear", base: 18.0, scaling: { "Medium Weapon": 5.5, "Intelligence": 2.0 }, speed: 0.71, range: 10, bleed: false, pen: 10, chip: 0 },
        { name: "Purple Cloud", type: "Sword", base: 17.0, scaling: { "Medium Weapon": 9.0 }, speed: 0.62, range: 7, bleed: false, pen: 15, chip: 0 },
        { name: "Pleekstys Inferno", type: "Club", base: 22.0, scaling: { "Medium Weapon": 3.0, "Flamecharm": 4.0 }, speed: 0.73, range: 8, bleed: false, pen: 30, chip: 10 },
        { name: "Quartztone Pickaxe", type: "GreatAxe", base: 22.0, scaling: { "Heavy Weapon": 7.0 }, speed: 0.48, range: 8, bleed: false, pen: 20, chip: 0 },
        { name: "Railblade", type: "GreatSword", base: 25.0, scaling: { "Heavy Weapon": 6.5 }, speed: 0.5, range: 9.5, bleed: false, pen: 25, chip: 0 },
        { name: "Razor Cutlass", type: "Sword", base: 18.0, scaling: { "Medium Weapon": 8.9 }, speed: 0.72, range: 8, bleed: true, pen: 10, chip: 10 },
        { name: "Relic Axe", type: "GreatAxe", base: 25.0, scaling: { "Heavy Weapon": 9.0 }, speed: 0.55, range: 8.5, bleed: false, pen: 25, chip: 10 },
        { name: "Red Death", type: "Spear", base: 16.5, scaling: { "Medium Weapon": 2.0, "Shadow": 2.0, "Bloodrend": 2.0, "Mind": 2.0 }, speed: 0.71, range: 9.5, bleed: true, pen: 25, chip: 0 },
        { name: "Rifle Spear", type: "Spear", base: 19.0, scaling: { "Medium Weapon": 8.5 }, speed: 0.72, range: 9, bleed: false, pen: 25, chip: 0 },
        { name: "Rosens Peacemaker", type: "Rifle", base: 17.5, scaling: { "Medium Weapon": 7.5 }, speed: 0.68, range: 7.5, bleed: false, pen: 5, chip: 0 },
        { name: "Rosens Hellflame", type: "Rifle", base: 18.0, scaling: { "Medium Weapon": 3.0, "Flame": 4.0 }, speed: 0.7, range: 7, bleed: false, pen: 0, chip: 0 },
        { name: "Rockmaller", type: "GreatHammer", base: 25.0, scaling: { "Heavy Weapon": 7.5 }, speed: 0.54, range: 8, bleed: false, pen: 0, chip: 0 },
        { name: "Scalesplitter", type: "Twinsblade", base: 20.0, scaling: { "Medium Weapon": 6.0 }, speed: 0.7, range: 8, bleed: false, pen: 15, chip: 0 },
        { name: "Sacred Hammer", type: "Club", base: 21.0, scaling: { "Medium Weapon": 7.0 }, speed: 0.68, range: 8, bleed: false, pen: 10, chip: 0 },
        { name: "Serrated Warspear", type: "Spear", base: 18.5, scaling: { "Medium Weapon": 8.0 }, speed: 0.72, range: 9, bleed: true, pen: 5, chip: 0 },
        { name: "Shattered Katana", type: "Sword", base: 20.0, scaling: { "Medium Weapon": 7.0 }, speed: 0.68, range: 8, bleed: false, pen: 25, chip: 0 },
        { name: "Skyreap Blade", type: "GreatSword", base: 24.5, scaling: { "Heavy Weapon": 7.5 }, speed: 0.52, range: 9.5, bleed: false, pen: 0, chip: 10 },
        { name: "Skull Piercer", type: "Rapier", base: 16.5, scaling: { "Light Weapon": 7.5 }, speed: 0.67, range: 8.5, bleed: true, pen: 0, chip: 0 },
        { name: "Staff of Blood", type: "Sword", base: 18.0, scaling: { "Medium Weapon": 9.5 }, speed: 0.67, range: 8, bleed: false, pen: 5, chip: 10 },
        { name: "Stormseye", type: "Rifle", base: 17.0, scaling: { "Medium Weapon": 2.0, "Thunder": 5.0 }, speed: 0.68, range: 8, bleed: false, pen: 10, chip: 0 },
        { name: "Stoneheart", type: "GreatHammer", base: 24.0, scaling: { "Heavy Weapon": 10.0 }, speed: 0.6, range: 8.5, bleed: false, pen: 10, chip: 10 },
        { name: "Steel Maul", type: "GreatHammer", base: 23.5, scaling: { "Heavy Weapon": 10.0 }, speed: 0.57, range: 10, bleed: false, pen: 0, chip: 0 },
        { name: "Sovereign's Punishment", type: "GreatHammer", base: 26.0, scaling: { "Heavy Weapon": 9.0 }, speed: 0.58, range: 9, bleed: false, pen: 20, chip: 10 },
        { name: "Soulthorn", type: "Sword", base: 17.0, scaling: { "Medium Weapon": 7.0, "Intelligence": 3.5 }, speed: 0.67, range: 8, bleed: false, pen: 0, chip: 30 },
        { name: "Summer Blade", type: "GreatSword", base: 26.0, scaling: { "Heavy Weapon": 8.5 }, speed: 0.5, range: 9, bleed: false, pen: 5, chip: 0 },
        { name: "Summer Kukri", type: "Spear", base: 18.5, scaling: { "Medium Weapon": 8.3 }, speed: 0.66, range: 8, bleed: false, pen: 25, chip: 0 },
        { name: "Summer Dagger", type: "Dagger", base: 15.0, scaling: { "Light Weapon": 8.5 }, speed: 0.63, range: 6.5, bleed: false, pen: 25, chip: 0 },
        { name: "Summer Axe", type: "GreatAxe", base: 22.0, scaling: { "Heavy Weapon": 11.0 }, speed: 0.6, range: 10, bleed: false, pen: 0, chip: 0 },
        { name: "Summer Staff", type: "Staff", base: 18.0, scaling: { "Medium Weapon": 9.5 }, speed: 0.67, range: 8, bleed: false, pen: 5, chip: 10 },
        { name: "Shotel", type: "Sword", base: 22.0, scaling: { "Medium Weapon": 6.0 }, speed: 0.7, range: 8, bleed: false, pen: 10, chip: 30 },
        { name: "Spectral Grasp", type: "Dagger", base: 16.0, scaling: { "Light Weapon": 7.0 }, speed: 0.63, range: 6.5, bleed: false, pen: 15, chip: 0 },
        { name: "Sirens Edict", type: "GreatSpear", base: 22.0, scaling: { "Heavy Weapon": 4.5, "Ironsing": 7.0 }, speed: 0.52, range: 10, bleed: false, pen: 15, chip: 0 },
        { name: "Thunderbreakers Gauntlets", type: "Fist", base: 17.5, scaling: { "Light Weapon": 3.0, "Thunder": 6.0 }, speed: 0.66, range: 6, bleed: false, pen: 10, chip: 0 },
        { name: "The Barrel", type: "GreatCannon", base: 25.5, scaling: { "Heavy Weapon": 8.5 }, speed: 0.6, range: 8, bleed: false, pen: 5, chip: 15 },
        { name: "The Pastry Paster", type: "Club", base: 18.0, scaling: { "Medium Weapon": 5.0, "Mind": 3.0 }, speed: 0.68, range: 7.5, bleed: false, pen: 0, chip: 0 },
        { name: "The Flippers of Fate", type: "Dagger", base: 14.5, scaling: { "Light Weapon": 8.0, "Mind": 5.0 }, speed: 0.65, range: 6.5, bleed: false, pen: 15, chip: 0 },
        { name: "The Long Tong of The Law", type: "GreatSword", base: 20.0, scaling: { "Heavy Weapon": 8.5, "Mind": 5.0 }, speed: 0.55, range: 10, bleed: true, pen: 0, chip: 40 },
        { name: "Tyrant's Greatspear", type: "GreatSpear", base: 19.5, scaling: { "Heavy Weapon": 3.5, "Medium Weapon": 3.5 }, speed: 0.55, range: 10, bleed: false, pen: 20, chip: 0 },
        { name: "Tyrant's Greatsword", type: "GreatSword", base: 24.0, scaling: { "Light Weapon": 3.1, "Heavy Weapon": 4.1 }, speed: 0.5, range: 10, bleed: false, pen: 0, chip: 10 },
        { name: "True Seraph Spear", type: "Spear", base: 19.0, scaling: { "Medium Weapon": 9.0 }, speed: 0.72, range: 9, bleed: false, pen: 20, chip: 0 },
        { name: "Trident Spear", type: "Spear", base: 18.5, scaling: { "Medium Weapon": 7.0 }, speed: 0.72, range: 9, bleed: true, pen: 25, chip: 0 },
        { name: "Toothed Club", type: "Club", base: 20.0, scaling: { "Medium Weapon": 5.0 }, speed: 0.68, range: 7.5, bleed: true, pen: 10, chip: 5 },
        { name: "Tetherspear", type: "Spear", base: 18.5, scaling: { "Medium Weapon": 8.5 }, speed: 0.71, range: 10, bleed: false, pen: 10, chip: 0 },
        { name: "Umbrite Witherblade", type: "Sword", base: 14.0, scaling: { "Medium Weapon": 14.0 }, speed: 0.69, range: 7.5, bleed: true, pen: 0, chip: 15 },
        { name: "Volfram", type: "Sword", base: 17.5, scaling: { "Medium Weapon": 4.0, "Ironsing": 3.0 }, speed: 0.68, range: 7.5, bleed: false, pen: 0, chip: 0 },
        { name: "Vortex Echo", type: "Fist", base: 13.5, scaling: { "Charisma": 3.5, "Light Weapon": 8.0 }, speed: 0.66, range: 6, bleed: false, pen: 0, chip: 0 },
        { name: "Vigil Longsword", type: "Sword", base: 20.0, scaling: { "Medium Weapon": 7.5 }, speed: 0.68, range: 8, bleed: false, pen: 20, chip: 0 },
        { name: "Warden Ceremonial Sword", type: "Sword", base: 17.0, scaling: { "Medium Weapon": 8.5 }, speed: 0.65, range: 7.5, bleed: false, pen: 15, chip: 0 },
        { name: "Worshipper Longsword", type: "Sword", base: 19.0, scaling: { "Medium Weapon": 4.0 }, speed: 0.68, range: 8, bleed: false, pen: 0, chip: 0 },
        { name: "Worldpiercer Gauntlets", type: "Fist", base: 18.0, scaling: { "Light Weapon": 8.0 }, speed: 0.65, range: 6, bleed: false, pen: 15, chip: 0 },
        { name: "Wraithclaw", type: "Fist", base: 16.0, scaling: { "Galebreathe": 5.5, "Light Weapon": 4.0 }, speed: 0.66, range: 6.5, bleed: false, pen: 10, chip: 25 },
        { name: "Whisperwind", type: "GreatSword", base: 25.0, scaling: { "Galebreathe": 6.5, "Heavy Weapon": 4.0 }, speed: 0.5, range: 9.5, bleed: false, pen: 25, chip: 0 },
        { name: "Wretched Mawblades", type: "GreatSword", base: 27.5, scaling: { "Heavy Weapon": 8.0 }, speed: 0.6, range: 9, bleed: false, pen: 0, chip: 15 },
        { name: "Wrist Weights", type: "Fist", base: 16.0, scaling: { "Light Weapon": 6.5 }, speed: 0.66, range: 7, bleed: false, pen: 20, chip: 0 },
        { name: "Wristless Weights", type: "Fist", base: 16.0, scaling: { "Light Weapon": 6.5 }, speed: 0.66, range: 7, bleed: false, pen: 20, chip: 0 },
        { name: "Wyrmtooth", type: "GreatSword", base: 22.0, scaling: { "Medium Weapon": 4.5, "Heavy Weapon": 4.0 }, speed: 0.77, range: 10, bleed: false, pen: 20, chip: 0 },
        { name: "Wyvern Dualclaw", type: "Sword", base: 22.0, scaling: { "Medium Weapon": 7.0 }, speed: 0.7, range: 8, bleed: false, pen: 0, chip: 30 },
        { name: "Ysleys Pyre Keeper", type: "GreatSword", base: 21.5, scaling: { "Heavy Weapon": 5.0, "Flamecharm": 6.0 }, speed: 0.5, range: 8, bleed: false, pen: 15, chip: 0 },
        { name: "Ysleys Pyre Reeper (NON-CHEST)", type: "GreatSword", base: 21.5, scaling: { "Heavy Weapon": 5.0, "Flamecharm": 6.0 }, speed: 0.5, range: 8, bleed: false, pen: 15, chip: 0 },
        { name: "Golden Swordfish", type: "Rapier", base: 17.0, scaling: { "Light Weapon": 7.5 }, speed: 0.66, range: 8, bleed: false, pen: 0, chip: 0 },
        { name: "Base sword", type: "Sword", base: 18.0, scaling: { "Medium Weapon": 2.0 }, speed: 0.68, range: 8, bleed: false, pen: 0, chip: 0 },
        { name: "Pasado", type: "GreatAxe", base: 26.0, scaling: { "Heavy Weapon": 10.5 }, speed: 0.62, range: 9.5, bleed: true, pen: 0, chip: 0 },
        { name: "Clockwork Greatsword", type: "GreatSword", base: 26.0, scaling: { "Heavy Weapon": 7.5, "Precision": 3.5 }, speed: 0.6, range: 9.5, bleed: false, pen: 0, chip: 0 },
        { name: "Enchained song", type: "Fist", base: 18.5, scaling: { "Light Weapon": 8.5 }, speed: 0.67, range: 6, bleed: false, pen: 5, chip: 0 },
        { name: "Soul split katana", type: "Sword", base: 20.0, scaling: { "Medium Weapon": 8.0 }, speed: 0.7, range: 8, bleed: false, pen: 25, chip: 0 },
        { name: "Artemis", type: "Spear", base: 16.5, scaling: { "Medium Weapon": 9.0, "Precision": 3.0 }, speed: 0.71, range: 9.5, bleed: false, pen: 20, chip: 0 },
        { name: "Centurion gauntlets", type: "Fist", base: 18.5, scaling: { "Fortitude": 3.0, "Light Weapon": 5.0 }, speed: 0.66, range: 6, bleed: false, pen: 5, chip: 0 },
        { name: "Blinding flash", type: "Fist", base: 17.0, scaling: { "Light Weapon": 7.0 }, speed: 0.62, range: 6, bleed: false, pen: 25, chip: 0 },
        { name: "Endless abyss", type: "Spear", base: 18.0, scaling: { "Medium Weapon": 10.0 }, speed: 0.68, range: 8, bleed: false, pen: 0, chip: 0 },
        { name: "Empty abyss", type: "Sword", base: 17.0, scaling: { "Medium Weapon": 10.0 }, speed: 0.71, range: 10, bleed: false, pen: 10, chip: 0 },
        { name: "Unleashed purple cloud", type: "Sword", base: 17.0, scaling: { "Medium Weapon": 10.0 }, speed: 0.65, range: 7.5, bleed: false, pen: 15, chip: 0 },
        { name: "Ysleys Reaper", type: "GreatSword", base: 24.5, scaling: { "Heavy Weapon": 7.5 }, speed: 0.52, range: 9.5, bleed: false, pen: 0, chip: 10 },
        { name: "Azure Pinwheel", type: "GreatSword", base: 26.5, scaling: { "Heavy Weapon": 8.5 }, speed: 0.6, range: 10, bleed: true, pen: 0, chip: 0 },
        { name: "Gladius of thorns", type: "Sword", base: 17.5, scaling: { "Medium Weapon": 5.0, "Light Weapon": 5.0 }, speed: 0.67, range: 7.5, bleed: false, pen: 20, chip: 0 },
        { name: "Athompeace", type: "GreatAxe", base: 24.0, scaling: { "Heavy Weapon": 9.5 }, speed: 0.55, range: 9, bleed: true, pen: 0, chip: 0 },
        { name: "Naginata", type: "Spear", base: 17.0, scaling: { "Medium Weapon": 9.5 }, speed: 0.73, range: 9, bleed: true, pen: 5, chip: 0 },
        { name: "Sheu Hu", type: "Staff", base: 19.5, scaling: { "Medium Weapon": 4.5, "Heavy Weapon": 6.5 }, speed: 0.5, range: 8.5, bleed: false, pen: 10, chip: 10 },
        { name: "Moon blade", type: "Dagger", base: 16.0, scaling: { "Light Weapon": 3.5, "Intelligence": 2.0 }, speed: 0.65, range: 7, bleed: true, pen: 30, chip: 0 },
        { name: "Last Struggle", type: "Spear", base: 16.5, scaling: { "Medium Weapon": 8.0 }, speed: 0.66, range: 8, bleed: false, pen: 5, chip: 0 },
        { name: "Maestro Shattered", type: "Sword", base: 20.0, scaling: { "Medium Weapon": 8.0 }, speed: 0.7, range: 8, bleed: false, pen: 25, chip: 0 },
        { name: "Normal claw", type: "Sword", base: 22.0, scaling: { "Medium Weapon": 6.0 }, speed: 0.67, range: 7.5, bleed: false, pen: 0, chip: 0 },
        { name: "Funky driftlander", type: "GreatSword", base: 23.0, scaling: { "Heavy Weapon": 8.0 }, speed: 0.6, range: 9.5, bleed: false, pen: 30, chip: 10 },
        { name: "Sinkindred", type: "Sword", base: 20.0, scaling: { "Medium Weapon": 7.5 }, speed: 0.68, range: 8, bleed: false, pen: 15, chip: 0 },
        { name: "Sunyata", type: "Dagger", base: 16.0, scaling: { "Light Weapon": 8.0 }, speed: 0.65, range: 6, bleed: false, pen: 15, chip: 0 },
        { name: "Sealed sword", type: "Sword", base: 19.5, scaling: { "Medium Weapon": 5.5, "Precision": 2.5 }, speed: 0.7, range: 8.5, bleed: false, pen: 15, chip: 0 },
        { name: "Sporeshot", type: "Gun", base: 14.5, scaling: { "Light Weapon": 15.0 }, speed: 0.75, range: 6.5, bleed: false, pen: 10, chip: 0 },
        { name: "Shroomerang", type: "Sword", base: 24.0, scaling: { "Medium Weapon": 4.0 }, speed: 0.68, range: 7.5, bleed: false, pen: 0, chip: 0 },
        { name: "Kaide", type: "Twinblades", base: 20.0, scaling: { "Medium Weapon": 7.5 }, speed: 0.7, range: 8, bleed: false, pen: 0, chip: 30 },
        { name: "Ratboy Handgun", type: "Gun", base: 15.0, scaling: { "Light Weapon": 11.0 }, speed: 0.75, range: 6, bleed: false, pen: 5, chip: 0 },
        { name: "The endless wave", type: "GreatSword", base: 25.0, scaling: { "Heavy Weapon": 8.0, "Strength": 1.0 }, speed: 0.5, range: 10, bleed: false, pen: 25, chip: 0 },
        { name: "Ratking axe", type: "GreatAxe", base: 28.0, scaling: { "Heavy Weapon": 10.0 }, speed: 0.58, range: 10, bleed: false, pen: 0, chip: 0 },
        { name: "Nos dywll", type: "GreatSword", base: 23.0, scaling: { "Heavy Weapon": 8.0 }, speed: 0.6, range: 10.5, bleed: true, pen: 15, chip: 0 },
        { name: "Snowflake Cestus", type: "Fist", base: 17.5, scaling: { "Light Weapon": 8.0 }, speed: 0.68, range: 6, bleed: false, pen: 5, chip: 0 },
        { name: "FairFrozen", type: "Spear", base: 18.0, scaling: { "Medium Weapon": 9.5 }, speed: 0.7, range: 9, bleed: false, pen: 25, chip: 10 },
        { name: "Sverovetr Greatsword", type: "GreatSword", base: 24.0, scaling: { "Heavy Weapon": 8.0 }, speed: 0.55, range: 9, bleed: false, pen: 0, chip: 0 }
    ],
    
    // the template is very easy to use man, just dont be a retard
    mantras: {
    "Flamecharm": [
        {
            "name": "Fire Blade",
            "desc": "Reversal Spark: Disables Starkindred Fire Blade Variant",
            "req": {
                "Flamecharm": 1
            },
            "gif": "gifs/fire_blade.gif"
        },
        {
            "name": "Burning Servants",
            "desc": "Spawns fire minions.",
            "req": {
                "Flamecharm": 1
            },
            "gif": "gifs/burning_servants.gif"
        },
        {
            "name": "Fire Kick",
            "desc": "Quick fire-infused kick.",
            "req": {
                "Flamecharm": 1
            },
            "gif": "gifs/fire_kick.gif"
        },
        {
            "name": "Fire Forge (Base)",
            "desc": "throw flame daggers.",
            "req": {
                "Flamecharm": 20
            },
            "gif": "gifs/fire_forge__base_.gif"
        },
        {
            "name": "Fire Forge (Tornado Spark)",
            "desc": "Upgraded fire forge.",
            "req": {
                "Flamecharm": 20
            },
            "gif": "gifs/fire_forge__tornado_spark_.gif"
        },
        {
            "name": "Rising Flame",
            "desc": "(Procs Meteor Impact Talent)",
            "req": {
                "Flamecharm": 20
            },
            "gif": "gifs/rising_flame.gif"
        },
        {
            "name": "Fire Eruption",
            "desc": "fire eruption, the fuck did u expect?.",
            "req": {
                "Flamecharm": 30
            },
            "gif": "gifs/fire_eruption.gif"
        },
        {
            "name": "Flame Assault",
            "desc": "Forward flame dash attack.",
            "req": {
                "Flamecharm": 30
            },
            "gif": "gifs/flame_assault.gif"
        },
        {
            "name": "Flaming Scourge",
            "desc": "3 Hits, 2 during swing grab. 3rd is a downslam.",
            "req": {
                "Flamecharm": 50
            },
            "gif": "gifs/flaming_scourge.gif"
        },
        {
            "name": "Flaming Scourge (reversal spark)",
            "desc": "God, this is gonna be annoying to fight.",
            "req": {
                "Flamecharm": 50
            },
            "gif": "gifs/flaming_scourge__reversal_spark_.gif"
        },
        {
            "name": "Ash Slam",
            "desc": "2nd hit ragdolls.",
            "req": {
                "Flamecharm": 50,
                "Strength": 30
            },
            "gif": "gifs/ash_slam.gif"
        },
        {
            "name": "Flame volley",
            "desc": "throw up to 3 fire balls to volley at ppl",
            "req": {
                "Flamecharm": 30
            },
            "gif": "gifs/flame_volley.gif"
        },
        {
            "name": "Flame repulsion",
            "desc": "you become the bomb",
            "req": {
                "Flamecharm": 1
            },
            "gif": "gifs/flame_repulsion.gif"
        },
        {
            "name": "Flame repulsion (spring spark)",
            "desc": "yowaimo",
            "req": {
                "Flamecharm": 1
            },
            "gif": "gifs/flame_repulsion__spring_spark_.gif"
        },
        {
            "name": "Flame leap",
            "desc": "procs meteor slam",
            "req": {
                "Flamecharm": 30
            },
            "gif": "gifs/Flame_Leap.gif"
        },
        {
            "name": "Flame leap (reversal spark)",
            "desc": "its fun ig?",
            "req": {
                "Flamecharm": 30
            },
            "gif": "gifs/Flame_Leap_Reversal_Spark.gif"
        },
    ],
    "Frostdraw": [
        {
            "name": "Ice Blade",
            "desc": "Ice-infused blade attack.",
            "req": {
                "Frostdraw": 20
            },
            "gif": "gifs/ice_blade.gif"
        },
        {
            "name": "Ice Daggers",
            "desc": "Throw daggers of ice.",
            "req": {
                "Frostdraw": 20
            },
            "gif": "gifs/ice_daggers.gif"
        },
        {
            "name": "Ice Chain",
            "desc": "Chains the target in frost.(ez parr bait mantra)",
            "req": {
                "Frostdraw": 20
            },
            "gif": "gifs/ice_chain.gif"
        },
        {
            "name": "Ice Lasers",
            "desc": "amount of lasers scales to the amount of frostdraw that u got",
            "req": {
                "Frostdraw": 20
            },
            "gif": "gifs/ice_lasers.gif"
        },
        {
            "name": "Ice Eruption",
            "desc": "trap ppl in ice and combo extend",
            "req": {
                "Frostdraw": 20
            },
            "gif": "gifs/ice_eruption.gif"
        },
        {
            "name": "Ice Lance",
            "desc": "top 5 best combo extenders",
            "req": {
                "Frostdraw": 30
            },
            "gif": "gifs/ice_lance.gif"
        },
        {
            "name": "Ice Smash",
            "desc": "gbs at lvl 5",
            "req": {
                "Frostdraw": 30
            },
            "gif": "gifs/ice_smash.gif"
        },
        {
            "name": "Frost Grab",
            "desc": "Pull enemies closer with ice.",
            "req": {
                "Frostdraw": 30
            },
            "gif": "gifs/frost_grab.gif"
        },
        {
            "name": "Crystal Knee",
            "desc": "Uppercut the opps with your knee.",
            "req": {
                "Frostdraw": 30
            },
            "gif": "gifs/crystal_knee.gif"
        },
        {
            "name": "Crystal Impale",
            "desc": "Impale target with ice crystals.",
            "req": {
                "Frostdraw": 30
            },
            "gif": "gifs/crystal_impale.gif"
        },
        {
            "name": "Rising Frost",
            "desc": "rising flame sister",
            "req": {
                "Frostdraw": 30
            },
            "gif": "gifs/rising_frost.gif"
        },
        {
            "name": "Frost Wisp",
            "desc": "Summon a frost companion.",
            "req": {
                "Frostdraw": 30
            },
            "gif": "gifs/frost_wisp.gif"
        },
        {
            "name": "Ice Cubes",
            "desc": "ice cubes, baby",
            "req": {
                "Frostdraw": 50
            },
            "gif": "gifs/ice_cubes.gif"
        },
        {
            "name": "Glacial Collapse",
            "desc": "Massive ice slam.",
            "req": {
                "Frostdraw": 50,
                "Strength": 20
            },
            "gif": "gifs/glacial_collapse.gif"
        },
        {
            "name": "Iceberg",
            "desc": "Form an iceberg that heals you (this mantra sucks)",
            "req": {
                "Frostdraw": 50
            },
            "gif": "gifs/iceberg.gif"
        }
    ],
    "Galebreathe": [
        {
            "name": "Wind Blade",
            "desc": "has a Sliding variant, aim with mouse.",
            "req": {
                "Galebreathe": 1
            },
            "gif": "gifs/wind_blade.gif"
        },
        {
            "name": "Gale Lunge",
            "desc": "Can Proc Haunted Gale.",
            "req": {
                "Galebreathe": 20
            },
            "gif": "gifs/gale_lunge.gif"
        },
        {
            "name": "Wind Forge",
            "desc": "Wind daggers that autoaim.",
            "req": {
                "Galebreathe": 20
            },
            "gif": "gifs/wind_forge.gif"
        },
        {
            "name": "Twister Kicks",
            "desc": "Spinning kicks. (fuckass mantra)",
            "req": {
                "Galebreathe": 20
            },
            "gif": "gifs/twister_kicks.gif"
        },
        {
            "name": "Heavenly Wind",
            "desc": "fly up in the sky then slam the opps.",
            "req": {
                "Galebreathe": 20
            },
            "gif": "gifs/heavenly_wind.gif"
        },
        {
            "name": "Gale Punch",
            "desc": "not the same as real deep one",
            "req": {
                "Galebreathe": 30
            },
            "gif": "gifs/gale_punch.gif"
        },
        {
            "name": "Rising Wind",
            "desc": "Rising flame's best friend",
            "req": {
                "Galebreathe": 30
            },
            "gif": "gifs/rising_wind.gif"
        },
        {
            "name": "Wind Gun",
            "desc": "Blast/Multiplying Spark available. DM me or Ping me if u got gifs",
            "req": {
                "Galebreathe": 30
            },
            "gif": "gifs/wind_gun.gif"
        },
        {
            "name": "Champion’s Whirlthrow",
            "desc": "Spinning throw that gbs.",
            "req": {
                "Galebreathe": 30
            },
            "gif": "gifs/champion_s_whirlthrow.gif"
        },
        {
            "name": "Wind Carve",
            "desc": "Slicing wind waves.",
            "req": {
                "Galebreathe": 30
            },
            "gif": "gifs/wind_carve.gif"
        },
        {
            "name": "Gale Wisp",
            "desc": "Wind companion.",
            "req": {
                "Galebreathe": 30
            },
            "gif": "gifs/gale_wisp.gif"
        },
        {
            "name": "Wind Passage",
            "desc": "Teleporting wind strike.",
            "req": {
                "Galebreathe": 50
            },
            "gif": "gifs/wind_passage.gif"
        },
        {
            "name": "Astral Wind",
            "desc": "top 3 mantras of all time",
            "req": {
                "Galebreathe": 50
            },
            "gif": "gifs/astral_wind.gif"
        },
        {
            "name": "Talon Gale",
            "desc": "he tryna be rising wind but fails",
            "req": {
                "Galebreathe": 50,
                "Agility": 20
            },
            "gif": "gifs/talon_gale.gif"
        }
    ],
    "Thundercall": [
        {
            "name": "Jolt Grab",
            "desc": "Electric grab.",
            "req": {
                "Thundercall": 1
            },
            "gif": "gifs/jolt_grab.gif"
        },
        {
            "name": "Jolt Grab (magnet spark)",
            "desc": "Electric autoaim grab attack.",
            "req": {
                "Thundercall": 1
            },
            "gif": "gifs/jolt_grab__magnet_spark_.gif"
        },
        {
            "name": "Lightning Blade",
            "desc": "Two lightning slashes.",
            "req": {
                "Thundercall": 1
            },
            "gif": "gifs/lightning_blade.gif"
        },
        {
            "name": "Lightning Beam",
            "desc": "Fast lightning beam.",
            "req": {
                "Thundercall": 1
            },
            "gif": "gifs/lightning_beam.gif"
        },
        {
            "name": "Thunder Kick",
            "desc": "lightning kick that gbs.",
            "req": {
                "Thundercall": 20
            },
            "gif": "gifs/thunder_kick.gif"
        },
        {
            "name": "Lightning Impact",
            "desc": "Lightning ground slam.(WARNING: VERY DELAYED)",
            "req": {
                "Thundercall": 20
            },
            "gif": "gifs/lightning_impact.gif"
        },
        {
            "name": "Fleeting Sparks",
            "desc": "Burst of 3 to 5 electrical balls.",
            "req": {
                "Thundercall": 20
            },
            "gif": "gifs/fleeting_sparks.gif"
        },
        {
            "name": "Grand Javelin",
            "desc": "Massive lightning spear.(this is just pika-pika no mi)",
            "req": {
                "Thundercall": 30
            },
            "gif": "gifs/grand_javelin.gif"
        },
        {
            "name": "Grand Javelin (multiplying spark)",
            "desc": "i sure hope this wont deal triple the dmg!",
            "req": {
                "Thundercall": 30
            },
            "gif": "gifs/grand_javelin__multiplying_spark_.gif"
        },
        {
            "name": "Thunder Wisp",
            "desc": "Electric companion.",
            "req": {
                "Thundercall": 30
            },
            "gif": "gifs/thunder_wisp.gif"
        },
        {
            "name": "Storm Blades",
            "desc": "Circle of lighting blades.",
            "req": {
                "Thundercall": 30
            },
            "gif": "gifs/storm_blades.gif"
        },
        {
            "name": "Electro Carve",
            "desc": "lightning AOE attack (rest in peace old electro carve)",
            "req": {
                "Thundercall": 50
            },
            "gif": "gifs/electro_carve.gif"
        },
        {
            "name": "Electro Carve (magnet spark)",
            "desc": "throw electro ball at ppl (most fuckass move ever)",
            "req": {
                "Thundercall": 50
            },
            "gif": "gifs/electro_carve__magnet_spark_.gif"
        },
        {
            "name": "Electro Carve (blast spark)",
            "desc": "YOU become the lightning AOE attack (friendly fire version)",
            "req": {
                "Thundercall": 50
            },
            "gif": "gifs/electro_carve__blast_spark_.gif"
        },
        {
            "name": "Rising Thunder",
            "desc": "Launches the user with lightning to do a barrage of lightning attacks (idk how to explain it).",
            "req": {
                "Thundercall": 50
            },
            "gif": "gifs/rising_thunder.gif"
        },
        {
            "name": "Emotion Wave",
            "desc": "Expanding wave of electricity.(reworked verison is still ass)",
            "req": {
                "Thundercall": 50
            },
            "gif": "gifs/emotion_wave.gif"
        },
        {
            "name": "Lighting assault",
            "desc": "speedrunner favo mantra (i think you can clip throught most stuff with it)",
            "req": {
                "Thundercall": 30
            },
            "gif": "gifs/lighting_assault.gif"
        },
        {
            "name": "Lighting stream",
            "desc": "1 frame mantra (dw its balanced here)",
            "req": {
                "Thundercall": 30
            },
            "gif": "gifs/lighting_stream.gif"
        },
        {
            "name": "Lighting stream (blast spark)",
            "desc": "more dmg instead of pull",
            "req": {
                "Thundercall": 30
            },
            "gif": "gifs/lighting_stream__blast_spark_.gif"
        },
        {
            "name": "Lighting stream (reversal spark)",
            "desc": "you get pulled instead (why?)",
            "req": {
                "Thundercall": 30
            },
            "gif": "gifs/lighting_stream__reversal_spark_.gif"
        }
    ],
    "Shadowcast": [
        {
            "name": "Dark Blade",
            "desc": "3 shadow slashes.",
            "req": {
                "Shadowcast": 1
            },
            "gif": "gifs/dark_blade.gif"
        },
        {
            "name": "Clutching Shadow",
            "desc": "Grab from the abyss.(cold description ik)",
            "req": {
                "Shadowcast": 1
            },
            "gif": "gifs/clutching_shadow.gif"
        },
        {
            "name": "Shadow Gun",
            "desc": "Ranged shadow shot.",
            "req": {
                "Shadowcast": 1
            },
            "gif": "gifs/shadow_gun.gif"
        },
        {
            "name": "shadoww gun (blast spark)",
            "desc": "ceros.",
            "req": {
                "Shadowcast": 1
            },
            "gif": "gifs/shadoww_gun__blast_spark_.gif"
        },
        {
            "name": "Shadow Eruption",
            "desc": "Blast of shadow infused in your blade.",
            "req": {
                "Shadowcast": 20
            },
            "gif": "gifs/shadow_eruption.gif"
        },
        {
            "name": "Encircle",
            "desc": "crit movestack autoaim move",
            "req": {
                "Shadowcast": 20
            },
            "gif": "gifs/encircle.gif"
        },
        {
            "name": "Shadow roar",
            "desc": "free crowd heals",
            "req": {
                "Shadowcast": 20
            },
            "gif": "gifs/shadow_roar.gif"
        },
        {
            "name": "Shadow Seekers",
            "desc": "Homing shadow orbs.",
            "req": {
                "Shadowcast": 20
            },
            "gif": "gifs/shadow_seekers.gif"
        },
        {
            "name": "Shadow Flux",
            "desc": "Surrounding aura of darkness.",
            "req": {
                "Shadowcast": 20
            },
            "gif": "gifs/shadow_flux.gif"
        },
        {
            "name": "Shadow Assault",
            "desc": "Dashing shadow attack.",
            "req": {
                "Shadowcast": 30
            },
            "gif": "gifs/shadow_assault.gif"
        },
        {
            "name": "Shade Wisp",
            "desc": "Dark companion.",
            "req": {
                "Shadowcast": 30
            },
            "gif": "gifs/shade_wisp.gif"
        },
        {
            "name": "Rising Shadow (Base)",
            "desc": "rising flame enemy.",
            "req": {
                "Shadowcast": 30
            },
            "gif": "gifs/rising_shadow__base_.gif"
        },
        {
            "name": "Rising Shadow (Blast Spark)",
            "desc": "Keeps targets stuck on ground, steals ether.",
            "req": {
                "Shadowcast": 30
            },
            "gif": "gifs/rising_shadow__blast_spark_.gif"
        },
        {
            "name": "Eclipse Kick",
            "desc": "Brutal shadow kick.",
            "req": {
                "Shadowcast": 50,
                "Strength": 30
            },
            "gif": "gifs/eclipse_kick.gif"
        },
        {
            "name": "Shade Bringer",
            "desc": "Massive shadow slash.",
            "req": {
                "Shadowcast": 50
            },
            "gif": "gifs/shade_bringer.gif"
        },
        {
            "name": "shadow meteors",
            "desc": "3 shadow meteors.",
            "req": {
                "Shadowcast": 30
            },
            "gif": "gifs/shadow_meteors.gif"
        },
        {
            "name": "umbral slash",
            "desc": "Very basic shadow-infused slash",
            "req": {
                "Shadowcast": 30
            },
            "gif": "gifs/umbral_slash.gif"
        }
    ],
    "Ironsing": [
        {
            "name": "Metal Slash",
            "desc": "Basic iron slashes.",
            "req": {
                "Ironsing": 1
            },
            "gif": "gifs/metal_slash.gif"
        },
        {
            "name": "Metal Kick",
            "desc": "Spring Spark variant available. dm me or ping me if u got the gif",
            "req": {
                "Ironsing": 20
            },
            "gif": "gifs/metal_kick.gif"
        },
        {
            "name": "Caltrops",
            "desc": "Deploy spike traps.(fuckass mantra)",
            "req": {
                "Ironsing": 20
            },
            "gif": "gifs/caltrops.gif"
        },
        {
            "name": "Metal Fakeout",
            "desc": "Iron backshots.",
            "req": {
                "Ironsing": 20
            },
            "gif": "gifs/metal_fakeout.gif"
        },
        {
            "name": "Metal Ball",
            "desc": "Launch yourself as an iron sphere.",
            "req": {
                "Ironsing": 20
            },
            "gif": "gifs/metal_ball.gif"
        },
        {
            "name": "Iron Quills",
            "desc": "Burst of metal spikes.",
            "req": {
                "Ironsing": 20
            },
            "gif": "gifs/iron_quills.gif"
        },
        {
            "name": "Oxidizing Rush",
            "desc": "Fast metallic charge.",
            "req": {
                "Ironsing": 20
            },
            "gif": "gifs/oxidizing_rush.gif"
        },
        {
            "name": "Metal Wisp",
            "desc": "Iron companion.",
            "req": {
                "Ironsing": 20
            },
            "gif": "gifs/metal_wisp.gif"
        },
        {
            "name": "Rocket Lance",
            "desc": "Metal piercing combo extender.",
            "req": {
                "Ironsing": 20
            },
            "gif": "gifs/rocket_lance.gif"
        },
        {
            "name": "Metal Gatling",
            "desc": "Barrage of iron.",
            "req": {
                "Ironsing": 50
            },
            "gif": "gifs/metal_gatling.gif"
        },
        {
            "name": "Iron Hug",
            "desc": "his hugs are kinda ironic.",
            "req": {
                "Ironsing": 50
            },
            "gif": "gifs/iron_hug.gif"
        },
        {
            "name": "Iron Slam",
            "desc": "Massive iron slam.",
            "req": {
                "Ironsing": 50
            },
            "gif": "gifs/iron_slam.gif"
        },
        {
            "name": "Metal Armament",
            "desc": "Coats your weapon in iron.",
            "req": {
                "Ironsing": 50
            },
            "gif": "gifs/metal_armament.gif"
        }
    ],
    "Bloodrend": [
        {
            "name": "Blood Orb",
            "desc": "Multiplying Spark available. dm me or ping me if u got the gif",
            "req": {
                "Bloodrend": 1
            },
            "gif": "gifs/blood_orb.gif"
        },
        {
            "name": "Blood Beam",
            "desc": "choso aba move.",
            "req": {
                "Bloodrend": 1
            },
            "gif": "gifs/blood_beam.gif"
        },
        {
            "name": "Blood Explosion",
            "desc": "dont use this shit.",
            "req": {
                "Bloodrend": 1
            },
            "gif": "gifs/blood_explosion.gif"
        },
        {
            "name": "Scarlet Cyclone",
            "desc": "blood tornado",
            "req": {
                "Bloodrend": 1
            },
            "gif": "gifs/scarlet_cyclone.gif"
        },
        {
            "name": "multiplying spark scarlet cyclone",
            "desc": "3 tornados instead of one!.",
            "req": {
                "Bloodrend": 50
            },
            "gif": "gifs/multiplying_spark_scarlet_cyclone.gif"
        },
        {
            "name": "reversal spark scarlet cyclone",
            "desc": "the tornado noww comes back to you",
            "req": {
                "Bloodrend": 50
            },
            "gif": "gifs/reversal_spark_scarlet_cyclone.gif"
        },
        {
            "name": "Bloodedge",
            "desc": "Blade of hardened blood. Works like gale lunge",
            "req": {
                "Bloodrend": 20
            },
            "gif": "gifs/bloodedge.gif"
        },
        {
            "name": "Vicious Descent",
            "desc": "Dropping strike from above.",
            "req": {
                "Bloodrend": 20
            },
            "gif": "gifs/vicious_descent.gif"
        },
        {
            "name": "Exorcism",
            "desc": "Purging blood blast.",
            "req": {
                "Bloodrend": 20
            },
            "gif": "gifs/exorcism.gif"
        },
        {
            "name": "Blood Eruption",
            "desc": "3 blood explosions fused together.",
            "req": {
                "Bloodrend": 20
            },
            "gif": "gifs/blood_eruption.gif"
        },
        {
            "name": "Crimson Rain",
            "desc": "Summon alot of blood daggers. Cast the mantra again to recall them",
            "req": {
                "Bloodrend": 30
            },
            "gif": "gifs/crimson_rain.gif"
        },
        {
            "name": "Blood Crucifixion",
            "desc": "dark vader move.",
            "req": {
                "Bloodrend": 30
            },
            "gif": "gifs/blood_crucifixion.gif"
        },
        {
            "name": "Blood Wisp",
            "desc": "Blood companion.",
            "req": {
                "Bloodrend": 30
            },
            "gif": "gifs/blood_wisp.gif"
        },
        {
            "name": "Razor Blitz",
            "desc": "he tryna be rising flame.",
            "req": {
                "Bloodrend": 30
            },
            "gif": "gifs/razor_blitz.gif"
        },
        {
            "name": "Artery Rip",
            "desc": "Devastating close range rip.",
            "req": {
                "Bloodrend": 50
            },
            "gif": "gifs/artery_rip.gif"
        }
    ],
    "Earthbend": [
        {
            "name": "Earth Block",
            "desc": "Two-hit move.",
            "req": {
                "Earthbend": 1
            },
            "gif": "gifs/earth_block.gif"
        },
        {
            "name": "Earth Pillars",
            "desc": "Throw pillar of rocks at ppl, peak right?",
            "req": {
                "Earthbend": 1
            },
            "gif": "gifs/earth_pillars.gif"
        },
        {
            "name": "Shatter Throw",
            "desc": "Throw only two rocks.",
            "req": {
                "Earthbend": 20
            },
            "gif": "gifs/shatter_throw.gif"
        },
        {
            "name": "Crushing Slam",
            "desc": "Heavy rock slam.",
            "req": {
                "Earthbend": 30
            },
            "gif": "gifs/crushing_slam.gif"
        },
        {
            "name": "Pillar Barrage",
            "desc": "Continuous earth pillar barrages.",
            "req": {
                "Earthbend": 30
            },
            "gif": "gifs/pillar_barrage.gif"
        },
        {
            "name": "Rocker Punch",
            "desc": "Earth-infused punch.",
            "req": {
                "Earthbend": 30
            },
            "gif": "gifs/rocker_punch.gif"
        },
        {
            "name": "Elbow Strike",
            "desc": "Ex-strike ripoff.",
            "req": {
                "Earthbend": 30
            },
            "gif": "gifs/elbow_strike.gif"
        },
        {
            "name": "Compress",
            "desc": "gb ppl with two walls",
            "req": {
                "Earthbend": 50
            },
            "gif": "gifs/compress.gif"
        },
        {
            "name": "Rock Flow",
            "desc": "Moving earth wave. works like gale lunge",
            "req": {
                "Earthbend": 50
            },
            "gif": "gifs/rock_flow.gif"
        },
        {
            "name": "Hard Impact",
            "desc": "battleground ahhh mantra",
            "req": {
                "Earthbend": 50
            },
            "gif": "gifs/hard_impact.gif"
        },
        {
            "name": "Formation",
            "desc": "Create homing pillars that deals too much dmg",
            "req": {
                "Earthbend": 50
            },
            "gif": "gifs/formation.gif"
        }
    ],
    "Hybrid Mantras": [
        {
            "name": "Vivisect",
            "desc": "Blood and shadow fusion.",
            "req": {
                "Bloodrend": 50,
                "Shadowcast": 30
            },
            "gif": "gifs/vivisect.gif"
        },
        {
            "name": "Soul Beam",
            "desc": "Requires Oathless. Fusion of all elements.",
            "req": {
                "Flamecharm": 30,
                "Frostdraw": 30,
                "Thundercall": 30,
                "Shadowcast": 30,
                "Galebreathe": 30,
                "Ironsing": 30,
                "Bloodrend": 30
            },
            "gif": "gifs/soul_beam.gif"
        }
    ],
    "Attunementless": [
        {
            "name": "Dread breath",
            "desc": "why does this mantra do so much dmg",
            "req": {},
            "gif": "gifs/dread_breath.gif"
        },
        {
            "name": "Coral Spear",
            "desc": "The user grows coral on their back and sprays coral in every direction",
            "req": {},
            "gif": "gifs/coral_spear.gif"
        },
        {
            "name": "Mecha Gatling",
            "desc": "why does this mantra do so much dmg (v2) (will be added soon)",
            "req": {},
            "gif": "gifs/mecha_gatling.gif"
        },
        {
            "name": "Enforcer Pull ",
            "desc": "pull from enforcer the mob",
            "req": {},
            "gif": "gifs/enforcer_pull_.gif"
        },
        {
            "name": "prominence draw",
            "desc": "another gap closer slop mantra",
            "req": {
                "Medium Weapon": 50
            },
            "gif": "gifs/prominence_draw.gif"
        },
        {
            "name": "Table Flip",
            "desc": "no need to get that mad yo",
            "req": {
                "Strength": 40
            },
            "gif": "gifs/Table_Flip.gif"
        },
        {
            "name": "Rapid Slashes",
            "desc": "another gap closer slop mantra",
            "req": {
                "Light Weapon": 30
            },
            "gif": "gifs/Rapid_Slashes.gif"
        },
        {
            "name": "Round Spark Skyshatter Kick",
            "desc": "aoe uppercut instead of two kicks with high dmg ",
            "req": {
                "Strength": 80
            },
            "gif": "gifs/Skyshatter_kick_roundspark.gif"
        },
        {
            "name": "Strong leap",
            "desc": "how is this useful?",
            "req": {
                "Strength": 50
            },
            "gif": "gifs/Strong_Leap.gif"
        },
        {
            "name": "Master's Flourish",
            "desc": "another shaky block slop mantra",
            "req": {
                "Medium Weapon": 30
            },
            "gif": "gifs/master_s_flourish.gif"
        },
        {
            "name": "Twincleave",
            "desc": "another gap closer slop mantra(DEADASS WHERE IS THE FUN IN THIS MANTRA)",
            "req": {
                "Medium Weapon": 50
            },
            "gif": "gifs/twincleave.gif"
        },
        {
            "name": "Breeze Blitz",
            "desc": "Extends with that one Talent.",
            "req": {
                "Light Weapon": 40
            },
            "gif": "gifs/breeze_blitz.gif"
        },
        {
            "name": "Strong Left",
            "desc": "one punch man mantra",
            "req": {
                "Strength": 10
            },
            "gif": "gifs/strong_left.gif"
        },
        {
            "name": "Rapid Punches",
            "desc": "barrage of punchs",
            "req": {
                "Strength": 30
            },
            "gif": "gifs/rapid_punches.gif"
        },
        {
            "name": "Skyshatter Kick",
            "desc": "two gb kicks that AT LEAST deal a bar",
            "req": {
                "Strength": 80
            },
            "gif": "gifs/skyshatter_kick.gif"
        },
        {
            "name": "Precise Slashes",
            "desc": "Dashing barrage of slashes.",
            "req": {
                "Precision": 20
            },
            "gif": "gifs/precise_slashes.gif"
        },
        {
            "name": "Controlled Punch",
            "desc": "Focused strike that moves you forward.",
            "req": {
                "Precision": 20
            },
            "gif": "gifs/controlled_punch.gif"
        },
        {
            "name": "Shoulder Bash",
            "desc": "Charging bash.",
            "req": {
                "Fortitude": 20
            },
            "gif": "gifs/shoulder_bash.gif"
        },
        {
            "name": "Reinforce",
            "desc": "Stat buff + free heal.",
            "req": {
                "Fortitude": 50
            },
            "gif": "gifs/reinforce.gif"
        },
        {
            "name": "Revenge",
            "desc": "top 3 mantras",
            "req": {
                "Agility": 1
            },
            "gif": "gifs/revenge.gif"
        },
        {
            "name": "Adrenaline Surge",
            "desc": "Increases Movement Speed + swingspeed if you have that one talent.",
            "req": {
                "Agility": 20
            },
            "gif": "gifs/adrenaline_surge.gif"
        },
        {
            "name": "Dash",
            "desc": "dash.",
            "req": {
                "Agility": 40
            },
            "gif": "gifs/dash.gif"
        },
        {
            "name": "Shadestep",
            "desc": "cooler dash.",
            "req": {
                "Agility": 60
            },
            "gif": "gifs/shadestep.gif"
        },
        {
            "name": "Ambush",
            "desc": "Sneaky attack.",
            "req": {
                "Light Weapon": 60
            },
            "gif": "gifs/ambush.gif"
        },
        {
            "name": "Prediction",
            "desc": "Engi's favorite mantra.",
            "req": {
                "Intelligence": 50
            },
            "gif": "gifs/prediction.gif"
        },
        {
            "name": "Exhaustion Strike",
            "desc": "best mantra oath.",
            "req": {
                "Willpower": 40
            },
            "gif": "gifs/exhaustion_strike.gif"
        },
        {
            "name": "Glare",
            "desc": "Intimidate targets (gives insanity to you for some fuckass reason).",
            "req": {
                "Willpower": 60
            },
            "gif": "gifs/glare.gif"
        },
        {
            "name": "Lunatism",
            "desc": "Sets people to Max Insanity.",
            "req": {
                "Willpower": 100
            },
            "gif": "gifs/lunatism.gif"
        },
        {
            "name": "Sing",
            "desc": "Charm ppl with your voice.",
            "req": {
                "Charisma": 25
            },
            "gif": "gifs/sing.gif"
        },
        {
            "name": "Taunt",
            "desc": "Increases DMG Dealt and Taken.",
            "req": {
                "Charisma": 25
            },
            "gif": "gifs/taunt.gif"
        },
        {
            "name": "Flashdraw Strike",
            "desc": "Swift weapon attack.",
            "req": {
                "Agility": 25,
                "Medium Weapon": 50
            },
            "gif": "gifs/flashdraw_strike.gif"
        },
        {
            "name": "Air Rending",
            "desc": "Annoying tp move.",
            "req": {
                "Strength": 25,
                "Light Weapon": 40
            },
            "gif": "gifs/air_rending.gif"
        },
        {
            "name": "Skyshatter Pierce",
            "desc": "High impact piercing (windup so slow).",
            "req": {
                "Strength": 30,
                "Precision": 50
            },
            "gif": "gifs/skyshatter_pierce.gif"
        },
        {
            "name": "Twinstrikes",
            "desc": "basic double kicks.",
            "req": {
                "Agility": 40,
                "Strength": 60
            },
            "gif": "gifs/twinstrikes.gif"
        }
    ]
}
};

const calcData = {
    dmg: [
        { n: "Flame Within", v: 10, cat: "UB_PB" },{ n: "Taunt", v: 15, cat:"UB_TB"}, { n: "Speed Demon", v: 7.5, cat: "WB_TB" }, { n: "Lose Your Mind", v: 10, cat: "UB_PB" }, { n: "Decisive Battle", v: 10, cat: "UB_TB" }, { n: "Perfect Flash", v: 25, cat: "MB_TB" }, { n: "Eureka", v: 10, cat: "MB_TB" }, { n: "Overflowing Dam", v: 10, cat: "WB_PB" }, { n: "Ardour Scream", v: 25, cat: "UB_TB" }, { n: "Underdog", v: 4, cat: "UB_PB" }, { n: "Tough Love", v: 10, cat: "UB_PB" }, { n: "Manipulator", v: 20, cat: "UB_PB" }, { n: "Matador", v: 20, cat: "UB_TB" }, { n: "Knife's Journey", v: 15, cat: "WB_TB" }, { n: "Rush Hours", v: 15, cat: "UB_PB" }, { n: "Reshape and Remold", v: 5, cat: "UB_PB" }, { n: "Exposed Durability", v: 10, cat: "UB_PB" }, { n: "Reinforce Mantra", v: 3, cat: "UB_TB" }, { n: "Raiton Path", v: 10, cat: "UB_PB" }
    ],
    pen: [
        { n: "Million Ton Piercer", v: 5 },{ n: "Master of His Craft", v:20 }, { n: "Dead Eye", v: 10 }, { n: "Upcoming Opportunity", v: 30 }, { n: "Cheap Shot", v: 10 }, { n: "Ether Overdrive", v: 5 }, { n: "Piercing Will", v: 15 }, { n: "Cult of Personality", v: 15 }, { n: "Sturdy Control", v: 15 }, { n: "Tooth and Claw", v: 20 }, { n: "Dancing With The Dead", v: 2.5 }
    ]
};
const hpTalentMap = {
    "The Sounds from Below": 115, "Return to the Dark Ages": 5, "Underdog": 3,
    "Piercing Will": 5, "Shared Misery": 5, "All The Dead Gods": 5, "Perfect Flash": 2,
    "Foolish Outburst": 5, "Ether overdrive": 5, "Brick Wall": 5, "Reinforced Armor": 5,
    "Exoskeleton": 5, "Tap Dancer": 5, "Lose Your Mind": 5, "Million Ton Piercer": 5
};
const effectMap = {
    
    "Flame Within": { v: 10, t: 'u' },
    "Taunt": { v: 15, t: 'u' },
    "Lose Your Mind": { v: 10, t: 'u' },
    "Tough Love": { v: 10, t: 'u' },
    "Ardour Scream": { v: 25, t: 'u' },
    "Rush Hour": { v: 15, t: 'u' },
    "Raiton Path: Enlightened": { v: 10, t: 'u' },

    
    "Decisive Battle": { v: 10, t: 'w' },
    "Knife's Journey": { v: 15, t: 'w' },
    "Speed Demon": { v: 7.5, t: 'w' },
    "Overflowing Dam": { v: 10, t: 'w' },
    "Manipulator": { v: 20, t: 'w' },

    
    "Perfect Flash": { v: 25, t: 'm' },
    "Eureka": { v: 10, t: 'm' },

    
    "Million Ton Piercer": { v: 5, t: 'p' },
    "Master of His Craft": { v: 20, t: 'p' },
    "Upcoming Opportunity": { v: 30, t: 'p' },
    "Cheap Shot": { v: 10, t: 'p' },
    "Ether Overdrive": { v: 5, t: 'p' },
    "Piercing Will": { v: 15, t: 'p' },
    "Sturdy Control": { v: 15, t: 'p' },
    "Cult of Personality": { v: 15, t: 'p' }
};


let userStats = {};
let userTraits = { "Vitality": 0, "Erudition": 0, "Proficiency": 0, "Songchant": 0 };
let selectedOath = "";
let selectedTalents = new Set();
let selectedMantras = []; 
let activeBuffs = new Set();
let collapsedCats = new Set();
let currentTab = 'talents';
let selectedWeapon = null;
let selectedEnchant = "no enchant";
let userNotes = "";
let currentAdminColor = "#ff0000"; 




const JSONBIN_KEY = '$2a$10$sLrFF.ABoJcUYrK2Ps8lxusDVHHm.E00yjgfvttWumaj34EYr61qy'; 
const JSONBIN_BIN_ID = '';
const talentList = Object.values(gameData.talents).flat();
const mantraList = Object.values(gameData.mantras).flat();
const talentMap = talentList.map(t => t.name);
const mantraMap = mantraList.map(m => m.name);
const allStatKeys = [...gameData.attributes, ...gameData.attunements];
const weaponMap = gameData.weapons.map(w => w.name);
const enchantMap = gameData.enchants;
const statShorthand = {
    "str": "Strength", "fort": "Fortitude", "agi": "Agility", "int": "Intelligence", 
    "will": "Willpower", "cha": "Charisma", "pre": "Precision", "light": "Light Weapon", 
    "med": "Medium Weapon", "heavy": "Heavy Weapon", "flame": "Flamecharm", 
    "frost": "Frostdraw", "thunder": "Thundercall", "shadow": "Shadowcast", 
    "gale": "Galebreathe", "iron": "Ironsing", "blood": "Bloodrend", "earth": "Earthbend"
};

const mutualExclusions = [
    ["Simple Path: Electrocution", "Raiton Path: Enlightened", "Surge Path: Unstable Capacitor"],
    ["Unyielding Frost", "Glass Path: Crystallization"],
    ["The Final Act", "Eruption Path: Lava Serpent"],
    ["Emperor Flame", "Eruption Path: Lava Serpent"],
    ["Gilded Path: Scrapsinger", "Decay Path: Oxidize"],
    ["Manipulation Path: Spirit Lantern", "Manipulation Path: Agile Misery", "Simple Manipulation: Unstable Blood"],
    ["Wraith Path: Umbra", "Eruption Path: Lava Serpent", "Flashboil"],
    ["Flashboil", "Glass Path: Crystallization"],
    ["Narcissist", "Tough Love"]
];
const deepGemList = ["No Gem", "Aegis", "Blessed", "Bloodless", "Blue", "Erosion", "Fraud", "Insignia", "Might", "Nocturnal", "Sealing", "Warped Blue", "Wayward", "Wind", "Wrath"];


function exportBuildToDWM() {
    
    const dwmStats = {
        "TotalStrength": userStats["Strength"] || 0,
        "TotalAgility": userStats["Agility"] || 0,
        "TotalCharisma": userStats["Charisma"] || 0,
        "TotalWillpower": userStats["Willpower"] || 0,
        "TotalFortitude": userStats["Fortitude"] || 0,
        "TotalIntelligence": userStats["Intelligence"] || 0,
        "TotalPrecision": userStats["Precision"] || 0,

        "TotalWeaponHeavy": userStats["Heavy Weapon"] || 0,
        "TotalWeaponLight": userStats["Light Weapon"] || 0,
        "TotalWeaponMedium": userStats["Medium Weapon"] || 0,

        "TotalElementBlood": userStats["Bloodrend"] || 0,
        "TotalElementEarth": userStats["Earthbend"] || 0,
        "TotalElementFire": userStats["Flamecharm"] || 0,
        "TotalElementIce": userStats["Frostdraw"] || 0,
        "TotalElementIron": userStats["Ironsing"] || 0,
        "TotalElementLightning": userStats["Thundercall"] || 0,
        "TotalElementShadow": userStats["Shadowcast"] || 0,
        "TotalElementWind": userStats["Galebreathe"] || 0,

        "TraitHealth": userTraits["Vitality"] || 0,
        "TraitWeaponDamage": userTraits["Proficiency"] || 0,
        "TraitMantraDamage": userTraits["Songchant"] || 0,
        "TraitEther": userTraits["Erudition"] || 0
    };

    
    const jsonOutput = JSON.stringify(dwmStats, null, 2);

    
    navigator.clipboard.writeText(jsonOutput).then(() => {
        alert("Build exported to DWM format and copied to clipboard!");
    }).catch(err => {
        console.error("Failed to copy text: ", err);
        
        alert("Failed to copy. Check console for the JSON.");
        console.log(jsonOutput);
    });
}
function validateBuild() {
    
    if (!selectedWeapon) return "You must equip a weapon.";
    
    
    let totalStats = Object.values(userStats).reduce((a, b) => a + b, 0);
    if (totalStats < 250) return "Incomplete stats. Please invest your points.";

    
    let currentAttCount = 0; 
    gameData.attunements.forEach(a => { if (userStats[a] > 0) currentAttCount++; });
    let maxPts = currentAttCount === 0 ? 410 : 420 + Math.max(0, (currentAttCount - 1) * 5);
    if (totalStats > maxPts + 5) return "Stat limit exceeded (Cheating detected)."; 

    
    if (selectedTalents.size < 5) return "Please select some talents.";

    return null; 
}
function init() {
ensureGlobalModals();
    const splash = [
  "hold it, this guy is cooking",
  "time for a shower twin",
  "DNI deepwoken classic",
  "Yzord NPC gives spec enchants and weps. however, you need to be whitelisted",
  "?timeout @nebula 27d ramadan",
  "FUCK MY LIFE NIGGA IM JUST A RETARD INCEL WHORE",
  "fart fart fart fart fart",
  "ping geo for prime kai theme",
  "bugs? dm or ping @faithandpray",
  "take a break",
  "im a fat greasy pig",
  "TEST EVERYTHING FOR ME PLEASE IM BEGGING YOU",
  "ping @lz4decompress in general chat he loves it",
  "never ask a man his salary, a woman her weight or mon his build",
  "I USE GALE IM A CUCKY DRONE AND I LOVE THE IDF",
  "why don’t fish play basketball? they’re afraid of the net.",
  "what do you call a fish that practices medicine? a sturgeon.",
  "why did the fish blush? because it saw the ocean’s bottom.",
  "how do fish get to school? on the octobus.",
  "what’s a fish’s favorite instrument? the bass guitar.",
  "why don’t fish like computers? they’re scared of the net.",
  "what did the fish say when it hit a concrete wall? dam!",
  "why was the fish bad at tennis? he kept getting caught in the net.",
  "what do you call a fish wearing a bowtie? sofishticated.",
  "why did the fish get kicked out of school? he was caught with seaweed.",
  "what’s a fish’s favorite movie? the codfather.",
  "how do shellfish get to the hospital? in a clambulance.",
  "why don’t fish do well on tests? they’re always swimming below sea level.",
  "what do fish take to stay healthy? vitamin sea.",
  "why was the fish arrested? for fin-slapping someone.",
  "what’s a fish’s favorite country? finland.",
  "why are fish so smart? because they swim in schools.",
  "what did the fish say when it swam into a wall? dam!",
  "how do fish stay in touch? they drop each other a line.",
  "why don’t fish use social media? they don’t want to get caught in the net.",
  "what do you call a lazy crayfish? a slobster.",
  "why did the fish start a band? he had the scales.",
  "what’s a fish’s favorite karaoke song? “don’t stop beleiving” by journey… but mostly the bass line.",
  "why was the fish always calm? he just went with the flow.",
  "what do you call a fish magician? a magic carp.",
  "why don’t fish play soccer? they’re afraid of the net.",
  "what did the sardine say to the submarine? you’re krilling me!",
  "why did the vegan go fishing? just for the halibut.",
  "what’s the richest fish in the sea? a goldfish.",
  "how do fish pay for things? with sand dollars.",
  "why was the fish so good at basketball? he was a great shooter… until he got caught in the net.",
  "what do you call a fish with no eyes? fsh.",
  "why did the fish cross the road? to get to the other tide.",
  "what’s a fish’s favorite tv show? tuna half men.",
  "why don’t fish drive? they’d get caught in the carpool lane.",
  "what do you call a dangerous fish that drinks too much? a beeracuda.",
  "why was the octopus laughing? because the sea weed.",
  "what did one fish say to the other during a race? keep your fins crossed!",
  "why don’t fish like fast food? they can’t catch it.",
  "what’s a shark’s favorite game? swallow the leader.",
  "why did the fish go to hollywood? he wanted to be a starfish.",
  "what do fish use to text? shell phones.",
  "I LOVE IKEA",
  "Gale odachi spec when?",
  "I guess this is your sixth or seventh build?",
  "you think this funny i will report no joke",
  "those who 🤣🤣🤣👀👀",
  "promoted by Fishy Business [TRADEMARKED]",
  "hi coded",
  "added new sancho move",
  "quote me on that",
  "did a friced really fry this friced? -vergil",
  "theyre watching us",
  "stay safe out there",
  "shaboingboing - vergil",
  "the snow will shatter - fishboy",
  "if you know then you know if you dont then you dont-naturallycoded",
  "errorHandler: exception found - errors.shop.naturallycoded.buyMessage.PleaseHELP ME NOW SlenderMan is Coming for me HeFortnite Battlepass new -naturallycoded",
   "#revengeseekerz",
   "DontGet2Close",
   "AfflictedDay1(trustt)",
   "the art of losing",
   "Make sure your internet isnt busted, and try again in 5 minutes.",
   "1 in 400,000,000.",
   "tough luck huh? -fishboy",  
    "yeah they have to be gay dude - me",
    "geometry dash is.. something man -fishboy",
    "never ask a fish its weight -fishboy",
    "fishboy is love fishboy is life -naturallycoded",
    "live laugh love tiramisu - katie",
    "ooo you want to make a gale build.... - katie",
    "ooo you want to make a gale build.... - Mon",
    "This is a joe btw",
    "someone please ping @geomatsuu with gif of a shower",
    "My empire is sacred and roman -Mon",
    "Play arcane odyssey",
    "hi - wavi",
    "My bunny is building a bridge",
    "Play Terraria (fuckass common sense)",
    "Mrs Ukraine is a blud",
    "Glory to Flamecharm",
    "deepwokengpt",
    "Dont ask me for access to my enchant -mon",
    "NERF THUNDERCALL 😡😡😡",
    "New years resolution; get a dev spec in DwM",
    "Taxes successfully evaded",
    "Flamecharm? Daring today, aren't we?",
    "Shrine of order? What's that?",
    "Israel gpt, generate me a build...",
    "Who needs an F key when you can run away?",
    "Don't touch the man in the mountains.",
    "please im begging you",
    "THERE IS FORUM FOR BETTER BUILDs",
    "fuckass dread breath",
    "I LOVE IKEA",
    "Gale odachi when?",
    "I guess this is your sixth or seventh build?"


];
    const splashEl = document.getElementById('splash-text');
    if(splashEl) splashEl.innerText = splash[Math.floor(Math.random() * splash.length)];

    const core = document.getElementById('core-inputs');
    const att = document.getElementById('att-inputs');
    if(core) core.innerHTML = ""; 
    if(att) att.innerHTML = "";

    gameData.attributes.forEach(a => {
        userStats[a] = 0;
        core.innerHTML += `
            <div class="stat-row">
                <label onclick="scrollToCategory('${a}')" style="cursor:pointer; transition: color 0.2s;" onmouseover="this.style.color='var(--gold)'" onmouseout="this.style.color='#fff'">
                    ${a}
                </label>
                <input type="number" id="in-${a}" value="0" min="0" max="100" oninput="setStat('${a}', this.value)">
            </div>`;
    });

    gameData.attunements.forEach(a => {
        userStats[a] = 0;
        att.innerHTML += `
            <div class="stat-row">
                <label onclick="scrollToCategory('${a}')" style="cursor:pointer; transition: color 0.2s;" onmouseover="this.style.color='var(--gold)'" onmouseout="this.style.color='#fff'">
                    ${a}
                </label>
                <input type="number" id="in-${a}" value="0" min="0" max="100" oninput="setStat('${a}', this.value)">
            </div>`;
    });

    
    const params = new URLSearchParams(window.location.search);
    
    
    loadSavedTheme();

    
    if (params.has('id')) {
        const binId = params.get('id');
        fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, {
            headers: { 'X-Master-Key': JSONBIN_KEY }
        })
        .then(res => res.json())
        .then(data => {
            loadBuildFromString(data.record.build);
        })
        .catch(err => console.error("Error loading short build:", err));
    } 
    else if (params.has('b')) {
        loadBuildFromString(params.get('b'));
    }
    updateUI();
    loadSavedTheme();
}
function getWeaponSubCategory(wName, type) {
    const n = wName.toLowerCase();
    
    // LIGHT
    if (type === "Light Weapon") {
        if (n.includes("fist") || n.includes("jus karita") || n.includes("cestus") || n.includes("wrap") || n.includes("style") || n.includes("way")) return "Fist";
        if (n.includes("rapier") || n.includes("needle") || n.includes("stiletto") || n.includes("fleuret")) return "Rapier";
        if (n.includes("dagger") || n.includes("knife") || n.includes("shiv") || n.includes("shank")) return "Dagger";
        return "Dagger"; 
    }
    // MEDIUM
    if (type === "Medium Weapon") {
        if (n.includes("rifle") || n.includes("dragoon") || n.includes("gun") || n.includes("pistol")) return "Rifle";
        if (n.includes("spear") || n.includes("trident") || n.includes("glaive") || n.includes("halberd") || n.includes("naginta") || n.includes("lance")) return "Spear";
        if (n.includes("club") || n.includes("mace") || n.includes("hammer") && !type.includes("Heavy")) return "Club";
        return "Sword"; 
    }
    // HEAVY
    if (type === "Heavy Weapon") {
        if (n.includes("greataxe") || n.includes("axe") || n.includes("scythe") || n.includes("reaper") || n.includes("halberd")) return "GreatAxe";
        if (n.includes("greathammer") || n.includes("maul") || n.includes("hammer") || n.includes("anchor")) return "GreatHammer";
        return "GreatSword"; 
    }
    return "Other";
}
function loadBuildFromString(code) {
    try {
        const sections = code.split('_');
        
        
        if (sections[0]) {
            const statsArr = sections[0].split('.');
            allStatKeys.forEach((key, i) => {
                let val = parseInt(statsArr[i]) || 0;
                userStats[key] = val;
                if (document.getElementById('in-' + key)) document.getElementById('in-' + key).value = val;
            });
        }
        
        if (sections[1]) {
            sections[1].split('-').forEach(b36 => {
                let name = talentMap[parseInt(b36, 36)];
                if (name) selectedTalents.add(name);
            });
        }
        
        if (sections[2]) {
            selectedMantras = []; 
            sections[2].split('-').forEach(entry => {
                if(entry.includes(':')) {
                    // New format: Name:Gem
                    let parts = entry.split(':');
                    let name = mantraMap[parseInt(parts[0], 36)];
                    let gem = deepGemList[parseInt(parts[1], 36)] || "No Gem";
                    if(name) selectedMantras.push({ name, gem });
                } else {
                    // Legacy support
                    let name = mantraMap[parseInt(entry, 36)];
                    if (name) selectedMantras.push({ name: name, gem: "No Gem" });
                }
            });
        }
        
        if (sections[3]) {
            const tVals = sections[3].split('.');
            const tKeys = Object.keys(userTraits);
            tVals.forEach((v, i) => {
                let n = parseInt(v) || 0;
                userTraits[tKeys[i]] = n;
                if (document.getElementById('trait-' + tKeys[i])) document.getElementById('trait-' + tKeys[i]).value = n;
            });
            let total = Object.values(userTraits).reduce((a, b) => a + b, 0);
            document.getElementById('trait-sum').innerText = total;
        }
        
        if (sections[4]) {
            selectedOath = sections[4];
            document.getElementById('oath-select').value = selectedOath;
        }
        
        if (sections[5] && sections[5] !== "x") {
            const wIdx = parseInt(sections[5], 36);
            selectedWeapon = gameData.weapons[wIdx];
        }
        
        if (sections[6] && sections[6] !== "x") {
            const eIdx = parseInt(sections[6], 36);
            selectedEnchant = gameData.enchants[eIdx];
        }
        
        if (sections[7]) {
            activeBuffs = new Set(sections[7].split('.').filter(x => x));
        }
        
        if (sections[8]) {
            userNotes = atob(sections[8]);
        }

        updateUI();
    } catch (e) { console.error("Load Error", e); }
}
function exportBuildText() {
    const s = userStats;
    const t = userTraits;
    
    
    const attMap = {
        "Flamecharm": "FLM", "Frostdraw": "ICE", "Thundercall": "LTN",
        "Shadowcast": "SHD", "Galebreathe": "WND", "Ironsing": "IRN",
        "Bloodrend": "BLD", "Earthbend": "ERT"
    };

    let text = `===== LVL 80 Heliodar, Castaway, ${selectedOath || "No Oath"} =====\n`;
    
    
    text += `== ATTRIBUTES ==\n`;
    text += `${s["Strength"] || 0} STR; ${s["Precision"] || 0} PRC; ${s["Fortitude"] || 0} FTD; `;
    text += `${s["Agility"] || 0} AGL; ${s["Intelligence"] || 0} INT; ${s["Willpower"] || 0} WLL; ${s["Charisma"] || 0} CHA\n`;
    text += `=====\n`;
    
    
    text += `${s["Heavy Weapon"] || 0} HVY; ${s["Medium Weapon"] || 0} MED; ${s["Light Weapon"] || 0} LHT\n`;
    
    
    text += `== ATTUNEMENTS ==\n`;
    let activeAtts = [];
    gameData.attunements.forEach(a => {
        if (s[a] > 0) activeAtts.push(`${s[a]} ${attMap[a]}`);
    });
    text += activeAtts.join('; ') + `\n`;

    
    text += `== MANTRAS ==\n`;
    selectedMantras.forEach(m => text += `${m}\n`);

    
    text += `\n== TALENTS ==\n`;
    selectedTalents.forEach(talent => text += `${talent}\n`);

    
    text += `\n== Traits ==\n`;
    text += `${t.Vitality} Vitality\n`;
    text += `${t.Erudition} Erudition\n`;
    text += `${t.Proficiency} Proficiency\n`;
    text += `${t.Songchant} Songchant`;

    
    navigator.clipboard.writeText(text).then(() => {
        alert("Build Text Copied! You can now paste it into Discord or a notepad.");
    });
}

function setTrait(trait, val) {
    let n = parseInt(val) || 0;
    let sumOthers = Object.keys(userTraits).reduce((acc, key) => {
        return key === trait ? acc : acc + userTraits[key];
    }, 0);

    if (n < 0) n = 0;
    if (n > 6) n = 6;
    if (sumOthers + n > 12) n = 12 - sumOthers;

    userTraits[trait] = n; 
    document.getElementById('trait-' + trait).value = n;
    document.getElementById('trait-sum').innerText = sumOthers + n;
    
    updateUI(); 
}

function setOath(val) {
    selectedOath = val;
    updateUI();
}
function setStat(name, val) {
    let num = parseInt(val);
    if (isNaN(num)) num = 0;
    
    
    let clamped = Math.min(100, Math.max(0, num));
    userStats[name] = clamped;

    
    if (num !== clamped) {
        document.getElementById('in-' + name).value = clamped;
    }

    updateUI();
}

function updateUI() {
    let count = 0; 
    gameData.attunements.forEach(a => { if (userStats[a] > 0) count++; });
    let max = count === 0 ? 410 : 420 + Math.max(0, (count - 1) * 5);
    let used = 0; 
    Object.values(userStats).forEach(v => used += v);

    document.getElementById('max-pts').innerText = max;
    const usedPtsEl = document.getElementById('used-pts');
    usedPtsEl.innerText = used;
    usedPtsEl.style.color = used > max ? "#ff4444" : "#fff";
    document.getElementById('talent-count').innerText = selectedTalents.size;

    const list = document.getElementById('selection-list');
    if(list) {
        list.innerHTML = ""; 

        
        if(selectedOath) {
            list.innerHTML += `<div style="padding:10px; border-bottom:2px solid #000; font-weight:bold; color:var(--gold); font-size: 1.2rem; text-align:center;">${selectedOath.toUpperCase()}</div>`;
        }

        
       if(selectedWeapon) {
            const { normalDmg, buffedDmg, mult } = getWeaponStats(selectedWeapon);
            let dmgDisplay = mult > 1 
                ? `<span style="text-decoration: line-through; color: #666; font-size: 0.9rem;">${normalDmg}</span> <span style="color: #8b0000;">${buffedDmg} DMG</span>`
                : `<span style="color: #8b0000;">${normalDmg} DMG</span>`;

            list.innerHTML += `
                <div style="padding:15px; border-top:1px solid rgba(0,0,0,0.1); border-bottom:1px solid rgba(0,0,0,0.1); background: rgba(0,0,0,0.03); margin-bottom:10px;">
                    <div style="font-weight:bold; color:var(--gold); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px;">EQUIPPED WEAPON</div>
                    <div style="font-size:1.1rem; font-weight:bold; color:#000;">${selectedWeapon.name}</div>
                    <div style="font-size:0.85rem; color:#555; font-style:italic;">Enchant: ${selectedEnchant || 'None'}</div>
                    <div style="font-size:1.3rem; font-weight:bold; margin-top:5px;">${dmgDisplay}</div>
                </div>`;
        }

        
        if(selectedTalents.size > 0) {
            list.innerHTML += `<div style="padding:10px; border-bottom:1px solid #000; font-weight:bold;">Talents (${selectedTalents.size})</div>`;
            selectedTalents.forEach(t => list.innerHTML += `<div style="padding:4px 15px; font-size:0.9rem;">• ${t}</div>`);
        }

        
         if(selectedMantras.length > 0) {
        list.innerHTML += `<div style="padding:10px; border-bottom:1px solid #000; font-weight:bold; color:#2266aa; margin-top:10px;">Mantras</div>`;
        
       // Inside updateUI...
selectedMantras.forEach((mObj, index) => {
    let gemOpts = deepGemList.map(g => `<option value="${g}" ${mObj.gem === g ? 'selected' : ''}>${g}</option>`).join('');

    list.innerHTML += `
    <div style="padding:8px 10px; border-bottom:1px dashed #333; background:rgba(0,0,0,0.1);">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <span style="color:#2266aa; font-weight:bold;">${mObj.name}</span>
            
            <!-- THIS IS THE FIXED BUTTON LINE BELOW: -->
            <button onclick="removeMantraByIndex(${index})" style="color:red; background:none; border:none; cursor:pointer; font-weight:bold; font-size: 1.2rem;">&times;</button>
        </div>
        
        <div style="margin-top:5px;">
            <label style="font-size:0.7rem; color:#666;">Gem:</label>
            <select onchange="updateMantraGem(${index}, this.value)" style="width:100%; font-size:0.8rem; background:#000; color:#fff; border:1px solid #444;">
                ${gemOpts}
            </select>
        </div>
    </div>`;
});
    }
    renderItems();
}
}
function updateMantraGem(index, value) {
    if(selectedMantras[index]) {
        selectedMantras[index].gem = value;
    }
}
function updateMantraMod(index, type, value) {
    if(selectedMantras[index]) {
        selectedMantras[index][type] = value;
    }
}
function checkReqs(reqObj) {
    if (!reqObj || Object.keys(reqObj).length === 0) return true;

    for (let r in reqObj) {
        let reqValue = reqObj[r];
        
        // 1. Check for "Any Weapon" 
        if (r === "OR_Weapon" || r === "Weapon") {
            const val = Math.max(userStats["Light Weapon"]||0, userStats["Medium Weapon"]||0, userStats["Heavy Weapon"]||0);
            if (val < reqValue) return false;
        } 
        
        // 2. Check for "Any Attunement"
        else if (r === "OR_Attunement" || r === "Elemental") {
            const val = Math.max(...gameData.attunements.map(a => userStats[a]||0));
            if (val < reqValue) return false;
        }

        
        // some bullshit checks
        else if (r === "MedOrHeavy") {
            const med = userStats["Medium Weapon"] || 0;
            const hvy = userStats["Heavy Weapon"] || 0;
            if (Math.max(med, hvy) < reqValue) return false;
        }
        else if (r === "MedOrLight") {
            const med = userStats["Medium Weapon"] || 0;
            const Light = userStats["Light Weapon"] || 0;
            if (Math.max(med, Light) < reqValue) return false;
        }
        else if (r === "LightOrHeavy") {
            const Light = userStats["Light Weapon"] || 0;
            const hvy = userStats["Heavy Weapon"] || 0;
            if (Math.max(Light, hvy) < reqValue) return false;
        }
        
        
        // 3. Standard Checks (Specific stats)
        else if (r === "Light") { if ((userStats["Light Weapon"]||0) < reqValue) return false; }
        else if (r === "Medium") { if ((userStats["Medium Weapon"]||0) < reqValue) return false; }
        else if (r === "Heavy") { if ((userStats["Heavy Weapon"]||0) < reqValue) return false; }
        
        else {
            if ((userStats[r] || 0) < reqValue) return false;
        }
    }
    return true;
}

function toggleItem(name, met) {
    if (!met) return;

    if (currentTab === 'talents') {
        if (!selectedTalents.has(name)) {
            if (selectedTalents.size >= 80) return alert("Max 80 talents!");
            
            // Mutual exclusion check
             for (const group of mutualExclusions) {
                if (group.includes(name)) {
                    for (const other of group) {
                        if (other !== name && selectedTalents.has(other)) {
                            alert(`CONFLICT: You cannot have "${name}" while you have "${other}".`);
                            return;
                        }
                    }
                }
            }
            selectedTalents.add(name);
        } else {
            selectedTalents.delete(name);
        }
    } else {
        // MANTRA LOGIC (Gems Only)
        const existingIdx = selectedMantras.findIndex(m => m.name === name);
        if (existingIdx === -1) {
            // Add new mantra with default Gem (No Spark)
            selectedMantras.push({ 
                name: name, 
                gem: "No Gem" 
            });
        } else {
            // Remove mantra
            selectedMantras.splice(existingIdx, 1);
        }
    }
    updateUI();
}

let cachedPosts = [];

function renderSummaryTab() {
    const container = document.getElementById('item-container');
    
    
    let totalHP = 360;
    let ftdBonus = Math.min(Math.floor((userStats["Fortitude"] || 0) / 5) * 5, 50);
    let vitBonus = (userTraits["Vitality"] || 0) * 10;
    let talentHP = 0;
    selectedTalents.forEach(n => { if(hpTalentMap[n]) talentHP += hpTalentMap[n]; });
    totalHP += ftdBonus + vitBonus + talentHP;

    let weaponPts = 0; let mantraPts = 0; let totalPen = 0;
    [...selectedTalents, ...selectedMantras].forEach(name => {
        const effect = effectMap[name];
        if (effect) {
            if (effect.t === 'w') weaponPts += effect.v;
            else if (effect.t === 'm') mantraPts += effect.v;
            else if (effect.t === 'u') { weaponPts += effect.v; mantraPts += effect.v; }
            else if (effect.t === 'p') totalPen += effect.v;
        }
    });

    
    container.innerHTML = `
        <div class="calc-wrapper" style="max-width: 800px;">
            <div style="margin-bottom: 20px;">
                <label style="font-weight:bold; font-size:0.8rem;">BUILD NAME</label>
                <input type="text" id="build-name-input" 
                    style="width: 100%; padding: 10px; font-family: 'Lora'; font-size: 1.2rem;" 
                    placeholder="e.g. 1 cycle godseeker build" 
                    value="${window.buildName || ''}" 
                    oninput="window.buildName = this.value">
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div style="background: rgba(0,0,0,0.05); padding: 15px; border: 1px solid rgba(0,0,0,0.1);">
                    <h3 style="margin:0; color:#8b0000;">${totalHP} HP</h3>
                    <div style="font-size: 0.8rem; color: #666;">Base: 360 | FTD: +${ftdBonus} | VIT: +${vitBonus} | Talents: +${talentHP}</div>
                </div>
                <div style="background: rgba(0,0,0,0.05); padding: 15px; border: 1px solid rgba(0,0,0,0.1);">
                     <h3 style="margin:0; color:var(--gold);">OFFENSE</h3>
                     <div style="font-size:0.8rem;">Wep: ${(1 + Math.min(0.25, weaponPts/100)).toFixed(2)}x | Mantra: ${(1 + Math.min(0.25, mantraPts/100)).toFixed(2)}x | Pen: ${totalPen}%</div>
                </div>
            </div>

            <div style="margin-top: 20px;">
                <label style="font-weight:bold;">DESCRIPTION / NOTES</label>
                <textarea id="build-notes" 
                    style="width: 100%; height: 100px; padding: 10px; font-family: 'Lora';" 
                    placeholder="Write your notes here..."
                    oninput="saveNotes(this.value)">${userNotes}</textarea>
            </div>

            <hr style="border: 2px solid #000; margin: 30px 0;">

            <!-- REMOVED USER BAR FROM HERE -->
            
            <div style="text-align:center; font-style:italic; color:#666; margin-top:20px;">
                To view or post builds, go to the <b>COMMUNITY</b> tab.
            </div>
        </div>
    `;
}


function renderUserBar() {
    if (!currentUser) {
        return `
            <div class="user-bar" style="justify-content:center; text-align:center;">
                <div style="margin-bottom:5px;">Join the Community to post & vote!</div>
                <button class="auth-btn" onclick="openAuthModal()">LOG IN / SIGN UP</button>
            </div>
        `;
    }
    
    
    let adminBtn = "";
    if (currentAdmin) {
        adminBtn = `<button class="auth-btn" style="background:#333; border:1px solid #555; margin-right:10px;" onclick="adminPanel()">ADMIN</button>`;
    }

    return `
        <div class="user-bar">
            <div class="user-info">
                <img src="${currentUser.photoURL || 'https://i.imgur.com/6U68bgZ.png'}" class="user-pfp">
                <div class="user-text">
                    <span class="user-name">${currentUser.displayName}</span>
                    <span class="user-status">Logged In ${currentAdmin ? '<b style="color:red">[ADMIN]</b>' : ''}</span>
                </div>
            </div>
            <div>
                ${adminBtn}
                <button class="auth-btn" onclick="logout()">LOG OFF</button>
            </div>
        </div>
    `;
}


function saveNotes(val) {
    userNotes = val;
}

function renderItems() {
    const container = document.getElementById('item-container');
    if (!container) return;
    if (currentTab === 'calc') { renderCalculator(); return; } 
    if (currentTab === 'weapons') { renderWeapons(); return; }
    if (currentTab === 'hp') { renderHPTab(); return; }
    if (currentTab === 'summary') { renderSummaryTab(); return; }
    if (currentTab === 'guide') { renderGuide(); return; }

    let search = document.getElementById('search-input').value.toLowerCase().trim();
    const showMet = document.getElementById('filter-reqs').checked;
    const dataSet = currentTab === 'talents' ? gameData.talents : gameData.mantras;
    let selectedSet;
if (currentTab === 'talents') {
    selectedSet = selectedTalents;
} else {
    // Create a temporary Set of names just for checking highlighting class
    selectedSet = new Set(selectedMantras.map(m => m.name));
}

    
    let filterStat = null, filterOp = null, filterVal = null;
    const match = search.match(/^([a-z]+)\s*([>=<])\s*(\d+)$/);
    if (match) {
        filterStat = statShorthand[match[1]] || null;
        filterOp = match[2];
        filterVal = parseInt(match[3]);
    }

    container.innerHTML = "";
    for (let cat in dataSet) {
        const isCollapsed = collapsedCats.has(cat);
        let hasItems = false;
        let catHtml = `<div id="scroll-cat-${cat.replace(/\s/g, '')}" class="category-block ${isCollapsed ? 'collapsed' : ''}"><div class="category-title" onclick="toggleCategory('${cat}')">${cat}</div><div class="grid">`;
        
        dataSet[cat].forEach((item, idx) => {
            let met = checkReqs(item.req);
            if (showMet && !met) return;

            let matchesSearch = false;
            if (filterStat) {
                
                let reqVal = item.req[filterStat] || 0;
                if (filterOp === '>') matchesSearch = reqVal > filterVal;
                else if (filterOp === '<') matchesSearch = reqVal < filterVal;
                else if (filterOp === '=') matchesSearch = reqVal === filterVal;
            } else {
                matchesSearch = item.name.toLowerCase().includes(search) || item.desc.toLowerCase().includes(search);
            }

            if (matchesSearch) {
                
                hasItems = true;
                let safeId = cat.replace(/\s/g, '') + idx;
                let escapedName = item.name.replace(/'/g, "\\'");
                let reqFormatted = Object.entries(item.req).map(([k, v]) => {
                    let label = k;
                    if (k === "OR_Weapon" || k === "Weapon") label = "Any Weapon";
                    if (k === "OR_Attunement" || k === "Elemental") label = "Any Attunement";
                    return `${label}: ${v}`;
                }).join(", ");

                catHtml += `
    <div class="card ${met ? '' : 'locked'} ${selectedSet.has(item.name) ? 'selected' : ''}" 
         onclick="toggleItem('${escapedName}', ${met})">
        <h3>${item.name}</h3><p>${item.desc}</p><hr>
        <span class="req-text"><span style="color:#fff">Req:</span> ${reqFormatted || 'None'}</span>
        
        <!-- AUTO INVEST BUTTON -->
        ${!met && Object.keys(item.req).length > 0 ? 
            `<button class="auto-stat-btn" onclick="autoInvest('${escapedName}', '${cat}', event)">Auto-Invest Stats</button>` 
            : ''}

        ${item.gif ? `<button class="toggle-gif-btn" onclick="toggleGif('${safeId}', event)">Preview</button><div class="gif-container" id="gif-${safeId}"><img src="${item.gif}" loading="lazy"></div>` : ''}
    </div>`;
            }
        });
        if (hasItems) container.innerHTML += catHtml + `</div></div>`;
    }
}
function scrollToCategory(catName) {
    if (currentTab !== 'talents' && currentTab !== 'mantras') {
        switchTab('talents');
    }

    setTimeout(() => {
        const safeId = 'scroll-cat-' + catName.replace(/\s/g, '');
        const element = document.getElementById(safeId);
        const container = document.getElementById('item-container');

        if (element && container) {
            
            if (collapsedCats.has(catName)) {
                toggleCategory(catName);
            }
            
            
            element.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }, 50);
}
function renderCalculator() {
    const container = document.getElementById('item-container');
    let html = `<div class="calc-wrapper"><div class="calc-row" style="border-bottom:2px solid #000; justify-content:center; text-transform:uppercase;">Stat Modifiers</div>`;
    calcData.dmg.forEach((b, i) => {
        html += `<div class="calc-row"><label for="d${i}">${b.n} <span>${b.v}% DMG</span></label><input type="checkbox" id="d${i}" ${activeBuffs.has('d'+i)?'checked':''} onchange="toggleBuff('d${i}')"></div>`;
    });
    html += `<div class="calc-row" style="margin-top:20px; border-bottom:2px solid #000; justify-content:center; text-transform:uppercase;">Penetration</div>`;
    calcData.pen.forEach((b, i) => {
        html += `<div class="calc-row"><label for="p${i}">${b.n} <span>${b.v}% PEN</span></label><input type="checkbox" id="p${i}" ${activeBuffs.has('p'+i)?'checked':''} onchange="toggleBuff('p${i}')"></div>`;
    });

    let wPct = 0, mPct = 0, pen = 0;
    activeBuffs.forEach(key => {
        let idx = parseInt(key.slice(1));
        if(key[0]==='d') {
            let b = calcData.dmg[idx];
            if(b.cat.includes('UB') || b.cat.includes('WB')) wPct += b.v;
            if(b.cat.includes('UB') || b.cat.includes('MB')) mPct += b.v;
        } else pen += calcData.pen[idx].v;
    });

    const cap = (p) => {
        let m = 1 + (p/100);
        if(m > 1.25) m = 1.25 + (m-1.25)/2;
        return Math.min(1.5, m).toFixed(3);
    };

    html += `<div class="calc-result-box">
        <strong>Weapon Multiplier:</strong> ${cap(wPct)}x<br>
        <strong>Mantra Multiplier:</strong> ${cap(mPct)}x<br>
        <strong>Total Penetration:</strong> ${pen}%
    </div></div>`;
    container.innerHTML = html;
}

function renderHPTab() {
    const container = document.getElementById('item-container');
    
    
    let totalHP = 360;
    
    
    let ftd = userStats["Fortitude"] || 0;
    let ftdBonus = Math.min(Math.floor(ftd / 5) * 5, 50);
    
    
    let vitBonus = (userTraits["Vitality"] || 0) * 10;
    
    
    let talentHP = 0;
    let talentListHTML = "";
    
    selectedTalents.forEach(name => {
        if (hpTalentMap[name]) {
            talentHP += hpTalentMap[name];
            talentListHTML += `<div class="calc-row"><span>${name}</span> <b>+${hpTalentMap[name]} HP</b></div>`;
        }
    });

    totalHP += ftdBonus + vitBonus + talentHP;

    container.innerHTML = `
        <div class="calc-wrapper">
            <h2 style="text-align:center; color:#000;">HP BREAKDOWN</h2>
            <div class="calc-row"><span>Base HP</span> <b>360</b></div>
            <div class="calc-row"><span>Fortitude Bonus (Cap 50)</span> <b>+${ftdBonus}</b></div>
            <div class="calc-row"><span>Vitality Trait Bonus</span> <b>+${vitBonus}</b></div>
            <hr style="border:1px dotted #000">
            <div style="margin: 10px 0; font-weight: bold; color: var(--gold);">Talent Bonuses:</div>
            ${talentListHTML || '<div style="font-style:italic; color:#666;">No HP talents selected.</div>'}
            <hr style="border:1px solid #000">
            <div class="calc-row" style="font-size: 1.5rem;">
                <span>TOTAL HEALTH</span>
                <b style="color: #8b0000;">${totalHP} HP</b>
            </div>
        </div>
    `;
}

function renderGuide() {
    const container = document.getElementById('item-container');
    container.innerHTML = `
        <div class="calc-wrapper" style="max-width: 800px; line-height: 1.6;">
            <h1 style="text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px;">BUILDER HANDBOOK</h1>
            
            <h3 style="color: #8b0000; border-bottom: 1px dotted #000;">1. Advanced Stat Searching</h3>
            <p>You can search for talents based on their requirements using shorthand commands. Type these into the search bar:</p>
            <ul style="background: rgba(0,0,0,0.05); padding: 15px; border-radius: 5px; list-style: none;">
                <li><code>fort=40</code> - Shows talents requiring exactly 40 Fortitude (like Exoskeleton).</li>
                <li><code>str>50</code> - Shows all Strength talents requiring more than 50.</li>
                <li><code>agi<25</code> - Shows low-requirement Agility talents.</li>
            </ul>
            <p><strong>Shorthands:</strong> str, fort, agi, int, will, cha, pre, light, med, heavy, flame, frost, thunder, shadow, gale, iron, blood, earth.</p>

            <h3 style="color: #8b0000; border-bottom: 1px dotted #000; margin-top: 20px;">2. Talent Limits</h3>
            <p>The builder tracks your investment. You are limited to <strong>80 Talents</strong> total. If you reach the cap, the builder will prevent you from selecting more until you deselect one.</p>

            <h3 style="color: #8b0000; border-bottom: 1px dotted #000; margin-top: 20px;">3. Sharing Your Build</h3>
            <p>Once your stats, talents, and mantras are selected, click the <strong>"SHARE BUILD LINK"</strong> button in the left sidebar. This copies a unique URL to your clipboard that you can send to others; it will load your exact build instantly.</p>

            <h3 style="color: #8b0000; border-bottom: 1px dotted #000; margin-top: 20px;">4. Damage Calculator</h3>
            <p>Your dmg and hp show up on <strong>Summary</strong> tab. Note that dmg multipliers have a "soft cap" (diminishing returns) just like in-game.</p>

            <h3 style="color: #8b0000; border-bottom: 1px dotted #000; margin-top: 20px;">5. General game info</h3>
          <div style="margin-bottom: 15px;">
                <strong>1. Leaderboard Titles</strong> 
                <p style="margin: 5px 0 0 15px;">You might see people with custom titles or colored names. You can get a custom title by winning hosted events. Colored names are P2W (contact devs with payment).</p>
            </div>

            <div style="margin-bottom: 15px;">
                <strong>2. Custom Clothes (CC)</strong>
                <p style="margin: 5px 0 0 15px;">Buy the CC gamepass OR purchase it from the <b>Blacksmith</b> for 250k notes. (Rejoin to apply, the obtainable verison only saves on one slot. The gamepass verison applys to all slots if you want).</p>
            </div>

            <div style="margin-bottom: 15px;">
                <strong>3. Ukiels Blessing</strong>
                <p style="margin: 5px 0 0 15px;">there is a npc where it just gives you aura whenever you use a mantra (yea deadass), it costs 15 knowledge.</p>
            </div>
            
            <div style="border-top: 2px solid #000; margin-top: 40px; padding-top: 20px; background: rgba(0,0,0,0.03); border-radius: 5px; padding: 20px;">
                <h2 style="text-align: center; margin-top: 0; text-transform: uppercase; font-size: 1.2rem; letter-spacing: 2px;">Credits</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 0.9rem;">
                    <div>
                        <strong>web dev:</strong><br>
                        taxes (@faithandpray)
                    </div>
                    <div>
                        <strong>non-chest Weapon lister + splash text:</strong><br>
                        DayB/Lav (@lz4decompress)
                    </div>
                    <div>
                        <strong>Chest Weapon lister:</strong><br>
                        cid (@ohnycidlverhand)
                    </div>
                    <div>
                        <strong>limited weapon lister:</strong><br>
                        Vergil (@pixelv4)
                    </div>
                    <div>
                        <strong>Mantra gif supplys:</strong><br>
                        DWM devs + wiki team
                    </div>
                </div>
                <p style="text-align: center; font-style: italic; margin-top: 20px; opacity: 0.6; font-size: 0.8rem; border-top: 1px solid rgba(0,0,0,0.1); padding-top: 10px;">
                    "ping for any broken stuff"
                </p>
            </div>
        </div>
    `;
}
    const statMap = {
        "hvy": "Heavy Weapon", "med": "Medium Weapon", "light": "Light Weapon",
        "str": "Strength", "fort": "Fortitude", "agi": "Agility", 
        "int": "Intelligence", "will": "Willpower", "cha": "Charisma", "charisma": "Charisma",
        "pre": "Precision", "prec": "Precision", "precision": "Precision",
        "flame": "Flamecharm", "frost": "Frostdraw", "thunder": "Thundercall",
        "shadow": "Shadowcast", "gale": "Galebreathe", "iron": "Ironsing",
        "blood": "Bloodrend", "earth": "Earthbend"
    };
   

function autoInvest(name, cat, event) {
    event.stopPropagation(); 

    const dataSet = currentTab === 'talents' ? gameData.talents : gameData.mantras;
    const item = dataSet[cat].find(i => i.name === name);
    if (!item || !item.req) return;

    let statsToUpdate = {};
    let totalPointsNeeded = 0;

    
    for (let reqKey in item.req) {
        let targetVal = item.req[reqKey];
        let actualStatKey = reqKey;

        
        if (reqKey === "Weapon" || reqKey === "OR_Weapon") {
            
            actualStatKey = ["Light Weapon", "Medium Weapon", "Heavy Weapon"].reduce((a, b) => 
                (userStats[a] || 0) >= (userStats[b] || 0) ? a : b
            );
        } 
        
        else if (reqKey === "Elemental" || reqKey === "OR_Attunement") {
            actualStatKey = gameData.attunements.reduce((a, b) => 
                (userStats[a] || 0) >= (userStats[b] || 0) ? a : b
            );
        }
        
        else if (reqKey === "Light") actualStatKey = "Light Weapon";
        else if (reqKey === "Medium") actualStatKey = "Medium Weapon";
        else if (reqKey === "Heavy") actualStatKey = "Heavy Weapon";

        if ((userStats[actualStatKey] || 0) < targetVal) {
            statsToUpdate[actualStatKey] = targetVal;
            totalPointsNeeded += (targetVal - (userStats[actualStatKey] || 0));
        }
    }

    
    let currentAttCount = 0; 
    gameData.attunements.forEach(a => { if (userStats[a] > 0) currentAttCount++; });
    let maxPts = currentAttCount === 0 ? 410 : 420 + Math.max(0, (currentAttCount - 1) * 5);
    
    let currentUsed = 0; 
    Object.values(userStats).forEach(v => currentUsed += v);

    if (currentUsed + totalPointsNeeded > maxPts) {
        alert(`Cannot auto-invest. You need ${totalPointsNeeded} points, but you only have ${maxPts - currentUsed} points left in your cap.`);
        return;
    }

    
    for (let statKey in statsToUpdate) {
        userStats[statKey] = statsToUpdate[statKey];
        
        const inputEl = document.getElementById('in-' + statKey);
        if (inputEl) inputEl.value = statsToUpdate[statKey];
    }

    
    updateUI();
}
function getCurrentDmgMultiplier() {
    let wPct = 0;
    if (!calcData || !calcData.dmg) return 1;
    activeBuffs.forEach(key => {
        if (key[0] === 'd') {
            let idx = parseInt(key.slice(1));
            let b = calcData.dmg[idx];
            if (b && (b.cat.includes('UB') || b.cat.includes('WB'))) wPct += b.v;
        }
    });
    let multiplier = 1 + (wPct / 100);
    if (multiplier > 1.25) multiplier = 1.25 + (multiplier - 1.25) / 2;
    return Math.min(1.5, multiplier);
}
function getWeaponStats(w) {
    let totalScalingValue = 0;
    let scalingText = [];
    
    // 1. Calculate Scaling
    for (let rawStat in w.scaling) {
        let stat = rawStat.charAt(0).toUpperCase() + rawStat.slice(1);
        if (stat === "Light" || stat === "Medium" || stat === "Heavy") stat += " Weapon";
        
        let userStatVal = userStats[stat] || 0;
        totalScalingValue += (w.scaling[rawStat] * (userStatVal / 100));
        scalingText.push(`${stat}: ${w.scaling[rawStat]}`);
    }

    // 2. Physical Damage (Base + Scaling)
    let normalDmg = parseFloat((w.base * (1 + (0.10425 * totalScalingValue))).toFixed(2));
    
    // 3. Bleed Calculation (Formula: ScaledDamage * 1.15)
    let bleedDmg = 0;
    if (w.bleed) {
        bleedDmg = parseFloat((normalDmg * 0.15).toFixed(2));
    }

    // 4. Apply Multipliers (Buffs apply to PHYSICAL only, not BLEED)
    let mult = getCurrentDmgMultiplier();
    
    let buffedDmg = parseFloat((normalDmg * mult).toFixed(2)); // Physical gets buffed
    let buffedBleed = bleedDmg; // Bleed stays raw (No Multiplier)

    // 5. New Stats Retrieval
    let swingSpeed = (w.speed !== undefined) ? w.speed : 1.0;
    let range = (w.range !== undefined) ? w.range : 0;
    let pen = (w.pen !== undefined) ? w.pen : 0;
    let chip = (w.chip !== undefined) ? w.chip : 0;

    // 6. DPS Calculation
    // Total Damage per hit is (Buffed Phys + Raw Bleed)
    let totalDamagePerHit = buffedDmg + buffedBleed;
    let dps = parseFloat((totalDamagePerHit * swingSpeed).toFixed(2));

    return { 
        normalDmg, buffedDmg, buffedBleed, 
        swingSpeed, range, pen, chip, dps, 
        mult, scalingText 
    };
}


function selectWeaponByIndex(index) {
    const weapon = gameData.weapons[index];
    if (weapon) {
        selectedWeapon = weapon;
        updateUI();
    }
}
function getWeaponSubCategory(wName, type) {
    const n = wName.toLowerCase();
    
    // LIGHT WEAPONS
    if (type === "Light Weapon") {
        if (n.includes("fist") || n.includes("jus karita") || n.includes("cestus") || n.includes("wrap") || n.includes("style") || n.includes("way")) return "Fist";
        if (n.includes("rapier") || n.includes("needle") || n.includes("stiletto") || n.includes("fleuret")) return "Rapier";
        // Default Light
        return "Dagger";
    }
    // MEDIUM WEAPONS
    if (type === "Medium Weapon") {
        if (n.includes("rifle") || n.includes("dragoon") || n.includes("gun") || n.includes("pistol") || n.includes("shot")) return "Rifle";
        if (n.includes("spear") || n.includes("trident") || n.includes("glaive") || n.includes("halberd") || n.includes("naginata") || n.includes("lance")) return "Spear";
        if (n.includes("club") || n.includes("mace") || n.includes("hammer") && !type.includes("Heavy")) return "Club";
        // Default Medium
        return "Sword"; 
    }
    // HEAVY WEAPONS
    if (type === "Heavy Weapon") {
        if (n.includes("greataxe") || n.includes("axe") || n.includes("scythe") || n.includes("reaper")) return "GreatAxe";
        if (n.includes("greathammer") || n.includes("maul") || n.includes("hammer") || n.includes("anchor") || n.includes("crusher")) return "GreatHammer";
        // Default Heavy
        return "GreatSword"; 
    }
    return "Other";
}
function renderWeapons() {
    const container = document.getElementById('item-container');
    if (!gameData.enchants || !gameData.weapons) return;

    // Setup Layout if missing
    if (!document.getElementById('weapon-tab-layout')) {
        container.innerHTML = `
            <div id="weapon-tab-layout" class="calc-wrapper" style="max-width: 900px; background: #e8e7df; color: #1a1a1a; margin: 0 auto;">
                <h2 style="text-align:center; color: #000; margin-bottom: 20px;">Weapon Selection</h2>
                <div style="background: rgba(0,0,0,0.05); padding: 15px; border-radius: 5px; margin-bottom: 20px; border: 1px solid rgba(0,0,0,0.1);">
                    <input type="text" id="weapon-search" placeholder="Search weapons..." oninput="renderWeapons()" 
                           style="width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #999; font-family: 'Lora';">
                    <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                        <label style="font-size: 0.85rem; cursor: pointer; color: #333; font-weight: bold;">
                            <input type="checkbox" id="weapon-filter-reqs" onchange="renderWeapons()"> Show things that fit Requirements
                        </label>
                        <label style="font-size: 0.85rem; cursor: pointer; color: #8b0000; font-weight: bold;">
                            <input type="checkbox" id="weapon-filter-best" onchange="renderWeapons()"> Filter to Top Tier (Dmg/Bleed/DPS)
                        </label>
                    </div>
                </div>
                <div class="stat-row" style="margin-bottom: 20px; justify-content: space-between;">
                    <label style="color: #000; font-weight: bold;">Select Enchant:</label>
                    <select id="enchant-select" onchange="selectEnchant(this.value)" style="width: 200px; background:#fff; color:#000; border: 1px solid #999; padding:5px; font-family:'Lora';">
                        ${gameData.enchants.map(e => `<option value="${e}" ${selectedEnchant === e ? 'selected' : ''}>${e}</option>`).join('')}
                    </select>
                </div>
                <div id="weapon-grid-results" class="grid"></div>
            </div>`;
    }

    let search = document.getElementById('weapon-search').value.toLowerCase();
    let showMet = document.getElementById('weapon-filter-reqs').checked;
    let showBestOnly = document.getElementById('weapon-filter-best').checked;
    let grid = document.getElementById('weapon-grid-results');

    // --- CHAMPION LOGIC ---
    let champions = new Set();
    let anyInvestment = false;
    for (let s in userStats) if(userStats[s] > 0) anyInvestment = true;

    if (anyInvestment) {
        let subCats = {}; 

        gameData.weapons.forEach(w => {
            let manualType = w.type || "Uncategorized";
            
            if (!subCats[manualType]) {
                subCats[manualType] = {
                    phys: { max: -1, weapons: [] },
                    total: { max: -1, weapons: [] },
                    dps: { max: -1, weapons: [] }
                };
            }

            let { buffedDmg, buffedBleed, dps } = getWeaponStats(w);
            let totalDmg = buffedDmg + buffedBleed;

            let meetsReq = true;
            for (let r in w.scaling) {
                let statName = r.charAt(0).toUpperCase() + r.slice(1);
                if (statName === "Light" || statName === "Medium" || statName === "Heavy") statName += " Weapon";
                if ((userStats[statName] || 0) <= 0) { meetsReq = false; break; }
            }

            if(meetsReq) {
                // Phys Winner
                if (buffedDmg > subCats[manualType].phys.max) {
                    subCats[manualType].phys.max = buffedDmg;
                    subCats[manualType].phys.weapons = [w.name];
                } else if (Math.abs(buffedDmg - subCats[manualType].phys.max) < 0.01) {
                    subCats[manualType].phys.weapons.push(w.name);
                }
                // Total Winner
                if (totalDmg > subCats[manualType].total.max) {
                    subCats[manualType].total.max = totalDmg;
                    subCats[manualType].total.weapons = [w.name];
                } else if (Math.abs(totalDmg - subCats[manualType].total.max) < 0.01) {
                    subCats[manualType].total.weapons.push(w.name);
                }
                // DPS Winner
                if (dps > subCats[manualType].dps.max) {
                    subCats[manualType].dps.max = dps;
                    subCats[manualType].dps.weapons = [w.name];
                } else if (Math.abs(dps - subCats[manualType].dps.max) < 0.01) {
                    subCats[manualType].dps.weapons.push(w.name);
                }
            }
        });

        Object.values(subCats).forEach(cat => {
            cat.phys.weapons.forEach(n => champions.add(n));
            cat.total.weapons.forEach(n => champions.add(n));
            cat.dps.weapons.forEach(n => champions.add(n));
        });
    }

    let cardsHtml = "";
    let count = 0;

    gameData.weapons.forEach((w, idx) => {
        const { 
            normalDmg, buffedDmg, buffedBleed, 
            swingSpeed, range, pen, chip, dps, 
            mult, scalingText 
        } = getWeaponStats(w);
        
        let isChampion = champions.has(w.name);
        if (!w.name.toLowerCase().includes(search)) return;
        if (showBestOnly && anyInvestment && !isChampion) return;
        
        let meetsReq = true;
        for (let r in w.scaling) {
            let statName = r.charAt(0).toUpperCase() + r.slice(1);
            if (statName === "Light" || statName === "Medium" || statName === "Heavy") statName += " Weapon";
            if ((userStats[statName] || 0) <= 0) { meetsReq = false; break; }
        }
        if (showMet && !meetsReq) return;
        count++;

        // --- DAMAGE DISPLAY HTML (UPDATED) ---
        let dmgDisplayHTML = "";
        
        if (buffedBleed > 0) {
            // Updated to show "Phys + Bleed" instead of "Total (Phys + Bleed)"
            dmgDisplayHTML = `
                <div class="dmg-value" style="font-size: 1.2rem; color: #8b0000; line-height: 1.1;">
                    ${buffedDmg} <span style="font-size:0.9rem; color:#b22222; font-weight:bold;">+ ${buffedBleed} Bleed</span>
                </div>`;
        } else {
            dmgDisplayHTML = `<div class="dmg-value" style="font-size: 1.3rem; line-height: 1.1;">${buffedDmg} DMG</div>`;
        }

        let typeLabel = w.type || "Uncategorized";
        let badgeHtml = isChampion ? '<div class="best-tag">Top Tier</div>' : '';

        cardsHtml += `
            <div class="weapon-card ${!meetsReq ? 'locked' : ''} ${selectedWeapon && selectedWeapon.name === w.name ? 'selected' : ''} ${isChampion ? 'best-match' : ''}" 
                 onclick="selectWeaponByIndex(${idx})">
                ${badgeHtml}
                
                <h3 style="color:#000; margin-bottom: 2px;">${w.name}</h3>
                <div style="font-size: 0.75rem; color: #444; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">
                    TYPE: ${typeLabel}
                </div>

                <!-- STATS GRID -->
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 2px; margin-bottom: 8px; background: rgba(0,0,0,0.05); padding: 5px; border-radius: 4px; text-align: center;">
                    <div>
                        <span style="display:block; font-size:0.6rem; color:#666;">RANGE</span>
                        <span style="font-weight:bold; font-size:0.8rem; color:#000;">${range}</span>
                    </div>
                    <div>
                        <span style="display:block; font-size:0.6rem; color:#666;">PEN</span>
                        <span style="font-weight:bold; font-size:0.8rem; color:#000;">${pen}%</span>
                    </div>
                    <div>
                        <span style="display:block; font-size:0.6rem; color:#666;">CHIP</span>
                        <span style="font-weight:bold; font-size:0.8rem; color:#000;">${chip}%</span>
                    </div>
                    <div>
                        <span style="display:block; font-size:0.6rem; color:#666;">SPEED</span>
                        <span style="font-weight:bold; font-size:0.8rem; color:#000;">${swingSpeed}x</span>
                    </div>
                </div>

                <p style="font-size: 0.75rem; margin: 5px 0; color:#444;">Scaling: ${scalingText.join(', ')}</p>
                <hr style="border: 0; border-top: 1px solid rgba(0,0,0,0.1);">
                
                <div style="display:flex; justify-content:space-between; align-items:flex-end;">
                    <div>${dmgDisplayHTML}</div>
                    <div style="text-align:right;">
                        <span style="display:block; font-size:0.65rem; color:#666; font-weight:bold;">DPS</span>
                        <span style="font-size: 1.1rem; font-weight:bold; color: #222;">${dps}</span>
                    </div>
                </div>
                
                ${!meetsReq ? '<div style="color: #8b0000; font-size: 0.7rem; font-weight: bold; margin-top: 5px;">⚠️ Missing Stats</div>' : ''}
            </div>`;
    });

    if (count === 0) cardsHtml = `<div style="grid-column: 1/-1; text-align:center; padding: 20px; color: #666;">No weapons found. Try investing stats or clearing the search.</div>`;
    grid.innerHTML = cardsHtml;
}

function removeMantraByIndex(index) {
    selectedMantras.splice(index, 1); // Remove item at specific index
    updateUI(); // Refresh screen
}
function selectWeapon(w) {
    selectedWeapon = w;
    updateUI();
}
function selectWeaponByIndex(index) {
    const weapon = gameData.weapons[index];
    if (weapon) {
        selectedWeapon = weapon;
        updateUI();
    }
}

function selectEnchant(e) {
    selectedEnchant = e;
    updateUI();
}

function changeTheme(themeName) {
    
    const themes = [
        'theme-flame', 'theme-frost', 'theme-gale', 
        'theme-thunder', 'theme-shadow', 'theme-iron', 
        'theme-blood', 'theme-earth'
    ];
    
    
    document.body.classList.remove(...themes);
    
    
    if (themeName !== 'default') {
        document.body.classList.add(themeName);
    }
    
    localStorage.setItem('user-theme', themeName);
}


function loadSavedTheme() {
    const saved = localStorage.getItem('user-theme');
    if (saved) {
        document.getElementById('theme-select').value = saved;
        changeTheme(saved);
    }
}

function switchTab(t) { 
    currentTab = t; 
    
    ['talents','mantras','summary','guide', 'weapons', 'community'].forEach(id => { 
        let el = document.getElementById('tab-'+id); 
        if(el) el.classList.toggle('active', id===t); 
    }); 
    
    let searchBar = document.getElementById('search-bar'); 
    
    
    if(searchBar) {
        
        searchBar.style.display = (t==='summary' || t==='guide' || t==='weapons' || t==='community') ? 'none' : 'block'; 
    }

    document.getElementById('item-container').innerHTML = "";

    
    if (t === 'talents' || t === 'mantras') renderItems();
    else if (t === 'weapons') renderWeapons();
    else if (t === 'summary') renderSummaryTab();
    else if (t === 'community') renderCommunityTab();
    else if (t === 'guide') renderGuide();
     
}
function toggleBuff(id) { activeBuffs.has(id) ? activeBuffs.delete(id) : activeBuffs.add(id); renderCalculator(); }
function toggleCategory(cat) { collapsedCats.has(cat) ? collapsedCats.delete(cat) : collapsedCats.add(cat); renderItems(); }
function toggleGif(id, e) { e.stopPropagation(); const el = document.getElementById('gif-'+id); if(el) el.style.display = el.style.display === 'block' ? 'none' : 'block'; }
function toggleSidebar(s) { document.body.classList.toggle('sidebar-open-'+s); }
function closeSidebars() { document.body.classList.remove('sidebar-open-left', 'sidebar-open-right'); }
function clearBuild() { if(confirm("Clear build?")) window.location.href = window.location.pathname; }

async function saveBuild() {
    const btn = document.querySelector('.action-btn[onclick="saveBuild()"]');
    const originalText = btn.innerText;
    btn.innerText = "GENERATING...";

    
    const traitsPart = Object.values(userTraits).join('.');
    const statsPart = allStatKeys.map(k => userStats[k]||0).join('.');
    const tIndices = Array.from(selectedTalents).map(n => talentMap.indexOf(n).toString(36));
       const mIndices = selectedMantras.map(m => {
        let mIdx = mantraMap.indexOf(m.name);
        let gIdx = deepGemList.indexOf(m.gem);
        return `${mIdx.toString(36)}:${gIdx.toString(36)}`; 
    });
    const wIdx = selectedWeapon ? weaponMap.indexOf(selectedWeapon.name).toString(36) : "x";
    const eIdx = selectedEnchant ? enchantMap.indexOf(selectedEnchant).toString(36) : "x";
    
    const fullData = `${statsPart}_${tIndices.join('-')}_${mIndices.join('-')}_${traitsPart}_${selectedOath || 'No Oath'}_${wIdx}_${eIdx}`;

    
    let totalHP = 360 + Math.min(Math.floor((userStats["Fortitude"] || 0) / 5) * 5, 50) + ((userTraits["Vitality"] || 0) * 10);
    selectedTalents.forEach(n => { if(hpTalentMap[n]) totalHP += hpTalentMap[n]; });

    
    const payload = {
        build: fullData,
        name: window.buildName || "Untitled Build",
        oath: selectedOath || "No Oath",
        description: userNotes || "No build description",
        hp: totalHP,
        
        stats: userStats,
        traits: userTraits
    };

    try {
        const response = await fetch('https://api.jsonbin.io/v3/b', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-Master-Key': JSONBIN_KEY,
                'X-Bin-Private': false
            },
            body: JSON.stringify(payload)
        });
        
        const result = await response.json();
        const shortId = result.metadata.id; 
        const url = `https://embedded-link.deepwoken-modded.workers.dev/?id=${shortId}`;

        navigator.clipboard.writeText(url).then(() => {
            alert("Embedded Link Copied");
            btn.innerText = originalText;
        });
    } catch (e) {
        console.error(e);
        alert("Failed to generate link. Copying standard URL instead.");
        btn.innerText = originalText;
    }
}

let isSignUp = false;

function openAuthModal() {
    const modal = document.getElementById('auth-modal');
    if(modal) {
        modal.style.display = 'block';
        
        document.getElementById('auth-user').style.display = 'none';
        document.getElementById('auth-pfp').style.display = 'none';
        document.getElementById('auth-title').innerText = "Login";
        isSignUp = false;
    } else {
        
        ensureGlobalModals();
        document.getElementById('auth-modal').style.display = 'block';
    }
}

function toggleAuthMode() {
    isSignUp = !isSignUp;
    const title = document.getElementById('auth-title');
    const userIn = document.getElementById('auth-user');
    const pfpIn = document.getElementById('auth-pfp');
    
    if (isSignUp) {
        title.innerText = "Sign Up";
        userIn.style.display = 'block';
        pfpIn.style.display = 'block';
    } else {
        title.innerText = "Login";
        userIn.style.display = 'none';
        pfpIn.style.display = 'none';
    }
}

async function submitAuth() {
    const email = document.getElementById('auth-email').value;
    const pass = document.getElementById('auth-pass').value;
    const user = document.getElementById('auth-user').value;
    const pfp = document.getElementById('auth-pfp').value;

    try {
        if (isSignUp) {
            if(!user) return alert("Username required");
            
            
            const cred = await auth.createUserWithEmailAndPassword(email, pass);
            
            await cred.user.updateProfile({
                displayName: user,
                photoURL: pfp || "https://i.imgur.com/6U68bgZ.png"
            });

            
            const emailHash = await hashString(email);

            await db.collection('users').doc(cred.user.uid).set({
                username: user,
                isAdmin: false,
                emailHash: emailHash 
            });
            

            alert("Account Created!");
        } else {
            await auth.signInWithEmailAndPassword(email, pass);
        }
        document.getElementById('auth-modal').style.display = 'none';
    } catch (e) {
        alert("Error: " + e.message);
    }
}

function logout() { auth.signOut(); }

function forgotPassword() {
    const email = prompt("Enter your email to reset password:");
    if(email) auth.sendPasswordResetEmail(email).then(() => alert("Email sent!")).catch(e => alert(e.message));
}

function closeModal(id) { document.getElementById(id).style.display = 'none'; }


function openPostModal() {
    const error = validateBuild();
    if(error) { alert(error); return; }

    const modal = document.getElementById('post-modal');
    if(modal) {
        modal.style.display = 'block';
        
        
        const tagContainer = document.getElementById('post-tag-container');
        if(tagContainer) {
            tagContainer.innerHTML = availableTags.map(t => 
                `<label style="margin-right:10px; cursor:pointer;">
                    <input type="checkbox" name="post_tags" value="${t}"> ${t}
                 </label>`
            ).join('');
        }
    }
}

async function submitPost() {
    if(!currentUser) return;
    const title = document.getElementById('post-title').value;
    const desc = document.getElementById('post-desc').value;
    
    
    
    const checkboxes = document.querySelectorAll('input[name="post_tags"]:checked');
    let tags = Array.from(checkboxes).map(cb => cb.value);
    if(tags.length === 0) tags = ["#General"]; 
    

    if(!title) return alert("Title required");

    
    const traitsPart = Object.values(userTraits).join('.');
    const statsPart = allStatKeys.map(k => userStats[k]||0).join('.');
    const tIndices = Array.from(selectedTalents).map(n => talentMap.indexOf(n).toString(36));
    const mIndices = Array.from(selectedMantras).map(n => mantraMap.indexOf(n).toString(36));
    const wIdx = selectedWeapon ? weaponMap.indexOf(selectedWeapon.name).toString(36) : "x";
    const eIdx = selectedEnchant ? enchantMap.indexOf(selectedEnchant).toString(36) : "x";
    const fullCode = `${statsPart}_${tIndices.join('-')}_${mIndices.join('-')}_${traitsPart}_${selectedOath || 'No Oath'}_${wIdx}_${eIdx}`;

    try {
        await db.collection('posts').add({
            title: title,
            desc: desc,
            tags: tags, 
            buildCode: fullCode,
            authorId: currentUser.uid,
            authorName: currentUser.displayName,
            authorPfp: currentUser.photoURL,
            voteScore: 0,
            upvotes: [],
            downvotes: [],
            commentCount: 0,
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            adminColor: currentAdminColor
        });
        closeModal('post-modal');
        loadForumPosts();
    } catch (e) {
        alert("Error posting: " + e.message);
    }
}

function filterTags(tag) {
    currentTagFilter = tag;
    renderSummaryTab(); 
    
}

async function loadForumPosts() {
    const feed = document.getElementById('forum-feed');
    if(!feed) return;
    
    feed.innerHTML = "<div style='text-align:center; padding:20px;'>Fetching builds...</div>";

    try {
        const postsRef = db.collection('posts');
        
        
        
        let pinnedQuery = postsRef.where('isPinned', '==', true);
        let voteQuery = postsRef.orderBy('voteScore', 'desc').limit(50);

        
        if (currentTagFilter) {
            
            pinnedQuery = pinnedQuery.where('tags', 'array-contains', currentTagFilter);
            voteQuery = voteQuery.where('tags', 'array-contains', currentTagFilter);
        }

        
        const [pinnedSnap, voteSnap] = await Promise.all([
            pinnedQuery.get(),
            voteQuery.get()
        ]);

        const tempMap = new Map();

        
        pinnedSnap.forEach(doc => {
            let data = doc.data();
            data.id = doc.id;
            tempMap.set(doc.id, data);
        });

        
        voteSnap.forEach(doc => {
            if (!tempMap.has(doc.id)) {
                let data = doc.data();
                data.id = doc.id;
                tempMap.set(doc.id, data);
            }
        });

        
        cachedPosts = Array.from(tempMap.values());

        
        
        cachedPosts.sort((a, b) => {
            const aPin = !!a.isPinned; 
            const bPin = !!b.isPinned;

            if (aPin && !bPin) return -1; 
            if (!aPin && bPin) return 1;  
            
            
            return (b.voteScore || 0) - (a.voteScore || 0);
        });

        if(cachedPosts.length === 0) {
            feed.innerHTML = "<div style='text-align:center; padding:20px;'>No builds found.</div>";
        } else {
            renderFeed(cachedPosts);
        }

    } catch (err) {
        console.error(err);
        if(err.message.includes("index")) {
            const url = err.message.match(/https:\/\/[^\s]+/);
            feed.innerHTML = `<div style='color:red; text-align:center; padding:20px;'>
                <strong>Missing Index:</strong> <a href="${url}" target="_blank" style="color:#c2a35d; text-decoration:underline;">Click here to fix DB</a>
            </div>`;
        } else {
            feed.innerHTML = `<div style='color:red; text-align:center'>Error: ${err.message}</div>`;
        }
    }
}

function scrollToTop() { window.scrollTo({top: 0, behavior: 'smooth'}); }


async function votePost(pid, val) {
    if(!currentUser) return alert("Login to vote");
    
    const uid = currentUser.uid;
    const name = currentUser.displayName; 

    const postRef = db.collection('posts').doc(pid);
    
    try {
        await db.runTransaction(async (t) => {
            const doc = await t.get(postRef);
            if (!doc.exists) return;

            const data = doc.data();
            let up = data.upvotes || [];
            let down = data.downvotes || [];
            
            
            let upNames = data.upNames || []; 
            let downNames = data.downNames || [];

            
            const clearUser = () => {
                up = up.filter(id => id !== uid);
                down = down.filter(id => id !== uid);
                upNames = upNames.filter(u => u.id !== uid);
                downNames = downNames.filter(u => u.id !== uid);
            };

            const isUpvoted = up.includes(uid);
            const isDownvoted = down.includes(uid);

            
            
            
            
            
            if (val === 1) {
                if (isUpvoted) {
                    clearUser(); 
                } else {
                    clearUser(); 
                    up.push(uid); 
                    upNames.push({ id: uid, name: name });
                }
            } 
            
            else if (val === -1) {
                if (isDownvoted) {
                    clearUser(); 
                } else {
                    clearUser(); 
                    down.push(uid); 
                    downNames.push({ id: uid, name: name });
                }
            }

            t.update(postRef, {
                upvotes: up, 
                downvotes: down,
                upNames: upNames, 
                downNames: downNames,
                voteScore: up.length - down.length
            });
        });
        
        
        if(document.getElementById('focus-view').style.display === 'block') {
             
             
             
             const updatedDoc = await db.collection('posts').doc(pid).get();
             if(updatedDoc.exists) {
                 
                 const els = document.querySelectorAll(`.vote-score-display-${pid}`);
                 els.forEach(el => el.innerText = updatedDoc.data().voteScore);
                 
             }
        } else {
            loadForumPosts(); 
        }

    } catch(e) { console.error(e); }
}
function renderFeed(posts) {
    const feed = document.getElementById('forum-feed');
    feed.innerHTML = "";
    
    posts.forEach(p => {
        const uid = currentUser ? currentUser.uid : null;
        let timeString = p.timestamp ? new Date(p.timestamp.toDate()).toLocaleDateString() : "";

        
        let adminBadge = "";
        if (p.isAdmin) {
            const glow = p.adminColor || "#ff0000"; 
            adminBadge = `<span class="admin-badge-glow" style="--glow-color: ${glow}">ADMIN</span>`;
        }

        
        const isPinned = p.isPinned === true;
        const pinBadge = isPinned ? `<span class="pinned-badge">📌 PINNED</span>` : "";
        const cardClass = isPinned ? "post-card pinned-post" : "post-card";

        
        let pinBtn = "";
        let deleteBtn = "";
        
        if (currentAdmin) {
            deleteBtn = `<span class="del-btn" style="color:red; cursor:pointer; font-size:0.8rem; margin-left:10px;" onclick="deletePost('${p.id}', '${p.authorId}'); event.stopPropagation();">[DELETE]</span>`;
            const pinText = isPinned ? "UNPIN" : "PIN";
            pinBtn = `<span class="pin-btn" onclick="togglePinPost('${p.id}', ${isPinned}); event.stopPropagation();">[${pinText}]</span>`;
        } else if (currentUser && currentUser.uid === p.authorId) {
            deleteBtn = `<span class="del-btn" style="color:red; cursor:pointer; font-size:0.8rem; margin-left:10px;" onclick="deletePost('${p.id}', '${p.authorId}'); event.stopPropagation();">[DELETE]</span>`;
        }

        
        let tagHtml = "";
        if (p.tags && Array.isArray(p.tags)) {
            tagHtml = p.tags.map(t => `<span class="tag-pill">${t}</span>`).join('');
        } else {
            tagHtml = `<span class="tag-pill">${p.tag || 'General'}</span>`; 
        }

        feed.innerHTML += `
            <div class="${cardClass}" onclick="openFocusView('${p.id}')">
                <div class="post-header">
                    <div class="post-author-info">
                        <img src="${p.authorPfp || 'https://i.imgur.com/6U68bgZ.png'}" class="post-pfp">
                        <div>
                            <div style="display:flex; align-items:center;">
                                ${pinBadge}
                                <span class="post-author-name">${p.authorName}</span> 
                                ${adminBadge}
                            </div>
                            <div style="font-size:0.7rem; color:#666;">${timeString}</div>
                        </div>
                    </div>
                    <div>${pinBtn} ${deleteBtn}</div>
                </div>

                <div class="post-title">${p.title}</div>
                <div class="tag-container">${tagHtml}</div>
                <div class="post-desc" style="max-height: 60px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${p.desc}</div>
                
                <div style="display:flex; justify-content:space-between; align-items:center; margin-top:10px;">
                     <span style="font-weight:bold; color: ${p.voteScore > 0 ? '#00aa00' : '#000'}">Votes: ${p.voteScore || 0}</span>
                     <span style="font-size:0.8rem; text-decoration:underline; color:#666;">${p.commentCount || 0} Comments</span>
                </div>
            </div>
        `;
    });
}

function togglePostComments(pid) {
    const el = document.getElementById(`comments-${pid}`);
    if(el.innerHTML.trim() === "" || el.style.display === "none") {
        el.style.display = "block";
        renderComments(pid);
    } else {
        el.style.display = "none";
    }
}

function renderComments(pid, targetId = null) {
    const containerId = targetId || `comments-${pid}`;
    const list = document.getElementById(containerId);
    if (!list) return;

    db.collection('posts').doc(pid).collection('comments').orderBy('timestamp', 'desc').get().then(snap => {
        list.innerHTML = "";
        if (snap.empty) {
            list.innerHTML = "<div style='font-style:italic; color:#888; padding:10px;'>No comments yet.</div>";
            return;
        }

        snap.forEach(doc => {
            const c = doc.data();
            const cid = doc.id;
            let timeString = c.timestamp ? timeAgo(c.timestamp.toDate()) : "Just now";
            
            
            let adminBadge = "";
            if (c.isAdmin) { 
                const glow = c.adminColor || "#ff0000";
                adminBadge = `<span class="admin-badge-glow" style="--glow-color: ${glow}">ADMIN</span>`;
            }

            
            let replyHtml = "";
            let itemStyle = "border-left: 3px solid var(--gold);"; 
            
            if (c.replyTo) {
                itemStyle = "border-left: none; margin-left: 0px;"; 
                let previewText = c.replyTo.snippet || "Click to see original";
                
                replyHtml = `
                    <div class="reply-context" onclick="scrollToComment('${c.replyTo.id}')">
                        <div class="reply-spine"></div>
                        <img src="${c.replyTo.avatar || 'https://i.imgur.com/6U68bgZ.png'}" class="reply-avatar-tiny">
                        <span style="font-weight:bold; margin-right:5px;">@${c.replyTo.name}</span>
                        <span class="reply-preview-text">${previewText}</span>
                    </div>
                `;
            }

            
            let mediaHtml = "";
            if (c.image) {
                if (isVideo(c.image)) {
                    mediaHtml = `<video src="${c.image}" controls style="max-width: 250px; display: block; margin-top: 5px; border-radius: 4px; border:1px solid #444;"></video>`;
                } else {
                    mediaHtml = `<img src="${c.image}" class="comment-img-preview" onclick="window.open(this.src)" style="max-width: 200px; display: block; margin-top: 5px; border-radius: 4px; border:1px solid #444;">`;
                }
            }

            
            const safeText = (c.text || "").replace(/'/g, "\\'").replace(/"/g, '&quot;');
            const safeImg = (c.image || "");

            
            const delBtn = (currentUser && (currentAdmin || currentUser.uid === c.authorId)) 
                ? `<span style="color:#f44; cursor:pointer; font-size:0.7rem; margin-left:10px;" onclick="deleteComment('${pid}', '${cid}', '${c.authorId}', '${containerId}')">DELETE</span>` 
                : "";
                
            const replyBtn = `<span style="cursor:pointer; color:#aaa; font-size:0.8rem; margin-left:10px;" onclick="replyToUser('${cid}', '${c.authorName}', '${c.authorPfp || ''}', '${safeText}', '${safeImg}')">↩ Reply</span>`;

            
            if (c.isDeleted) {
                 list.innerHTML += `
                    <div id="comment-${cid}" style="margin-bottom: 12px; padding: 8px 12px; background: rgba(0,0,0,0.2); border-left: 3px solid #555;">
                        <span style="color: #888; font-style: italic;">[Message deleted by Admin]</span>
                    </div>`;
                return;
            }

            const uid = currentUser ? currentUser.uid : null;
            const isUp = c.upvotes && c.upvotes.includes(uid);
            const isDown = c.downvotes && c.downvotes.includes(uid);

            list.innerHTML += `
                <div id="comment-${cid}" style="margin-bottom: 12px; position:relative; scroll-margin-top: 100px;">
                    ${replyHtml}
                    <div class="comment-item" style="${itemStyle} padding: 8px 12px; background: rgba(255,255,255,0.03);">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <div style="display:flex; align-items:center; gap:8px;">
                                <img src="${c.authorPfp || 'https://i.imgur.com/6U68bgZ.png'}" style="width:20px; height:20px; border-radius:50%;">
                                <span style="font-weight:bold; color: var(--gold);">${c.authorName}</span>
                                ${adminBadge}
                                <span style="font-size:0.7rem; color:#666;">${timeString}</span>
                            </div>
                            <div>${replyBtn} ${delBtn}</div>
                        </div>
                        
                        <div style="margin: 5px 0 5px 28px; color: #ddd; word-wrap: break-word;">${c.text}</div>
                        <div style="margin-left: 28px;">${mediaHtml}</div>
                        
                        <div style="display:flex; gap:10px; align-items:center; margin-top:5px; margin-left:28px;">
                            <button class="vote-arrow up ${isUp?'active':''}" onclick="voteComment('${pid}', '${cid}', 1, '${containerId}')">▲</button>
                            <span style="font-size:0.8rem; font-weight:bold; color:#aaa;">${c.voteScore || 0}</span>
                            <button class="vote-arrow down ${isDown?'active':''}" onclick="voteComment('${pid}', '${cid}', -1, '${containerId}')">▼</button>
                        </div>
                    </div>
                </div>
            `;
        });
    });
}


async function postComment(pid, containerId, mode) {
    if(!currentUser) return alert("Login to comment");
    
    let textId = containerId ? `c-text-${containerId}` : `focus-c-text-${pid}`;
    let imgId = containerId ? `c-img-${containerId}` : `focus-c-img-${pid}`;
    let targetListId = containerId ? `clist-${containerId}` : `focus-comments-list-${pid}`;

    const textInput = document.getElementById(textId);
    const imgInput = document.getElementById(imgId);
    
    const text = textInput.value;
    const img = imgInput.value;
    
    if(!text && !img) return;

    if(img) saveToMediaLibrary(img); 

    const batch = db.batch();
    const commentRef = db.collection('posts').doc(pid).collection('comments').doc();
    const postRef = db.collection('posts').doc(pid);

    batch.set(commentRef, {
        text: text,
        image: img,
        authorId: currentUser.uid,
        authorName: currentUser.displayName,
        authorPfp: currentUser.photoURL,
        isAdmin: currentAdmin,
        adminColor: currentAdminColor,
        
        
        replyTo: currentReplyContext ? {
            id: currentReplyContext.id,
            name: currentReplyContext.name,
            avatar: currentReplyContext.avatar,
            snippet: currentReplyContext.snippet 
        } : null,
        
        
        voteScore: 0,
        upvotes: [],
        downvotes: [],
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });

    batch.update(postRef, { commentCount: firebase.firestore.FieldValue.increment(1) });

    await batch.commit();
    
    textInput.value = "";
    imgInput.value = "";
    cancelReply(); 
    
    renderComments(pid, targetListId);
}

async function voteComment(pid, cid, val, containerId = null) {
    if(!currentUser) return alert("Please log in to vote.");
    
    const uid = currentUser.uid;
    const ref = db.collection('posts').doc(pid).collection('comments').doc(cid);
    
    try {
        await db.runTransaction(async (t) => {
            const doc = await t.get(ref);
            if (!doc.exists) return;

            let data = doc.data();
            let up = data.upvotes || [];
            let down = data.downvotes || [];

            const isUpvoted = up.includes(uid);
            const isDownvoted = down.includes(uid);

            
            const cleanUp = up.filter(id => id !== uid);
            const cleanDown = down.filter(id => id !== uid);

            if (val === 1) {
                
                
                if (!isUpvoted) {
                    cleanUp.push(uid);
                }
                
            } else if (val === -1) {
                if (!isDownvoted) {
                    cleanDown.push(uid);
                }
            }

            t.update(ref, { 
                upvotes: cleanUp, 
                downvotes: cleanDown, 
                voteScore: cleanUp.length - cleanDown.length 
            });
        });

        
        renderComments(pid, containerId);

    } catch (e) {
        console.error("Vote Error:", e);
    }
}


async function adminPanel() {
    if (!currentAdmin) return;

    const choice = prompt("Admin Menu:\n1. Promote User (Email)\n2. Reset Password\n3. Set My Glow Color (Hex)");

    if (choice === "1") {
        const targetEmail = prompt("Enter the exact email of the user to promote:");
        if (!targetEmail) return;

        try {
            
            const targetHash = await hashString(targetEmail);

            
            const snapshot = await db.collection('users').where('emailHash', '==', targetHash).get();

            if (snapshot.empty) {
                alert("User not found! They must sign up on the site first.");
                return;
            }

            snapshot.forEach(doc => {
                doc.ref.update({ isAdmin: true })
                .then(() => alert(`Success! User is now an Admin.`))
                .catch(e => {
                    console.error(e);
                    alert("Request Denied: " + e.message);
                });
            });
        } catch (e) {
            console.error(e);
            alert("Error: " + e.message);
        }
    } 
    else if (choice === "2") {
        
        const tEmail = prompt("Target Email for Password Reset:");
        if(tEmail) auth.sendPasswordResetEmail(tEmail)
            .then(()=>alert("Reset email sent."))
            .catch(e=>alert(e.message));
    }
    else if (choice === "3") {
        const color = prompt("Enter Hex Color (e.g. #00ff00 for green):", currentAdminColor);
        if(color && color.startsWith("#")) {
            await db.collection('users').doc(currentUser.uid).update({
                adminColor: color
            }).then(() => {
                currentAdminColor = color;
                alert("Color updated!");
            }).catch(e => {
                console.error(e);
                alert("Request Denied: " + e.message);
            });
        } else {
            alert("Invalid Hex Code.");
        }
    }
}


async function deletePost(pid, authorId) {
    if (!currentUser) return alert("Please log in.");
    
    const isAuthor = currentUser.uid === authorId;
    
    if (!currentAdmin && !isAuthor) {
        alert("You do not have permission.");
        return;
    }

    if (confirm("Permanently delete this post?")) {
        try {
            await db.collection('posts').doc(pid).delete();
            if(typeof closeFocusView === "function") closeFocusView();
            loadForumPosts();
        } catch (e) {
            console.error(e);
            alert("Request Denied: " + e.message);
        }
    }
}

async function deleteComment(pid, cid, authorId, containerId = null) {
    if (!currentUser) return;

    const isAuthor = currentUser.uid === authorId;
    
    if (!currentAdmin && !isAuthor) {
        alert("You do not have permission.");
        return;
    }

    if (confirm("Delete this comment?")) {
        try {
            const commentRef = db.collection('posts').doc(pid).collection('comments').doc(cid);

            if (currentAdmin) {
                await commentRef.update({
                    isDeleted: true,
                    text: "[Message deleted by Admin]",
                    image: ""
                });
            } else {
                await commentRef.delete();
                await db.collection('posts').doc(pid).update({
                    commentCount: firebase.firestore.FieldValue.increment(-1)
                });
            }

            renderComments(pid, containerId);

        } catch (e) {
            console.error(e);
            alert("Request Denied: " + e.message);
        }
    }
}
window.onload = init;

function buildRoulette() {
    // 1. RESET EVERYTHING
    for (let s in userStats) userStats[s] = 0;
    
    selectedTalents.clear();
    selectedMantras = []; 
    selectedWeapon = null;
    selectedEnchant = gameData.enchants[0];

    // 2. RANDOMIZE ATTUNEMENTS
    const attRand = Math.random() * 100;
    let attCount = 0;
    if (attRand < 25) attCount = 3;      
    else if (attRand < 55) attCount = 2; 
    else if (attRand < 90) attCount = 1; 
    
    // Determine Cap (Usually 410, 420, etc.)
    let cap = attCount === 0 ? 410 : 420 + Math.max(0, (attCount - 1) * 5);
    let remaining = cap;

    // 3. INVEST WEAPON STATS (Chunks of 5)
    const weaponClasses = ["Light Weapon", "Medium Weapon", "Heavy Weapon"];
    let primaryClass = weaponClasses[Math.floor(Math.random() * weaponClasses.length)];
    
    // Invest 40-80 points
    let weaponBase = 40 + (Math.floor(Math.random() * 9) * 5); 
    userStats[primaryClass] = weaponBase;
    remaining -= weaponBase;

    // 4. INVEST ATTUNEMENTS (Chunks of 5)
    let chosenAtts = [];
    if (attCount > 0) {
        let available = [...gameData.attunements];
        for (let i = 0; i < attCount; i++) {
            if (available.length === 0) break;
            let att = available.splice(Math.floor(Math.random() * available.length), 1)[0];
            let attVal = 20 + (Math.floor(Math.random() * 13) * 5); // 20 to 80
            userStats[att] = attVal;
            remaining -= attVal;
            chosenAtts.push(att);
        }
    }

    // 5. INVEST CORE STATS (Chunks of 5)
    const coreStats = ["Strength", "Fortitude", "Agility", "Intelligence", "Willpower", "Charisma", "Precision"];
    let focusedCores = [...coreStats].sort(() => 0.5 - Math.random()).slice(0, 5);
    
    focusedCores.forEach(stat => {
        if (remaining > 10) {
            let val = 20 + (Math.floor(Math.random() * 6) * 5); // 20 to 45
            if (remaining >= val) {
                userStats[stat] = val;
                remaining -= val;
            }
        }
    });

    // 6. DUMP REMAINING POINTS
    let pool = [primaryClass, ...chosenAtts, ...focusedCores];
    let attempts = 0;

    // Pass 1: Fill with 5s
    while (remaining >= 5 && attempts < 500) {
        attempts++;
        let stat = pool[Math.floor(Math.random() * pool.length)];
        
        // it doesn't exceed 100
        if (userStats[stat] <= 95) {
            userStats[stat] += 5;
            remaining -= 5;
        }
    }

    // Pass 2: Dump the tiny remainder (1-4 points) into MAIN WEAPON to keep others clean
    if (remaining > 0) {
        if (userStats[primaryClass] + remaining <= 100) {
            userStats[primaryClass] += remaining;
        } else {
            // If weapon is full, dump into first available stat
            for (let s of pool) {
                if (userStats[s] + remaining <= 100) {
                    userStats[s] += remaining;
                    break;
                }
            }
        }
    }

    // 7. SELECT WEAPON
    const compatible = gameData.weapons.filter(w => w.scaling[primaryClass] !== undefined);
    selectedWeapon = compatible.length > 0 ? compatible[Math.floor(Math.random() * compatible.length)] : gameData.weapons[0];

    // 8. SELECT ENCHANT
    if (gameData.enchants && gameData.enchants.length > 0) {
        selectedEnchant = gameData.enchants[Math.floor(Math.random() * gameData.enchants.length)];
    }

    // 9. UPDATE INPUTS
    for (let s in userStats) {
        const el = document.getElementById('in-' + s);
        if (el) el.value = userStats[s];
    }

    // 10. SELECT TALENTS
    const allT = Object.values(gameData.talents).flat();
    const shuffledTalents = allT.sort(() => 0.5 - Math.random());
    shuffledTalents.forEach(t => {
        if (selectedTalents.size < 60 && checkReqs(t.req)) selectedTalents.add(t.name);
    });
    
    // 11. SELECT MANTRAS (With Random Gems)
    const allM = Object.values(gameData.mantras).flat();
    const shuffledMantras = allM.sort(() => 0.5 - Math.random());
    shuffledMantras.forEach(m => {
        if (selectedMantras.length < 8 && checkReqs(m.req)) {
            const randomGem = deepGemList[Math.floor(Math.random() * deepGemList.length)];
            selectedMantras.push({ name: m.name, gem: randomGem });
        }
    });

    // 12. SELECT OATH
    const oaths = ["Saintsworn", "Blightsurger", "Linkstrider", "Fadetrimmer", "Dawnwalker", "Contractor", "Soulbreaker", "Silentheart", "Warmaster", "Starkindred", "BladeHarper", "Tetherlance", "Blindseer", "Chainwarden", "Ironfist", "Arcwarder", "Jetstriker", "Aetherkeeper", "Kingslayer", "Timeripper", "Fearfighter", "oathless", "Edencrusher"];
    selectedOath = oaths[Math.floor(Math.random() * oaths.length)];
    const oathEl = document.getElementById('oath-select');
    if(oathEl) oathEl.value = selectedOath;

    console.log("Evil.");
    updateUI();
}

const firebaseConfig = {
    apiKey: "AIzaSyBiKatdnUjpHF-NiWONwo9HdeWhD4mW1mI",
    authDomain: "dwm-builder.firebaseapp.com",
    projectId: "dwm-builder",
    storageBucket: "dwm-builder.firebasestorage.app",
    messagingSenderId: "365946457642",
    appId: "1:365946457642:web:178abbbdb0eb1ed8277d53",
    measurementId: "G-CK717RZMP3"
};


let db, auth;
let currentUser = null;
let currentAdmin = false;
let currentTagFilter = null; 
const availableTags = ["#support", "#Nuke", "#all-rounder", "#tank", "#fun", "#meta"];

try {
    firebase.initializeApp(firebaseConfig);
    db = firebase.firestore();
    auth = firebase.auth();
    console.log("Firebase initialized successfully");
} catch (e) {
    console.error("Firebase Error: Make sure script tags are in <head>", e);
}


if (auth) {
    auth.onAuthStateChanged(async (user) => {
        if (user) {
            currentUser = user;
            
            const doc = await db.collection('users').doc(user.uid).get();
            if(doc.exists) {
                const data = doc.data();
                currentAdmin = data.isAdmin || false;
                currentAdminColor = data.adminColor || "#ff0000"; 
            } else {
                currentAdmin = false;
            }
        } else {
            currentUser = null;
            currentAdmin = false;
        }

        
        
        if(currentTab === 'community') renderCommunityTab();
        else if(currentTab === 'summary') renderSummaryTab();
        
        
        const userBarPlaceholder = document.querySelector('.user-bar-container');
        if(userBarPlaceholder) userBarPlaceholder.innerHTML = renderUserBar();
    });
}


async function postCurrentBuild() {
    if(!window.buildName) { alert("Please name your build first!"); return; }
    
    const confirmPost = confirm("Post this build to the public forum?");
    if(!confirmPost) return;

    
    const traitsPart = Object.values(userTraits).join('.');
    const statsPart = allStatKeys.map(k => userStats[k]||0).join('.');
    const tIndices = Array.from(selectedTalents).map(n => talentMap.indexOf(n).toString(36));
    const mIndices = Array.from(selectedMantras).map(n => mantraMap.indexOf(n).toString(36));
    const wIdx = selectedWeapon ? weaponMap.indexOf(selectedWeapon.name).toString(36) : "x";
    const eIdx = selectedEnchant ? enchantMap.indexOf(selectedEnchant).toString(36) : "x";
    const fullCode = `${statsPart}_${tIndices.join('-')}_${mIndices.join('-')}_${traitsPart}_${selectedOath || 'No Oath'}_${wIdx}_${eIdx}`;

    try {
        await db.collection("posts").add({
            title: window.buildName,
            desc: userNotes || "No description provided.",
            buildCode: fullCode,
            votes: 0,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        alert("Build Posted!");
        loadForumPosts();
    } catch(e) {
        console.error("Error adding post: ", e);
        alert("Failed to post (Check Firebase Config)");
    }
}




function vote(pid, val) {
    const votedKey = `voted_${pid}`;
    if(localStorage.getItem(votedKey)) {
        alert("You already voted on this!");
        return;
    }

    const postRef = db.collection("posts").doc(pid);
    postRef.update({
        votes: firebase.firestore.FieldValue.increment(val)
    }).then(() => {
        localStorage.setItem(votedKey, "true");
        loadForumPosts();
    });
}


function toggleComments(pid) {
    const el = document.getElementById(`comments-${pid}`);
    if(el.style.display === "block") {
        el.style.display = "none";
    } else {
        el.style.display = "block";
        loadComments(pid);
    }
}

function loadComments(pid) {
    const list = document.getElementById(`comment-list-${pid}`);
    db.collection("posts").doc(pid).collection("comments").orderBy("timestamp").get().then((snap) => {
        list.innerHTML = "";
        snap.forEach(doc => {
            const c = doc.data();
            let imgHtml = c.img ? `<img src="${c.img}" class="comment-img" onclick="window.open(this.src)">` : '';
            list.innerHTML += `
                <div class="comment">
                    <div>${c.text} ${isAdmin ? `<span class="admin-del-btn" style="display:inline;" onclick="deleteComment('${pid}', '${doc.id}')">X</span>` : ''}</div>
                    ${imgHtml}
                </div>`;
        });
    });
}

function addComment(pid) {
    const text = document.getElementById(`c-text-${pid}`).value;
    const img = document.getElementById(`c-img-${pid}`).value;
    
    if(!text && !img) return;

    db.collection("posts").doc(pid).collection("comments").add({
        text: text,
        img: img,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
    }).then(() => {
        document.getElementById(`c-text-${pid}`).value = "";
        document.getElementById(`c-img-${pid}`).value = "";
        loadComments(pid);
    });
}


function deletePost(pid) {
    if(!currentAdmin) return;
    if(confirm("Delete this post?")) {
        db.collection("posts").doc(pid).delete().then(() => loadForumPosts());
    }
}

function deleteComment(pid, cid) {
    if(!currentAdmin) return;
    if(confirm("Delete this comment?")) {
        db.collection("posts").doc(pid).collection("comments").doc(cid).delete().then(() => loadComments(pid));
    }
}


function filterTags(tag) {
    currentTagFilter = tag;
    
    document.querySelectorAll('.tag-pill').forEach(btn => {
        btn.classList.remove('filter-active');
        if(btn.innerText === (tag || "ALL")) btn.classList.add('filter-active');
    });
    
    loadForumPosts(); 
}





function filterForumFeed() {
    const term = document.getElementById('forum-search').value.toLowerCase();
    const filtered = cachedPosts.filter(p => {
        return (p.title && p.title.toLowerCase().includes(term)) || 
               (p.desc && p.desc.toLowerCase().includes(term)) ||
               (p.authorName && p.authorName.toLowerCase().includes(term));
    });
    renderFeed(filtered);
}




function openFocusView(pid) {
    const p = cachedPosts.find(x => x.id === pid);
    if(!p) return;

    document.getElementById('focus-view').style.display = 'block';
    document.body.style.overflow = 'hidden'; 
    const content = document.getElementById('focus-content');
    
    const uid = currentUser ? currentUser.uid : null;
    const isUp = p.upvotes && p.upvotes.includes(uid);
    const isDown = p.downvotes && p.downvotes.includes(uid);
    
    
    let upvotersHTML = (p.upNames || []).map(u => `<div style='color:#4f4'>${u.name}</div>`).join('');
    let downvotersHTML = (p.downNames || []).map(u => `<div style='color:#f44'>${u.name}</div>`).join('');
    let tooltipHTML = `<div class="voter-tooltip"><strong>Upvoters:</strong><br>${upvotersHTML || 'None'}<br><br><strong>Downvoters:</strong><br>${downvotersHTML || 'None'}</div>`;

    
    let tagsHTML = (p.tags || [p.tag]).map(t => `<span class="tag-pill" style="margin-right:5px;">${t}</span>`).join('');

    
    let deleteBtn = "";
    if (currentUser && (currentAdmin || currentUser.uid === p.authorId)) {
        deleteBtn = `<button class="action-btn" style="background:red; width:auto; margin-left:10px;" onclick="deletePost('${pid}', '${p.authorId}')">DELETE POST</button>`;
    }

    
    content.innerHTML = `
        <div class="focus-header">
            <div class="post-author-info">
                <img src="${p.authorPfp || 'https://i.imgur.com/6U68bgZ.png'}" class="post-pfp" style="width: 60px; height: 60px; border:2px solid var(--gold);">
                <div style="margin-left: 15px;">
                    <h2 style="margin:0; font-size:1.8rem;">${p.title}</h2>
                    <span style="color:#aaa;">by ${p.authorName}</span>
                </div>
            </div>
            <div style="display:flex; align-items:center;">
                ${deleteBtn}
                <button onclick="closeFocusView()" style="background:transparent; border:none; color:#fff; font-size:2rem; cursor:pointer; margin-left:15px;">&times;</button>
            </div>
        </div>

        <div class="focus-body">
            <div style="margin-bottom:15px;">${tagsHTML}</div>
            <div style="font-size: 1.1rem; line-height: 1.6; white-space: pre-wrap; margin-bottom: 20px; color:#ddd;">${p.desc}</div>

            <!-- Main Vote Bar -->
            <div style="display:flex; align-items:center; gap:15px; background:rgba(255,255,255,0.05); padding:10px; border-radius:5px;">
                <button class="vote-arrow up ${isUp?'active':''}" onclick="votePost('${pid}', 1)">▲</button>
                <span class="vote-score vote-score-display-${pid}" style="font-size:1.5rem; color:#fff;">${p.voteScore || 0}</span>
                <button class="vote-arrow down ${isDown?'active':''}" onclick="votePost('${pid}', -1)">▼</button>
                
                <div class="voter-list-container">
                    [View Voters]
                    ${tooltipHTML}
                </div>
            </div>

            <button class="load-build-btn" style="margin-top:20px;" onclick="loadBuildFromString('${p.buildCode}'); alert('Build Loaded!'); closeFocusView();">LOAD BUILD</button>
            
            <hr style="border-color:#333; margin:30px 0;">
            
            <h3>Comments (${p.commentCount || 0})</h3>
            
            <!-- STEP 6: REPLY BAR & INPUT AREA -->
            
            <!-- A. The Reply Indicator (Hidden by default) -->
            <div id="reply-bar" class="reply-input-bar" style="display:none;">
                <span id="reply-bar-text">Replying to...</span>
                <span style="cursor:pointer; font-weight:bold;" onclick="cancelReply()">✕</span>
            </div>

            <!-- B. The Input Box -->
            <div class="comment-box" style="padding: 10px; background: rgba(0,0,0,0.2); border-radius: 0 0 5px 5px; display:flex; gap:5px; align-items:center;">
                <input type="text" id="focus-c-text-${pid}" placeholder="Chat..." style="flex:1; padding:10px;">
                
                <!-- Media Input & Library Toggle -->
                <div style="display:flex; flex-direction:column; width:150px; position:relative;">
                    <div style="display:flex;">
                        <input type="text" id="focus-c-img-${pid}" placeholder="URL" style="width:100%;">
                        <button class="media-btn" title="Media Lib" onclick="const el=document.getElementById('media-lib-${pid}'); el.style.display=el.style.display==='flex'?'none':'flex'">📂</button>
                    </div>
                    
                    <!-- The Dropdown Library -->
                    <div id="media-lib-${pid}" style="display:none; position:absolute; bottom:100%; left:0; background:#1a1a1a; padding:5px; border:1px solid #555; z-index:10; width:300px;">
                        ${getMediaLibraryHTML(`focus-c-img-${pid}`)}
                    </div>
                </div>

                <button onclick="postComment('${pid}', null, 'focus')" style="background: var(--gold); color:#000; border:none; padding:10px 20px; font-weight:bold; cursor:pointer;">SEND</button>
            </div>

            <!-- Comment List Container -->
            <div id="focus-comments-list-${pid}" style="margin-top:20px;"></div>
        </div>
    `;

    
    renderComments(pid, `focus-comments-list-${pid}`);
}

function closeFocusView() {
    document.getElementById('focus-view').style.display = 'none';
    document.body.style.overflow = 'auto'; 
    
    loadForumPosts();
}

function refreshFocusVoteUI(pid) {
}


function isVideo(url) {
    return url.match(/\.(mp4|webm|mov)$/i) != null;
}

function saveToMediaLibrary(url) {
    if(!url) return;
    let lib = JSON.parse(localStorage.getItem('dwm_media_lib') || "[]");
    if(!lib.includes(url)) {
        lib.unshift(url); 
        if(lib.length > 20) lib.pop(); 
        localStorage.setItem('dwm_media_lib', JSON.stringify(lib));
    }
    
    const openLib = document.querySelector('[id^="media-lib-"][style*="flex"]');
    if(openLib) openLib.innerHTML = getMediaLibraryHTML(openLib.id.replace('media-lib-', 'focus-c-img-'));
}

function removeFromMediaLibrary(url) {
    let lib = JSON.parse(localStorage.getItem('dwm_media_lib') || "[]");
    lib = lib.filter(u => u !== url);
    localStorage.setItem('dwm_media_lib', JSON.stringify(lib));
    
    const openLib = document.querySelector('[id^="media-lib-"][style*="flex"]');
    if(openLib) openLib.innerHTML = getMediaLibraryHTML(openLib.id.replace('media-lib-', 'focus-c-img-'));
}

function getMediaLibraryHTML(inputId) {
    let lib = JSON.parse(localStorage.getItem('dwm_media_lib') || "[]");
    
    let html = `<div style="display:flex; gap:5px; overflow-x:auto; padding:5px; align-items:center;">`;
    
    
    html += `
    <div onclick="const el=document.getElementById('${inputId}'); if(el.value) saveToMediaLibrary(el.value); else alert('Paste URL in box first');" 
         style="min-width:50px; height:50px; background:#333; color:#fff; display:flex; align-items:center; justify-content:center; cursor:pointer; border:1px dashed #666; font-size:1.5rem;" title="Save URL from input">+</div>
    `;

    lib.forEach(url => {
        let thumb = isVideo(url) ? 'https://cdn-icons-png.flaticon.com/512/1179/1179069.png' : url; 
        html += `
            <div class="media-item-container">
                <img src="${thumb}" class="media-thumb" onclick="document.getElementById('${inputId}').value = '${url}';">
                <div class="media-delete" onclick="removeFromMediaLibrary('${url}')">×</div>
            </div>`;
    });
    html += `</div>`;
    return html;
}
function timeAgo(date) {
    if (!date) return "Just now";
    const seconds = Math.floor((new Date() - date) / 1000);
    let interval = seconds / 31536000;
    if (interval > 1) return Math.floor(interval) + "y ago";
    interval = seconds / 2592000;
    if (interval > 1) return Math.floor(interval) + "mo ago";
    interval = seconds / 86400;
    if (interval > 1) return Math.floor(interval) + "d ago";
    interval = seconds / 3600;
    if (interval > 1) return Math.floor(interval) + "h ago";
    interval = seconds / 60;
    if (interval > 1) return Math.floor(interval) + "m ago";
    return "Just now";
}
let currentReplyContext = null; 

function replyToUser(commentId, authorName, avatarUrl, textContent, hasMedia) {
    
    let snippet = textContent || "";
    if (!snippet && hasMedia) {
        snippet = isVideo(hasMedia) ? "[Video]" : "[Image/GIF]";
    } else if (snippet.length > 50) {
        snippet = snippet.substring(0, 50) + "...";
    }

    currentReplyContext = { 
        id: commentId, 
        name: authorName, 
        avatar: avatarUrl,
        snippet: snippet 
    };
    
    
    const replyBar = document.getElementById('reply-bar');
    const replyText = document.getElementById('reply-bar-text');
    
    if (replyBar && replyText) {
        replyBar.style.display = 'flex';
        replyText.innerHTML = `Replying to <strong>${authorName}</strong>: <span style="color:#aaa; font-style:italic;">${snippet}</span>`;
        
        
        const input = document.querySelector('input[id^="focus-c-text-"]');
        if(input) input.focus();
    }
}

function cancelReply() {
    currentReplyContext = null;
    const replyBar = document.getElementById('reply-bar');
    if (replyBar) replyBar.style.display = 'none';
}
function scrollToComment(cid) {
    const el = document.getElementById(`comment-${cid}`);
    if (el) {
        el.scrollIntoView({ behavior: 'smooth', block: 'center' });
        el.classList.add('highlight-flash');
        setTimeout(() => el.classList.remove('highlight-flash'), 1500);
    } else {
        alert("Original message not found (it might be loaded further down or deleted).");
    }
}
function renderCommunityTab() {
    const container = document.getElementById('item-container');
    
    
    container.innerHTML = `
        <div class="calc-wrapper" style="max-width: 900px; min-height:80vh;">
            
            <!-- MOVED USER BAR HERE -->
            <div style="margin-bottom: 20px;">
                ${renderUserBar()}
            </div>

            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom: 2px solid #000; padding-bottom:10px;">
                <h2 style="margin:0; text-transform:uppercase;">Community Builds</h2>
                ${currentUser ? `<button class="comm-btn" style="background:#8b0000; color:#fff;" onclick="openPostModal()">+ Create Post</button>` : ``}
            </div>

            <!-- FORUM SEARCH BAR -->
            <input type="text" id="forum-search" class="forum-search-bar" 
                   placeholder="Search builds by title, author, or description..." 
                   oninput="filterForumFeed()"
                   style="width: 100%; padding: 12px; font-family: 'Lora'; margin-bottom: 15px; border: 1px solid #444; background: #fff; color: #000;">

            <!-- TAG FILTERS -->
            <div class="tag-filters" style="margin-bottom: 20px; display:flex; gap:5px; flex-wrap:wrap;">
                <span style="font-weight:bold; margin-right:5px; align-self:center;">Filter:</span>
                <button class="tag-pill ${currentTagFilter === null ? 'filter-active' : ''}" onclick="filterTags(null)">ALL</button>
                ${availableTags.map(t => `<button class="tag-pill ${currentTagFilter === t ? 'filter-active' : ''}" onclick="filterTags('${t}')">${t}</button>`).join('')}
            </div>

            <!-- THE FEED -->
            <div id="forum-feed" class="forum-feed">
                <div style="text-align:center; padding:20px;">Loading builds...</div>
            </div>
        </div>
    `;

    
    loadForumPosts();
}
function ensureGlobalModals() {
    
    const existingAuth = document.getElementById('auth-modal');
    const existingPost = document.getElementById('post-modal');
    if(existingAuth) existingAuth.remove();
    if(existingPost) existingPost.remove();

    
    const modalHTML = `
    <!-- AUTH MODAL -->
    <div id="auth-modal" class="modal" style="display:none; position:fixed; z-index:9999; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.8); backdrop-filter:blur(3px);">
        <div class="modal-content" style="background: var(--sidebar-bg); color: #fff; border: 1px solid #444; margin: 10% auto; padding: 20px; width: 400px; position:relative; box-shadow: 0 0 30px rgba(0,0,0,0.8);">
            <span onclick="document.getElementById('auth-modal').style.display='none'" style="float:right; cursor:pointer; font-size:1.5rem;">&times;</span>
            <h2 id="auth-title" style="margin-top:0; text-align:center;">Login</h2>
            <input type="text" id="auth-user" placeholder="Username" style="display:none; width:100%; padding:10px; margin:5px 0; background:#000; color:#fff; border:1px solid #333;">
            <input type="email" id="auth-email" placeholder="Email" style="width:100%; padding:10px; margin:5px 0; background:#000; color:#fff; border:1px solid #333;">
            <input type="text" id="auth-pfp" placeholder="PFP URL (Optional)" style="display:none; width:100%; padding:10px; margin:5px 0; background:#000; color:#fff; border:1px solid #333;">
            <input type="password" id="auth-pass" placeholder="Password" style="width:100%; padding:10px; margin:5px 0; background:#000; color:#fff; border:1px solid #333;">
            <button class="action-btn" onclick="submitAuth()" style="margin-top:15px; width:100%;">SUBMIT</button>
            <div style="margin-top:10px; font-size:0.8rem; cursor:pointer; text-decoration:underline; text-align:center;" onclick="toggleAuthMode()">Switch to Sign Up / Login</div>
        </div>
    </div>

    <!-- POST MODAL -->
    <div id="post-modal" class="modal" style="display:none; position:fixed; z-index:9999; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.8);">
        <div class="modal-content" style="background: var(--sidebar-bg); color: #fff; border: 1px solid #444; margin: 5% auto; padding: 20px; width: 500px;">
            <span onclick="document.getElementById('post-modal').style.display='none'" style="float:right; cursor:pointer;">&times;</span>
            <h2 style="margin-top:0;">Publish Build</h2>
            <input type="text" id="post-title" placeholder="Build Title" style="width:100%; padding:10px; margin-bottom:10px; background:#000; color:#fff; border:1px solid #333;">
            <textarea id="post-desc" style="width:100%; height:80px; padding:10px; margin-bottom:10px; background:#000; color:#fff; border:1px solid #333;" placeholder="Description"></textarea>
            <div style="margin-bottom:10px;">
                <label style="color:#aaa;">Select Tags:</label><br>
                <div id="post-tag-container" style="display:flex; flex-wrap:wrap; gap:10px; margin-top:5px;"></div>
            </div>
            <button class="action-btn" onclick="submitPost()">PUBLISH</button>
        </div>
    </div>
    `;

    
    const div = document.createElement('div');
    div.innerHTML = modalHTML;
    document.body.appendChild(div);
}
async function togglePinPost(pid, currentStatus) {
    if (!currentAdmin) return;

    try {
        await db.collection('posts').doc(pid).update({
            isPinned: !currentStatus 
        });
        
        loadForumPosts();
    } catch (e) {
        console.error(e);
        alert("Error pinning post: " + e.message);
    }
}
async function hashString(str) {
    const msgBuffer = new TextEncoder().encode(str.toLowerCase().trim());
    const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}
</script>
</body>
</html>